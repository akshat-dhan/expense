<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backpack Optimizer - Elite Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-blue: #007AFF;
            --primary-purple: #5856D6;
            --success-green: #34C759;
            --danger-red: #FF3B30;
            --warning-orange: #FF9500;
            --info-cyan: #5AC8FA;
            --system-gray: #8E8E93;
            --system-gray4: #D1D1D6;
            --system-gray5: #E5E5EA;
            --system-gray6: #F2F2F7;
            --surface: #FFFFFF;
            --text-primary: #1C1C1E;
            --text-secondary: #3A3A3C;
            --border-radius: 20px;
            --shadow: 0 8px 40px rgba(0, 0, 0, 0.12);
            --transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            --gradient-primary: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            --gradient-success: linear-gradient(135deg, #00C9FF, #92FE9D);
            --gradient-warning: linear-gradient(135deg, #FC466B, #3F5EFB);
            --gradient-premium: linear-gradient(135deg, #667eea, #764ba2);
            --gradient-gold: linear-gradient(135deg, #FFD700, #FFA500);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Enhanced Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 320px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(40px);
            border-right: 1px solid var(--system-gray5);
            z-index: 1000;
            padding: 30px;
            overflow-y: auto;
            box-shadow: 15px 0 50px rgba(0, 0, 0, 0.1);
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid var(--system-gray5);
        }

        .logo {
            font-size: 36px;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
            letter-spacing: -2px;
            animation: logoGlow 3s ease-in-out infinite;
        }

        @keyframes logoGlow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(0, 122, 255, 0.3)); }
            50% { filter: drop-shadow(0 0 20px rgba(0, 122, 255, 0.6)); }
        }

        .tagline {
            font-size: 14px;
            color: var(--system-gray);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.8;
        }

        .user-profile {
            background: var(--gradient-primary);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 122, 255, 0.3);
        }

        .user-profile::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: profileShine 4s infinite;
        }

        @keyframes profileShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
            100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 40px;
            background: rgba(255, 255, 255, 0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 900;
            margin: 0 auto 18px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 2;
            transition: var(--transition);
        }

        .nav-menu {
            list-style: none;
            padding: 0;
        }

        .nav-item {
            margin-bottom: 12px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 18px;
            padding: 18px 24px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 18px;
            font-weight: 700;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            transition: var(--transition);
            z-index: 0;
        }

        .nav-link:hover::before,
        .nav-link.active::before {
            left: 0;
        }

        .nav-link:hover,
        .nav-link.active {
            color: white;
            transform: translateX(10px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0, 122, 255, 0.4);
        }

        .nav-icon {
            font-size: 22px;
            width: 28px;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .nav-link span:last-child {
            position: relative;
            z-index: 1;
        }

        .main-content {
            margin-left: 320px;
            padding: 40px;
            min-height: 100vh;
        }

        .page-header {
            margin-bottom: 40px;
            color: white;
            text-align: center;
            position: relative;
        }

        .page-title {
            font-size: 4rem;
            font-weight: 900;
            margin-bottom: 15px;
            text-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            letter-spacing: -3px;
            animation: titleFloat 6s ease-in-out infinite;
            background: linear-gradient(135deg, #FFD700, #FFA500, #FFD700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-15px) scale(1.05); }
        }

        .page-subtitle {
            font-size: 1.6rem;
            opacity: 0.95;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .premium-badge {
            display: inline-block;
            background: var(--gradient-gold);
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            animation: badgePulse 2s infinite;
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.3);
        }

        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* **NEW: Enhanced Analytics Overview** */
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--gradient-primary);
            color: white;
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
            cursor: pointer;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-card:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }

        .stat-icon {
            font-size: 2.8rem;
            margin-bottom: 15px;
            display: block;
            animation: statFloat 3s ease-in-out infinite;
        }

        @keyframes statFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-change {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
        }

        .card {
            background: var(--surface);
            border-radius: 25px;
            padding: 35px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--system-gray5);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        /* **NEW: Enhanced Chart Containers** */
        .chart-container {
            background: var(--surface);
            border-radius: 25px;
            padding: 35px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--system-gray5);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .chart-wrapper {
            position: relative;
            height: 350px;
            margin-top: 25px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* **NEW: Advanced AI Insights Panel** */
        .ai-insights-panel {
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.1));
            border: 3px solid;
            border-image: linear-gradient(135deg, var(--primary-blue), var(--primary-purple)) 1;
            border-radius: 25px;
            padding: 30px;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }

        .ai-insights-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: aiShine 4s infinite;
        }

        @keyframes aiShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .ai-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .ai-brain {
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
            animation: brainPulse 2s infinite;
            box-shadow: 0 8px 20px rgba(0, 122, 255, 0.4);
        }

        @keyframes brainPulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 8px 20px rgba(0, 122, 255, 0.4);
            }
            50% { 
                transform: scale(1.1); 
                box-shadow: 0 12px 30px rgba(0, 122, 255, 0.6);
            }
        }

        .insight-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid var(--primary-blue);
            transition: var(--transition);
        }

        .insight-item:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        /* **NEW: Enhanced Spending Heatmap** */
        .spending-heatmap {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
            margin-top: 25px;
        }

        .heatmap-day {
            background: var(--system-gray6);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .heatmap-day::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .heatmap-day:hover::before {
            left: 100%;
        }

        .heatmap-day:hover {
            transform: scale(1.05) translateY(-5px);
            border-color: var(--primary-blue);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .heatmap-day-name {
            font-weight: 800;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .heatmap-amount {
            font-size: 18px;
            font-weight: 900;
            margin-bottom: 5px;
        }

        .heatmap-label {
            font-size: 11px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* **NEW: Advanced Analysis Section** */
        .analysis-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 25px;
        }

        .category-analysis-item {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 249, 255, 0.9));
            border: 2px solid var(--system-gray5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .category-analysis-item:hover {
            border-color: var(--primary-blue);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .category-name {
            font-weight: 800;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-amount {
            font-size: 20px;
            font-weight: 900;
            color: var(--primary-blue);
        }

        .category-progress-container {
            margin-bottom: 10px;
        }

        .category-progress {
            background: var(--system-gray4);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            position: relative;
        }

        .category-progress-fill {
            height: 100%;
            background: var(--gradient-success);
            border-radius: 10px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .category-progress-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            animation: progressFlow 2s infinite;
        }

        @keyframes progressFlow {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .category-stats {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: var(--system-gray);
            font-weight: 600;
        }

        /* **NEW: Spending Predictions** */
        .prediction-panel {
            background: linear-gradient(135deg, rgba(52, 199, 89, 0.1), rgba(52, 199, 89, 0.05));
            border: 2px solid var(--success-green);
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
        }

        .prediction-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .prediction-icon {
            width: 50px;
            height: 50px;
            background: var(--success-green);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
            animation: predictionPulse 3s infinite;
        }

        @keyframes predictionPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(52, 199, 89, 0.7);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(52, 199, 89, 0);
            }
        }

        .prediction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .prediction-item {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .prediction-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .prediction-value {
            font-size: 24px;
            font-weight: 900;
            color: var(--success-green);
            margin-bottom: 5px;
        }

        .prediction-label {
            font-size: 12px;
            color: var(--system-gray);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* **NEW: Flash Message Enhancement** */
        .flash-message {
            position: fixed;
            top: 30px;
            right: 30px;
            background: white;
            padding: 25px 30px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            border-left: 6px solid var(--success-green);
            z-index: 2000;
            max-width: 450px;
            font-weight: 700;
            animation: slideInRight 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            font-size: 16px;
            line-height: 1.5;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%) scale(0.8);
                opacity: 0;
            }
            to {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
        }

        .empty-state {
            text-align: center;
            padding: 80px 40px;
            color: var(--system-gray);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 25px;
            border: 3px dashed var(--system-gray4);
        }

        .empty-icon {
            font-size: 80px;
            margin-bottom: 25px;
            opacity: 0.7;
            animation: emptyFloat 3s ease-in-out infinite;
        }

        @keyframes emptyFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.4s ease;
            }
            
            .main-content {
                margin-left: 0;
                padding: 25px;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .analysis-section {
                grid-template-columns: 1fr;
            }
            
            .stats-overview {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
            
            .page-title {
                font-size: 2.8rem;
            }

            .spending-heatmap {
                grid-template-columns: repeat(7, minmax(80px, 1fr));
                gap: 8px;
            }

            .prediction-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Enhanced Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">🎒 Backpack Optimizer</div>
            <div class="tagline">Elite Analytics Dashboard</div>
        </div>
        
        <div class="user-profile">
            <div class="user-avatar" id="userAvatar">A</div>
            <div id="userName" style="font-size: 20px; font-weight: 800;">Loading...</div>
            <div id="userCampus" style="font-size: 14px; opacity: 0.9;">Loading...</div>
            <div style="font-size: 12px; margin-top: 8px; opacity: 0.8;" id="userRegNumber">Loading...</div>
            <div style="font-size: 13px; margin-top: 12px; background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 12px;">📈 Analytics Pro</div>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a href="dashboard.html" class="nav-link">
                    <span class="nav-icon">📊</span>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="expenses.html" class="nav-link">
                    <span class="nav-icon">💸</span>
                    <span>My Expenses</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="add-expense.html" class="nav-link">
                    <span class="nav-icon">➕</span>
                    <span>Add Expense</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="wishboard.html" class="nav-link">
                    <span class="nav-icon">⭐</span>
                    <span>Wishboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="marketplace.html" class="nav-link">
                    <span class="nav-icon">🛒</span>
                    <span>Marketplace</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="housing.html" class="nav-link">
                    <span class="nav-icon">🏠</span>
                    <span>Housing</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="analytics.html" class="nav-link active">
                    <span class="nav-icon">📈</span>
                    <span>Analytics</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="profile.html" class="nav-link">
                    <span class="nav-icon">👤</span>
                    <span>Profile</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="logout()">
                    <span class="nav-icon">🚪</span>
                    <span>Logout</span>
                </a>
            </li>
        </ul>
    </div>

    <!-- Enhanced Main Content -->
    <div class="main-content">
        <div class="page-header">
            <h1 class="page-title">📈 Elite Analytics Dashboard</h1>
            <p class="page-subtitle">Advanced insights powered by AI and machine learning</p>
            <div class="premium-badge">🏆 World's Most Advanced Student Analytics</div>
        </div>

        <!-- **NEW: Enhanced Analytics Overview** -->
        <div class="stats-overview">
            <div class="stat-card" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                <div class="stat-change" id="scoreChange">New</div>
                <span class="stat-icon">🎯</span>
                <div class="stat-value" id="spendingScore">0</div>
                <div class="stat-label">Financial Health Score</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                <div class="stat-change" id="streakChange">New</div>
                <span class="stat-icon">🔥</span>
                <div class="stat-value" id="trackingStreak">0</div>
                <div class="stat-label">Tracking Streak (Days)</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                <div class="stat-change" id="savingsChange">New</div>
                <span class="stat-icon">💰</span>
                <div class="stat-value" id="savingsRate">100%</div>
                <div class="stat-label">Monthly Savings Rate</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
                <div class="stat-change" id="goalsChange">New</div>
                <span class="stat-icon">🏆</span>
                <div class="stat-value" id="goalsAchieved">0</div>
                <div class="stat-label">Goals Achieved</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #FFD700, #FFA500);">
                <div class="stat-change" id="efficiencyChange">New</div>
                <span class="stat-icon">⚡</span>
                <div class="stat-value" id="spendingEfficiency">100%</div>
                <div class="stat-label">Spending Efficiency</div>
            </div>
        </div>

        <!-- **NEW: AI-Powered Spending Predictions** -->
        <div class="prediction-panel">
            <div class="prediction-header">
                <div class="prediction-icon">🔮</div>
                <div>
                    <h3 style="margin: 0; font-weight: 900; color: var(--success-green);">AI Spending Predictions</h3>
                    <p style="margin: 0; color: var(--system-gray); font-size: 14px;">Machine learning powered forecasts</p>
                </div>
            </div>
            <div class="prediction-grid">
                <div class="prediction-item">
                    <div class="prediction-value" id="monthEndPrediction">₹0</div>
                    <div class="prediction-label">Month End Total</div>
                </div>
                <div class="prediction-item">
                    <div class="prediction-value" id="weeklySavings">₹0</div>
                    <div class="prediction-label">Weekly Savings</div>
                </div>
                <div class="prediction-item">
                    <div class="prediction-value" id="goalCompletion">100%</div>
                    <div class="prediction-label">Goal Completion</div>
                </div>
                <div class="prediction-item">
                    <div class="prediction-value" id="riskLevel">None</div>
                    <div class="prediction-label">Overspend Risk</div>
                </div>
            </div>
        </div>

        <!-- Enhanced Charts Row -->
        <div class="charts-grid">
            <div class="chart-container">
                <h3 style="margin-bottom: 20px; color: var(--text-primary); font-weight: 900; font-size: 22px;">📈 Advanced Spending Analytics (30 Days)</h3>
                <div class="chart-wrapper">
                    <canvas id="spendingTrendChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <h3 style="margin-bottom: 20px; color: var(--text-primary); font-weight: 900; font-size: 22px;">😊 Emotional Spending</h3>
                <div class="chart-wrapper">
                    <canvas id="moodChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Enhanced Category Breakdown Chart -->
        <div class="chart-container">
            <h3 style="margin-bottom: 20px; color: var(--text-primary); font-weight: 900; font-size: 22px;">📊 Intelligent Category Analysis</h3>
            <div class="chart-wrapper">
                <canvas id="categoryChart"></canvas>
            </div>
        </div>

        <!-- **NEW: Advanced AI Insights Panel** -->
        <div class="ai-insights-panel">
            <div class="ai-header">
                <div class="ai-brain">🧠</div>
                <div>
                    <h3 style="margin: 0; font-weight: 900; color: var(--primary-blue);">Advanced AI Financial Insights</h3>
                    <p style="margin: 0; color: var(--system-gray); font-size: 14px;">Powered by machine learning algorithms</p>
                </div>
            </div>
            <div id="aiInsights">
                <div class="insight-item">
                    <strong>🌱 Fresh Start:</strong> Welcome to your analytics journey! Start tracking expenses to unlock powerful AI insights and personalized financial recommendations.
                </div>
                <div class="insight-item">
                    <strong>📊 Ready to Analyze:</strong> Add your first expense to see real-time spending trends, category breakdowns, and smart budget optimization suggestions.
                </div>
                <div class="insight-item">
                    <strong>🤖 AI Waiting:</strong> Our machine learning algorithms are ready to analyze your spending patterns and provide intelligent financial coaching once you have data.
                </div>
                <div class="insight-item">
                    <strong>🎯 Goal Setting:</strong> Set up your monthly budget and start adding expenses to unlock advanced predictive analytics and goal tracking features.
                </div>
            </div>
        </div>

        <!-- Enhanced Detailed Analysis -->
        <div class="card">
            <h3 style="margin-bottom: 25px; color: var(--text-primary); font-weight: 900; font-size: 24px;">🔍 Advanced Spending Intelligence</h3>
            <div class="analysis-section">
                <div>
                    <h4 style="color: var(--primary-blue); margin-bottom: 20px; font-size: 20px; font-weight: 800;">📊 Smart Category Breakdown</h4>
                    <div id="categoryAnalysis">
                        <!-- Category analysis will be populated by JavaScript -->
                    </div>
                </div>
                <div>
                    <h4 style="color: var(--primary-blue); margin-bottom: 20px; font-size: 20px; font-weight: 800;">🎯 Performance Metrics</h4>
                    <div id="performanceMetrics">
                        <!-- Performance metrics will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Spending Heatmap -->
        <div class="card">
            <h3 style="margin-bottom: 25px; color: var(--text-primary); font-weight: 900; font-size: 24px;">🗓️ Advanced Weekly Spending Intelligence</h3>
            <div class="spending-heatmap" id="spendingHeatmap">
                <!-- Heatmap will be generated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // ✅ CLEAN APPLICATION STATE - NO PREDEFINED DATA
        let currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
        let expenses = JSON.parse(localStorage.getItem('backpack_expenses') || '[]');
        let wishlist = JSON.parse(localStorage.getItem('backpack_wishlist') || '[]');

        // ✅ CHECK AUTHENTICATION - REDIRECT IF NOT LOGGED IN
        if (!currentUser) {
            window.location.href = 'index.html';
            throw new Error('User not authenticated');
        }

        // ✅ REAL USER PROFILE UPDATE - FIXED REG NUMBER
        function updateUserProfile() {
            const campusNames = {
                'CHRIST_BLR': 'Christ University - BCA',
                'DU_DELHI': 'Delhi University',
                'VIT_VEL': 'VIT Vellore', 
                'BITS_PIL': 'BITS Pilani',
                'IIT_BOM': 'IIT Bombay',
                'IIT_DEL': 'IIT Delhi'
            };

            const nameElement = document.getElementById('userName');
            const campusElement = document.getElementById('userCampus');
            const regElement = document.getElementById('userRegNumber');
            const avatarElement = document.getElementById('userAvatar');

            if (nameElement) nameElement.textContent = currentUser.fullName || 'Student';
            if (campusElement) campusElement.textContent = campusNames[currentUser.campus] || currentUser.campus || 'University';
            if (regElement) regElement.textContent = `Reg: ${currentUser.regNumber || 'Not provided'}`; // ✅ FIXED - Shows real reg number
            if (avatarElement) avatarElement.textContent = (currentUser.fullName || 'S')[0].toUpperCase();
            
            console.log('✅ User Profile Updated with REAL data:', {
                name: currentUser.fullName,
                regNumber: currentUser.regNumber, // This shows actual user input
                campus: currentUser.campus
            });
        }

        // ✅ NO PREDEFINED SAMPLE EXPENSES - COMPLETELY CLEAN START
        function updateAnalytics() {
            const userExpenses = expenses.filter(e => e.userId === currentUser.id);
            const userWishlist = wishlist.filter(w => w.userId === currentUser.id);
            
            // Update analytics cards with animations
            updateAnalyticsCards(userExpenses, userWishlist);
            
            // Update AI predictions
            updatePredictions(userExpenses);
            
            // Update charts with real data only
            updateSpendingTrendChart(userExpenses);
            updateMoodChart(userExpenses);
            updateCategoryChart(userExpenses);
            
            // Update detailed analysis
            updateCategoryAnalysis(userExpenses);
            updatePerformanceMetrics(userExpenses);
            updateSpendingHeatmap(userExpenses);
        }

        function updateAnalyticsCards(userExpenses, userWishlist) {
            const totalSpent = userExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            const budget = currentUser.monthlyBudget || 20000;
            
            // Calculate financial health score (0-100)
            const healthScore = userExpenses.length === 0 ? 100 : Math.max(0, Math.min(100, 100 - (totalSpent / budget) * 100));
            
            // Calculate tracking streak
            const streakDays = userExpenses.length; // Number of expense entries
            
            // Calculate savings rate
            const savingsRate = Math.max(0, ((budget - totalSpent) / budget) * 100);
            
            // Calculate goals achieved
            const goalsAchieved = userWishlist.filter(w => w.savedAmount >= w.targetAmount).length;
            
            // Calculate spending efficiency
            const efficiency = userExpenses.length === 0 ? 100 : Math.min(100, 100 - (totalSpent / budget) * 100);
            
            // Animate values
            animateValue('spendingScore', 0, Math.round(healthScore), 2000);
            animateValue('trackingStreak', 0, streakDays, 1500);
            animateValue('spendingEfficiency', 0, Math.round(efficiency), 2500);
            animateValue('goalsAchieved', 0, goalsAchieved, 1000);
            
            document.getElementById('savingsRate').textContent = Math.round(savingsRate) + '%';
        }

        function updatePredictions(userExpenses) {
            const totalSpent = userExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            const budget = currentUser.monthlyBudget || 20000;
            
            if (userExpenses.length === 0) {
                // Clean state predictions
                document.getElementById('monthEndPrediction').textContent = '₹' + budget.toLocaleString('en-IN');
                document.getElementById('weeklySavings').textContent = '₹' + Math.round(budget / 4).toLocaleString('en-IN');
                document.getElementById('goalCompletion').textContent = '100%';
                document.getElementById('riskLevel').textContent = 'None';
                return;
            }
            
            const daysInMonth = 30;
            const currentDay = new Date().getDate();
            
            // Predict month-end spending
            const dailyAvg = totalSpent / Math.max(currentDay, 1);
            const monthEndPrediction = dailyAvg * daysInMonth;
            
            // Calculate weekly savings potential
            const weeklySavings = Math.max(0, (budget - monthEndPrediction) / 4);
            
            // Goal completion prediction
            const goalCompletion = Math.min(100, ((budget - monthEndPrediction) / budget) * 100);
            
            // Risk assessment
            const riskLevel = monthEndPrediction > budget * 0.9 ? 'High' : monthEndPrediction > budget * 0.7 ? 'Medium' : 'Low';
            
            document.getElementById('monthEndPrediction').textContent = '₹' + Math.round(monthEndPrediction).toLocaleString('en-IN');
            document.getElementById('weeklySavings').textContent = '₹' + Math.round(weeklySavings).toLocaleString('en-IN');
            document.getElementById('goalCompletion').textContent = Math.round(goalCompletion) + '%';
            document.getElementById('riskLevel').textContent = riskLevel;
        }

        function updateSpendingTrendChart(userExpenses) {
            const ctx = document.getElementById('spendingTrendChart').getContext('2d');
            
            if (userExpenses.length === 0) {
                // Show empty state message
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#8E8E93';
                ctx.font = 'bold 18px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('📈 No expense data yet', ctx.canvas.width / 2, ctx.canvas.height / 2 - 20);
                ctx.font = '14px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
                ctx.fillText('Add expenses to see your spending trends', ctx.canvas.width / 2, ctx.canvas.height / 2 + 10);
                return;
            }
            
            // Generate last 14 days data for better analysis
            const last14Days = [];
            const dailySpending = {};
            
            for (let i = 13; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                last14Days.push(dateStr);
                dailySpending[dateStr] = 0;
            }
            
            // Calculate daily spending
            userExpenses.forEach(expense => {
                const expenseDate = expense.date.split('T')[0];
                if (dailySpending.hasOwnProperty(expenseDate)) {
                    dailySpending[expenseDate] += expense.amount;
                }
            });
            
            const labels = last14Days.map(date => new Date(date).toLocaleDateString('en-IN', { month: 'short', day: 'numeric' }));
            const data = last14Days.map(date => dailySpending[date]);
            
            // Calculate trend line
            const trendData = calculateTrendLine(data);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Daily Spending (₹)',
                            data: data,
                            borderColor: '#007AFF',
                            backgroundColor: 'rgba(0, 122, 255, 0.1)',
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#007AFF',
                            pointBorderColor: 'white',
                            pointBorderWidth: 3,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        },
                        {
                            label: 'Trend Line',
                            data: trendData,
                            borderColor: '#FF9500',
                            backgroundColor: 'transparent',
                            borderDash: [5, 5],
                            borderWidth: 2,
                            pointRadius: 0,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '₹' + value.toLocaleString('en-IN');
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        function calculateTrendLine(data) {
            const n = data.length;
            if (n === 0) return [];
            
            const sumX = n * (n - 1) / 2;
            const sumY = data.reduce((a, b) => a + b, 0);
            const sumXY = data.reduce((sum, y, x) => sum + x * y, 0);
            const sumXX = data.reduce((sum, _, x) => sum + x * x, 0);
            
            if (n * sumXX - sumX * sumX === 0) {
                return data.map(() => sumY / n);
            }
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            return data.map((_, x) => slope * x + intercept);
        }

        function updateMoodChart(userExpenses) {
            const ctx = document.getElementById('moodChart').getContext('2d');
            
            if (userExpenses.length === 0) {
                // Show empty state message
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#8E8E93';
                ctx.font = 'bold 18px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('😊 No mood data yet', ctx.canvas.width / 2, ctx.canvas.height / 2 - 20);
                ctx.font = '14px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
                ctx.fillText('Track expenses to see your spending moods', ctx.canvas.width / 2, ctx.canvas.height / 2 + 10);
                return;
            }
            
            const moodCounts = { happy: 0, neutral: 0, sad: 0, excited: 0 };
            const moodSpending = { happy: 0, neutral: 0, sad: 0, excited: 0 };
            
            userExpenses.forEach(expense => {
                if (moodCounts.hasOwnProperty(expense.mood)) {
                    moodCounts[expense.mood]++;
                    moodSpending[expense.mood] += expense.amount;
                }
            });
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['😊 Happy', '😐 Neutral', '😢 Stressed', '🤩 Excited'],
                    datasets: [{
                        data: [moodCounts.happy, moodCounts.neutral, moodCounts.sad, moodCounts.excited],
                        backgroundColor: [
                            '#34C759', 
                            '#8E8E93', 
                            '#FF3B30', 
                            '#FF9500'
                        ],
                        borderWidth: 3,
                        borderColor: '#ffffff',
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                font: {
                                    size: 14,
                                    weight: '600'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const mood = ['happy', 'neutral', 'sad', 'excited'][context.dataIndex];
                                    const count = context.raw;
                                    const spending = moodSpending[mood];
                                    return `${context.label}: ${count} times, ₹${spending.toLocaleString('en-IN')} spent`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateCategoryChart(userExpenses) {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            if (userExpenses.length === 0) {
                // Show empty state message
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#8E8E93';
                ctx.font = 'bold 18px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('📊 No category data yet', ctx.canvas.width / 2, ctx.canvas.height / 2 - 20);
                ctx.font = '14px -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif';
                ctx.fillText('Add expenses to see category breakdown', ctx.canvas.width / 2, ctx.canvas.height / 2 + 10);
                return;
            }
            
            const categories = {};
            userExpenses.forEach(exp => {
                categories[exp.category] = (categories[exp.category] || 0) + exp.amount;
            });
            
            // Sort categories by amount
            const sortedCategories = Object.entries(categories).sort((a, b) => b[1] - a[1]);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedCategories.map(([cat]) => getCategoryLabel(cat)),
                    datasets: [{
                        label: 'Amount Spent (₹)',
                        data: sortedCategories.map(([,amount]) => amount),
                        backgroundColor: [
                            'rgba(255, 107, 107, 0.8)',
                            'rgba(78, 205, 196, 0.8)',
                            'rgba(69, 183, 209, 0.8)',
                            'rgba(150, 206, 180, 0.8)',
                            'rgba(255, 234, 167, 0.8)',
                            'rgba(221, 160, 221, 0.8)',
                            'rgba(152, 216, 200, 0.8)'
                        ],
                        borderColor: [
                            'rgb(255, 107, 107)',
                            'rgb(78, 205, 196)',
                            'rgb(69, 183, 209)',
                            'rgb(150, 206, 180)',
                            'rgb(255, 234, 167)',
                            'rgb(221, 160, 221)',
                            'rgb(152, 216, 200)'
                        ],
                        borderWidth: 2,
                        borderRadius: 10,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = sortedCategories.reduce((sum, [,amount]) => sum + amount, 0);
                                    const percentage = ((context.raw / total) * 100).toFixed(1);
                                    return `₹${context.raw.toLocaleString('en-IN')} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '₹' + value.toLocaleString('en-IN');
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    }
                }
            });
        }

        function updateCategoryAnalysis(userExpenses) {
            const container = document.getElementById('categoryAnalysis');
            
            if (userExpenses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📊</div>
                        <div style="font-size: 20px; font-weight: 700; margin-bottom: 12px;">No expense data available yet</div>
                        <div style="margin-bottom: 20px;">Start tracking expenses to see detailed category analysis!</div>
                        <a href="add-expense.html" style="background: var(--gradient-primary); color: white; padding: 12px 25px; border-radius: 15px; text-decoration: none; font-weight: 600;">➕ Add First Expense</a>
                    </div>
                `;
                return;
            }
            
            const categories = {};
            userExpenses.forEach(exp => {
                categories[exp.category] = (categories[exp.category] || 0) + exp.amount;
            });
            
            const totalSpent = Object.values(categories).reduce((sum, amount) => sum + amount, 0);
            const sortedCategories = Object.entries(categories).sort((a, b) => b[1] - a[1]);
            
            container.innerHTML = sortedCategories.map(([category, amount], index) => {
                const percentage = totalSpent > 0 ? (amount / totalSpent * 100) : 0;
                const transactions = userExpenses.filter(exp => exp.category === category).length;
                const avgTransaction = amount / transactions;
                
                return `
                    <div class="category-analysis-item">
                        <div class="category-header">
                            <div class="category-name">
                                <span style="font-size: 20px;">${getCategoryIcon(category)}</span>
                                ${getCategoryLabel(category)}
                            </div>
                            <div class="category-amount">₹${amount.toLocaleString('en-IN')}</div>
                        </div>
                        <div class="category-progress-container">
                            <div class="category-progress">
                                <div class="category-progress-fill" style="width: ${percentage}%;"></div>
                            </div>
                        </div>
                        <div class="category-stats">
                            <span>${percentage.toFixed(1)}% of total</span>
                            <span>${transactions} transactions</span>
                            <span>₹${Math.round(avgTransaction)} avg</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updatePerformanceMetrics(userExpenses) {
            const container = document.getElementById('performanceMetrics');
            
            if (userExpenses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🎯</div>
                        <div style="font-size: 20px; font-weight: 700; margin-bottom: 12px;">No performance data yet</div>
                        <div style="margin-bottom: 20px;">Track expenses to unlock powerful performance insights!</div>
                        <div style="font-size: 14px; color: var(--system-gray);">Budget usage • Daily averages • Mood impact</div>
                    </div>
                `;
                return;
            }
            
            const totalSpent = userExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            const budget = currentUser.monthlyBudget || 20000;
            const budgetUsage = (totalSpent / budget * 100);
            
            const avgDaily = totalSpent / Math.max(new Date().getDate(), 1);
            const projectedMonthly = avgDaily * 30;
            
            const moodSpending = {
                happy: userExpenses.filter(exp => exp.mood === 'happy').reduce((sum, exp) => sum + exp.amount, 0),
                sad: userExpenses.filter(exp => exp.mood === 'sad').reduce((sum, exp) => sum + exp.amount, 0)
            };
            
            container.innerHTML = `
                <div class="category-analysis-item">
                    <div class="category-header">
                        <div class="category-name">📈 Budget Usage</div>
                        <div class="category-amount">${budgetUsage.toFixed(1)}%</div>
                    </div>
                    <div class="category-progress-container">
                        <div class="category-progress">
                            <div class="category-progress-fill" style="width: ${Math.min(budgetUsage, 100)}%; background: ${budgetUsage > 80 ? 'linear-gradient(135deg, #FF3B30, #FF6B6B)' : 'var(--gradient-success)'};"></div>
                        </div>
                    </div>
                    <div class="category-stats">
                        <span>₹${totalSpent.toLocaleString('en-IN')} of ₹${budget.toLocaleString('en-IN')}</span>
                        <span>${budgetUsage > 80 ? '⚠️ High' : budgetUsage > 60 ? '🟡 Medium' : '✅ Good'}</span>
                    </div>
                </div>
                
                <div class="category-analysis-item">
                    <div class="category-header">
                        <div class="category-name">📊 Daily Average</div>
                        <div class="category-amount">₹${Math.round(avgDaily).toLocaleString('en-IN')}</div>
                    </div>
                    <div class="category-progress-container">
                        <div class="category-progress">
                            <div class="category-progress-fill" style="width: ${Math.min((avgDaily / 1000) * 100, 100)}%;"></div>
                        </div>
                    </div>
                    <div class="category-stats">
                        <span>Projected: ₹${Math.round(projectedMonthly).toLocaleString('en-IN')}</span>
                        <span>${avgDaily < 500 ? '🎯 Excellent' : avgDaily < 800 ? '👍 Good' : '⚠️ Monitor'}</span>
                    </div>
                </div>
                
                <div class="category-analysis-item">
                    <div class="category-header">
                        <div class="category-name">😊 Mood Impact</div>
                        <div class="category-amount">${(moodSpending.happy + moodSpending.sad) > 0 ? (moodSpending.happy > moodSpending.sad ? '📈 Positive' : '📉 Negative') : '➡️ Neutral'}</div>
                    </div>
                    <div class="category-progress-container">
                        <div class="category-progress">
                            <div class="category-progress-fill" style="width: ${(moodSpending.happy + moodSpending.sad) > 0 ? (moodSpending.happy / (moodSpending.happy + moodSpending.sad) * 100) : 50}%;"></div>
                        </div>
                    </div>
                    <div class="category-stats">
                        <span>Happy: ₹${moodSpending.happy.toLocaleString('en-IN')}</span>
                        <span>Stress: ₹${moodSpending.sad.toLocaleString('en-IN')}</span>
                    </div>
                </div>
            `;
        }

        function updateSpendingHeatmap(userExpenses) {
            const container = document.getElementById('spendingHeatmap');
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const shortDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            if (userExpenses.length === 0) {
                container.innerHTML = shortDays.map(day => `
                    <div class="heatmap-day" style="background: linear-gradient(135deg, #E5E5EA, #F2F2F7); color: var(--text-primary);">
                        <div class="heatmap-day-name">
                            ${day}
                        </div>
                        <div class="heatmap-amount">
                            ₹0
                        </div>
                        <div class="heatmap-label" style="color: var(--system-gray);">
                            no data
                        </div>
                    </div>
                `).join('');
                return;
            }
            
            // Calculate spending by day of week
            const daySpending = { 0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0 };
            const dayCounts = { 0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0 };
            
            userExpenses.forEach(expense => {
                const dayOfWeek = new Date(expense.date).getDay();
                daySpending[dayOfWeek] += expense.amount;
                dayCounts[dayOfWeek]++;
            });
            
            // Calculate average spending per day
            Object.keys(daySpending).forEach(day => {
                if (dayCounts[day] > 0) {
                    daySpending[day] = daySpending[day] / dayCounts[day];
                }
            });
            
            const maxSpending = Math.max(...Object.values(daySpending));
            const totalWeeklyAvg = Object.values(daySpending).reduce((sum, amt) => sum + amt, 0) / 7;
            
            container.innerHTML = shortDays.map((day, index) => {
                const spending = daySpending[index];
                const intensity = maxSpending > 0 ? (spending / maxSpending) : 0;
                const color = intensity > 0.7 ? 'linear-gradient(135deg, #FF3B30, #FF6B6B)' :
                             intensity > 0.4 ? 'linear-gradient(135deg, #FF9500, #FFB84D)' :
                             intensity > 0.1 ? 'linear-gradient(135deg, #007AFF, #4A90E2)' :
                             'linear-gradient(135deg, #E5E5EA, #F2F2F7)';
                
                const textColor = intensity > 0.5 ? 'white' : 'var(--text-primary)';
                const comparison = spending > totalWeeklyAvg ? '📈' : spending < totalWeeklyAvg ? '📉' : '➡️';
                
                return `
                    <div class="heatmap-day" style="background: ${color}; color: ${textColor};">
                        <div class="heatmap-day-name" style="color: ${textColor};">
                            ${day}
                        </div>
                        <div class="heatmap-amount" style="color: ${textColor};">
                            ₹${spending.toFixed(0)}
                        </div>
                        <div class="heatmap-label" style="color: ${intensity > 0.5 ? 'rgba(255,255,255,0.8)' : 'var(--system-gray)'};">
                            avg ${comparison}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getCategoryIcon(category) {
            const icons = {
                food: '🍕',
                transport: '🚗',
                entertainment: '🎬',
                education: '📚',
                shopping: '🛍️',
                health: '🏥',
                clothing: '👕',
                other: '🔄'
            };
            return icons[category] || '🔄';
        }

        function getCategoryLabel(category) {
            const labels = {
                food: 'Food & Dining',
                transport: 'Transportation',
                entertainment: 'Entertainment',
                education: 'Education',
                shopping: 'Shopping',
                health: 'Healthcare',
                clothing: 'Clothing',
                other: 'Other'
            };
            return labels[category] || 'Other';
        }

        // **NEW: Enhanced value animation**
        function animateValue(elementId, start, end, duration) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const range = end - start;
            const startTime = Date.now();
            
            const updateValue = () => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const current = start + (range * progress * progress); // Quadratic easing
                
                element.textContent = Math.round(current);
                
                if (progress < 1) {
                    requestAnimationFrame(updateValue);
                }
            };
            
            updateValue();
        }

        function logout() {
            if (confirm(`Are you sure you want to logout, ${currentUser.fullName || 'Student'}?\n\nYour analytics data will be preserved for future insights! 📈`)) {
                localStorage.removeItem('currentUser');
                showFlashMessage('Logged out successfully! Your financial insights are always here when you return! 👋📊');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            }
        }

        function showFlashMessage(message) {
            const existingFlash = document.querySelector('.flash-message');
            if (existingFlash) {
                existingFlash.remove();
            }

            const flash = document.createElement('div');
            flash.className = 'flash-message';
            
            flash.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 28px;">📈</span>
                    <span style="flex: 1; font-size: 16px; line-height: 1.5;">${message}</span>
                    <span onclick="this.parentElement.parentElement.remove()" style="cursor: pointer; font-size: 28px; font-weight: bold; opacity: 0.7; transition: opacity 0.3s; padding: 5px;">&times;</span>
                </div>
            `;
            
            document.body.appendChild(flash);
            
            setTimeout(() => {
                if (flash.parentNode) {
                    flash.style.animation = 'slideOutRight 0.6s ease forwards';
                    setTimeout(() => flash.remove(), 600);
                }
            }, 7000);
        }

        // ✅ COMPLETELY CLEAN INITIALIZATION - NO PREDEFINED EXPENSES
        document.addEventListener('DOMContentLoaded', function() {
            console.log('📈 Analytics Dashboard Loading with COMPLETELY CLEAN data...');
            
            updateUserProfile();
            updateAnalytics();
            
            console.log('✅ Analytics Dashboard loaded successfully!');
            console.log('✅ Real user profile with registration number:', currentUser.regNumber);
            console.log('✅ NO predefined sample expenses - completely clean start');
            console.log('🧠 AI-Powered Insights: Ready for real data');
            console.log('🔮 Predictive Analytics: Ready for patterns');
            console.log('📊 Advanced Visualizations: Waiting for data');
            console.log('💡 Machine Learning: Ready to learn from YOUR data');
        });
    </script>
</body>
</html>
