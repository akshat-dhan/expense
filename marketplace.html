<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backpack Optimizer - Elite Campus Marketplace</title>
    <style>
        :root {
            --primary-blue: #007AFF;
            --primary-purple: #5856D6;
            --success-green: #34C759;
            --danger-red: #FF3B30;
            --warning-orange: #FF9500;
            --info-cyan: #5AC8FA;
            --system-gray: #8E8E93;
            --system-gray4: #D1D1D6;
            --system-gray5: #E5E5EA;
            --system-gray6: #F2F2F7;
            --surface: #FFFFFF;
            --text-primary: #1C1C1E;
            --text-secondary: #3A3A3C;
            --border-radius: 20px;
            --shadow: 0 8px 40px rgba(0, 0, 0, 0.12);
            --transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            --gradient-primary: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            --gradient-success: linear-gradient(135deg, #00C9FF, #92FE9D);
            --gradient-warning: linear-gradient(135deg, #FC466B, #3F5EFB);
            --gradient-premium: linear-gradient(135deg, #667eea, #764ba2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Enhanced Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 320px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(40px);
            border-right: 1px solid var(--system-gray5);
            z-index: 1000;
            padding: 30px;
            overflow-y: auto;
            box-shadow: 15px 0 50px rgba(0, 0, 0, 0.1);
        }

        .sidebar-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid var(--system-gray5);
        }

        .logo {
            font-size: 36px;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
            letter-spacing: -2px;
            animation: logoGlow 3s ease-in-out infinite;
        }

        @keyframes logoGlow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(0, 122, 255, 0.3)); }
            50% { filter: drop-shadow(0 0 20px rgba(0, 122, 255, 0.6)); }
        }

        .tagline {
            font-size: 14px;
            color: var(--system-gray);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.8;
        }

        .user-profile {
            background: var(--gradient-primary);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 30px;
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 122, 255, 0.3);
        }

        .user-profile::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: profileShine 4s infinite;
        }

        @keyframes profileShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
            100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 40px;
            background: rgba(255, 255, 255, 0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 900;
            margin: 0 auto 18px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 2;
            transition: var(--transition);
        }

        .nav-menu {
            list-style: none;
            padding: 0;
        }

        .nav-item {
            margin-bottom: 12px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 18px;
            padding: 18px 24px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 18px;
            font-weight: 700;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            transition: var(--transition);
            z-index: 0;
        }

        .nav-link:hover::before,
        .nav-link.active::before {
            left: 0;
        }

        .nav-link:hover,
        .nav-link.active {
            color: white;
            transform: translateX(10px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0, 122, 255, 0.4);
        }

        .nav-icon {
            font-size: 22px;
            width: 28px;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .nav-link span:last-child {
            position: relative;
            z-index: 1;
        }

        .main-content {
            margin-left: 320px;
            padding: 40px;
            min-height: 100vh;
        }

        .page-header {
            margin-bottom: 40px;
            color: white;
            text-align: center;
            position: relative;
        }

        .page-title {
            font-size: 4rem;
            font-weight: 900;
            margin-bottom: 15px;
            text-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            letter-spacing: -3px;
            animation: titleFloat 6s ease-in-out infinite;
            background: linear-gradient(135deg, #FFD700, #FFA500, #FFD700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-15px) scale(1.05); }
        }

        .page-subtitle {
            font-size: 1.6rem;
            opacity: 0.95;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .campus-badge {
            display: inline-block;
            background: var(--gradient-success);
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            animation: badgePulse 2s infinite;
            box-shadow: 0 8px 20px rgba(0, 201, 255, 0.3);
        }

        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* **NEW: Enhanced Statistics Dashboard** */
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--gradient-primary);
            color: white;
            padding: 25px;
            border-radius: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            display: block;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 900;
            margin-bottom: 6px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card {
            background: var(--surface);
            border-radius: 25px;
            padding: 35px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 1px solid var(--system-gray5);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text-primary);
            font-size: 16px;
        }

        .form-control {
            width: 100%;
            padding: 18px 24px;
            border: 2px solid var(--system-gray4);
            border-radius: 18px;
            font-size: 16px;
            background: var(--surface);
            transition: var(--transition);
            font-family: inherit;
            font-weight: 500;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
            transform: translateY(-2px);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 25px;
        }

        /* **NEW: Professional Image Upload Section** */
        .image-upload-section {
            background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.1));
            border: 3px dashed var(--primary-blue);
            border-radius: 20px;
            padding: 30px;
            margin: 25px 0;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .image-upload-section:hover {
            border-color: var(--primary-purple);
            background: linear-gradient(135deg, rgba(88, 86, 214, 0.15), rgba(0, 122, 255, 0.15));
            transform: translateY(-3px);
        }

        .image-upload-section.has-images {
            border-style: solid;
            background: linear-gradient(135deg, rgba(52, 199, 89, 0.1), rgba(52, 199, 89, 0.05));
            border-color: var(--success-green);
        }

        .upload-icon {
            font-size: 64px;
            margin-bottom: 20px;
            display: block;
            animation: uploadFloat 3s ease-in-out infinite;
        }

        @keyframes uploadFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .upload-text {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .upload-subtext {
            font-size: 14px;
            color: var(--system-gray);
            font-weight: 500;
        }

        #imageUpload {
            display: none;
        }

        .image-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .image-preview {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            transition: var(--transition);
        }

        .image-preview:hover {
            transform: scale(1.05);
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 25px;
            height: 25px;
            background: var(--danger-red);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .image-remove:hover {
            transform: scale(1.2);
            background: #e74c3c;
        }

        .btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 18px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 122, 255, 0.4);
        }

        .btn-success {
            background: var(--gradient-success);
        }

        .btn-small {
            padding: 12px 20px;
            font-size: 14px;
        }

        /* **NEW: Enhanced Marketplace Grid** */
        .marketplace-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .marketplace-item {
            background: var(--surface);
            border-radius: 25px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 2px solid var(--system-gray5);
            position: relative;
        }

        .marketplace-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .marketplace-item:hover::before {
            transform: scaleX(1);
        }

        .marketplace-item:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            border-color: var(--primary-blue);
        }

        /* **NEW: Enhanced Image Display** */
        .item-image-container {
            position: relative;
            height: 250px;
            overflow: hidden;
            background: linear-gradient(135deg, var(--system-gray6), var(--system-gray5));
        }

        .item-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .item-image-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
            color: var(--system-gray);
            background: linear-gradient(135deg, #f8f9ff, #e8f0ff);
        }

        .image-gallery-indicator {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .seller-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--gradient-success);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .item-info {
            padding: 25px;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .item-title {
            font-size: 20px;
            font-weight: 900;
            color: var(--text-primary);
            flex: 1;
            margin-right: 15px;
        }

        .verified-seller {
            background: var(--success-green);
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .item-price {
            font-size: 28px;
            font-weight: 900;
            background: var(--gradient-success);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
        }

        .item-description {
            color: var(--system-gray);
            font-size: 15px;
            line-height: 1.6;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .item-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 13px;
            color: var(--system-gray);
            margin-bottom: 20px;
            padding: 15px;
            background: var(--system-gray6);
            border-radius: 15px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
        }

        .condition-badge {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: var(--system-gray6);
            color: var(--text-secondary);
        }

        .condition-new { background: linear-gradient(135deg, #FFD700, #FFA500); color: white; }
        .condition-excellent { background: linear-gradient(135deg, #00C9FF, #92FE9D); color: white; }
        .condition-good { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .condition-fair { background: linear-gradient(135deg, #FC466B, #3F5EFB); color: white; }

        .item-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .negotiable-badge {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .negotiable-yes {
            background: rgba(52, 199, 89, 0.15);
            color: var(--success-green);
            border: 2px solid var(--success-green);
        }

        .negotiable-no {
            background: rgba(255, 59, 48, 0.15);
            color: var(--danger-red);
            border: 2px solid var(--danger-red);
        }

        .empty-state {
            text-align: center;
            padding: 80px 40px;
            color: var(--system-gray);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 25px;
            border: 3px dashed var(--system-gray4);
        }

        .empty-icon {
            font-size: 80px;
            margin-bottom: 25px;
            opacity: 0.7;
            animation: emptyFloat 3s ease-in-out infinite;
        }

        @keyframes emptyFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* **NEW: Flash Message Enhancement** */
        .flash-message {
            position: fixed;
            top: 30px;
            right: 30px;
            background: white;
            padding: 25px 30px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            border-left: 6px solid var(--success-green);
            z-index: 2000;
            max-width: 450px;
            font-weight: 700;
            animation: slideInRight 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            font-size: 16px;
            line-height: 1.5;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%) scale(0.8);
                opacity: 0;
            }
            to {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
            to {
                transform: translateX(100%) scale(0.8);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.4s ease;
            }
            
            .main-content {
                margin-left: 0;
                padding: 25px;
            }
            
            .form-row, .form-row-3 {
                grid-template-columns: 1fr;
            }
            
            .marketplace-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-overview {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }
            
            .page-title {
                font-size: 2.8rem;
            }

            .image-preview-container {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            }

            .image-preview {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>
<body>
    <!-- Enhanced Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">üéí Backpack Optimizer</div>
            <div class="tagline">Elite Campus Marketplace</div>
        </div>
        
        <div class="user-profile">
            <div class="user-avatar" id="userAvatar">A</div>
            <div id="userName" style="font-size: 20px; font-weight: 800;">Loading...</div>
            <div id="userCampus" style="font-size: 14px; opacity: 0.9;">Loading...</div>
            <div style="font-size: 12px; margin-top: 8px; opacity: 0.8;" id="userRegNumber">Loading...</div>
            <div style="font-size: 13px; margin-top: 12px; background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 12px;">üè™ Marketplace Pro</div>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a href="dashboard.html" class="nav-link">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="expenses.html" class="nav-link">
                    <span class="nav-icon">üí∏</span>
                    <span>My Expenses</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="add-expense.html" class="nav-link">
                    <span class="nav-icon">‚ûï</span>
                    <span>Add Expense</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="wishboard.html" class="nav-link">
                    <span class="nav-icon">‚≠ê</span>
                    <span>Wishboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="marketplace.html" class="nav-link active">
                    <span class="nav-icon">üõí</span>
                    <span>Marketplace</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="housing.html" class="nav-link">
                    <span class="nav-icon">üè†</span>
                    <span>Housing</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="analytics.html" class="nav-link">
                    <span class="nav-icon">üìà</span>
                    <span>Analytics</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="profile.html" class="nav-link">
                    <span class="nav-icon">üë§</span>
                    <span>Profile</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="logout()">
                    <span class="nav-icon">üö™</span>
                    <span>Logout</span>
                </a>
            </li>
        </ul>
    </div>

    <!-- Enhanced Main Content -->
    <div class="main-content">
        <div class="page-header">
            <h1 class="page-title">üõí Elite Campus Marketplace</h1>
            <p class="page-subtitle">Buy and sell exclusively with your campus community</p>
            <div class="campus-badge" id="campusBadge">üèõÔ∏è Christ University Exclusive</div>
        </div>

        <!-- **NEW: Enhanced Statistics Overview** -->
        <div class="stats-overview">
            <div class="stat-card" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                <span class="stat-icon">üõçÔ∏è</span>
                <div class="stat-value" id="totalItems">0</div>
                <div class="stat-label">Items Available</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                <span class="stat-icon">üí∞</span>
                <div class="stat-value" id="avgPrice">‚Çπ0</div>
                <div class="stat-label">Average Price</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                <span class="stat-icon">üè™</span>
                <div class="stat-value" id="totalSellers">0</div>
                <div class="stat-label">Active Sellers</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
                <span class="stat-icon">üëÅÔ∏è</span>
                <div class="stat-value" id="totalViews">0</div>
                <div class="stat-label">Total Views</div>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #FFD700, #FFA500);">
                <span class="stat-icon">üéì</span>
                <div class="stat-value" id="campusOnly">100%</div>
                <div class="stat-label">Campus Only</div>
            </div>
        </div>

        <!-- Enhanced Sell Item Form -->
        <div class="card">
            <h3 style="margin-bottom: 25px; font-size: 24px; font-weight: 900;">üè∑Ô∏è List Your Item for Sale</h3>
            <form id="sellItemForm" onsubmit="sellItem(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="itemTitle">üìù Item Title</label>
                        <input type="text" class="form-control" id="itemTitle" placeholder="e.g., iPhone 14 Pro Max 256GB Space Black" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="itemPrice">üí∞ Price (‚Çπ)</label>
                        <input type="number" class="form-control" id="itemPrice" placeholder="0.00" step="0.01" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="itemCategory">üìÇ Category</label>
                        <select class="form-control" id="itemCategory" required>
                            <option value="electronics">üì± Electronics & Gadgets</option>
                            <option value="books">üìö Books & Study Materials</option>
                            <option value="furniture">ü™ë Furniture & Decor</option>
                            <option value="clothing">üëï Clothing & Fashion</option>
                            <option value="sports">‚öΩ Sports & Fitness</option>
                            <option value="vehicles">üöó Vehicles & Accessories</option>
                            <option value="musical">üéµ Musical Instruments</option>
                            <option value="other">üåü Other Items</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="itemCondition">‚ú® Condition</label>
                        <select class="form-control" id="itemCondition" required>
                            <option value="new">‚ú® Brand New - Never Used</option>
                            <option value="excellent">üåü Excellent - Like New</option>
                            <option value="good">üëç Good - Minor Usage</option>
                            <option value="fair">üëå Fair - Well Used</option>
                        </select>
                    </div>
                </div>

                <!-- **NEW: Professional Image Upload Section** -->
                <div class="form-group">
                    <label class="form-label">üì∏ Product Images</label>
                    <div class="image-upload-section" id="imageUploadSection" onclick="document.getElementById('imageUpload').click()">
                        <span class="upload-icon">üì∏</span>
                        <div class="upload-text">Click to Add Product Images</div>
                        <div class="upload-subtext">Add up to 5 high-quality photos (JPG, PNG, WebP - Max 5MB each)</div>
                        <input type="file" id="imageUpload" multiple accept="image/*" onchange="handleImageUpload(event)">
                        <div class="image-preview-container" id="imagePreviewContainer"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="itemDescription">üìÑ Detailed Description</label>
                    <textarea class="form-control" id="itemDescription" rows="5" placeholder="Provide a comprehensive description including:
‚Ä¢ Specifications and features
‚Ä¢ Current condition and any defects
‚Ä¢ Reason for selling
‚Ä¢ Purchase date and warranty info
‚Ä¢ Original accessories included
‚Ä¢ Any additional details buyers should know..." required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="itemContact">üìû Contact Information</label>
                        <input type="text" class="form-control" id="itemContact" placeholder="WhatsApp: +91-9876543210 or Email: your.email@domain.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="itemNegotiable">üí¨ Price Negotiation</label>
                        <select class="form-control" id="itemNegotiable">
                            <option value="yes">‚úÖ Open to reasonable negotiations</option>
                            <option value="no">‚ùå Fixed price - no negotiations</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-success" style="padding: 20px 40px; font-size: 18px;">
                    üè∑Ô∏è List Item on Marketplace
                </button>
            </form>
        </div>

        <!-- Enhanced Browse Items -->
        <div class="card">
            <h3 style="margin-bottom: 25px; font-size: 24px; font-weight: 900;">üîç Browse Campus Items</h3>
            <div class="form-row-3">
                <div class="form-group">
                    <label class="form-label" for="searchItems">üîç Search Items</label>
                    <input type="text" class="form-control" id="searchItems" placeholder="Search by title, description, or seller..." onkeyup="filterItems()">
                </div>
                <div class="form-group">
                    <label class="form-label" for="categoryFilter">üìÇ Category Filter</label>
                    <select class="form-control" id="categoryFilter" onchange="filterItems()">
                        <option value="all">All Categories</option>
                        <option value="electronics">üì± Electronics</option>
                        <option value="books">üìö Books</option>
                        <option value="furniture">ü™ë Furniture</option>
                        <option value="clothing">üëï Clothing</option>
                        <option value="sports">‚öΩ Sports</option>
                        <option value="vehicles">üöó Vehicles</option>
                        <option value="musical">üéµ Musical</option>
                        <option value="other">üåü Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="priceSort">üí∞ Sort By</label>
                    <select class="form-control" id="priceSort" onchange="filterItems()">
                        <option value="newest">üÜï Newest Listings</option>
                        <option value="price-low">üí∞ Price: Low to High</option>
                        <option value="price-high">üíé Price: High to Low</option>
                        <option value="popular">üëÅÔ∏è Most Viewed</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Enhanced Marketplace Items Display -->
        <div class="card">
            <h3 style="margin-bottom: 25px; font-size: 24px; font-weight: 900;">üõçÔ∏è Available Items (<span id="itemCount">0</span>)</h3>
            <div class="marketplace-grid" id="marketplaceGrid">
                <!-- Items will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // ‚úÖ CLEAN APPLICATION STATE WITH AUTHENTICATION CHECK
        let currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
        let marketplaceItems = JSON.parse(localStorage.getItem('backpack_marketplace') || '[]');
        let uploadedImages = [];

        // ‚úÖ CHECK AUTHENTICATION - REDIRECT IF NOT LOGGED IN
        if (!currentUser) {
            window.location.href = 'index.html';
            throw new Error('User not authenticated');
        }

        // ‚úÖ REAL USER PROFILE UPDATE - FIXED REG NUMBER
        function updateUserProfile() {
            const campusNames = {
                'CHRIST_BLR': 'Christ University - BCA',
                'DU_DELHI': 'Delhi University',
                'VIT_VEL': 'VIT Vellore', 
                'BITS_PIL': 'BITS Pilani',
                'IIT_BOM': 'IIT Bombay',
                'IIT_DEL': 'IIT Delhi'
            };

            const nameElement = document.getElementById('userName');
            const campusElement = document.getElementById('userCampus');
            const regElement = document.getElementById('userRegNumber');
            const avatarElement = document.getElementById('userAvatar');

            if (nameElement) nameElement.textContent = currentUser.fullName || 'Student';
            if (campusElement) campusElement.textContent = campusNames[currentUser.campus] || currentUser.campus || 'University';
            if (regElement) regElement.textContent = `Reg: ${currentUser.regNumber || 'Not provided'}`; // ‚úÖ FIXED - Shows real reg number
            if (avatarElement) avatarElement.textContent = (currentUser.fullName || 'S')[0].toUpperCase();
            
            // Update campus badge
            const campusBadgeNames = {
                'CHRIST_BLR': 'Christ University Exclusive',
                'DU_DELHI': 'Delhi University Exclusive',
                'VIT_VEL': 'VIT Vellore Exclusive',
                'BITS_PIL': 'BITS Pilani Exclusive',
                'IIT_BOM': 'IIT Bombay Exclusive',
                'IIT_DEL': 'IIT Delhi Exclusive'
            };
            document.getElementById('campusBadge').textContent = `üèõÔ∏è ${campusBadgeNames[currentUser.campus] || 'Campus Exclusive'}`;
            
            console.log('‚úÖ User Profile Updated with REAL data:', {
                name: currentUser.fullName,
                regNumber: currentUser.regNumber, // This shows actual user input
                campus: currentUser.campus
            });
        }

        // Initialize enhanced sample data with campus restriction - KEEP PREDEFINED ITEMS
        if (marketplaceItems.filter(item => item.campus === currentUser.campus).length === 0) {
            marketplaceItems = [
                {
                    id: Date.now() + 1001,
                    sellerId: 'student_999',
                    sellerName: "Priya Sharma",
                    campus: "CHRIST_BLR",
                    course: "MBA",
                    title: "MacBook Pro M2 (16GB, 512GB) - Perfect for Coding",
                    price: 189900,
                    category: "electronics",
                    condition: "excellent",
                    description: "Barely used MacBook Pro with M2 chip, 16GB RAM, and 512GB SSD. Perfect for programming, design work, and heavy multitasking. Includes original box, charger, and AppleCare+ warranty till Dec 2024. Selling due to company laptop provision.",
                    contact: "WhatsApp: +91-9876543210 | Email: priya.sharma@christuniversity.in",
                    negotiable: "yes",
                    images: [], // In real implementation, these would be base64 or URLs
                    views: 127,
                    verified: true,
                    createdAt: new Date(Date.now() - 86400000).toISOString()
                },
                {
                    id: Date.now() + 1002,
                    sellerId: 'student_998',
                    sellerName: "Rahul Kumar",
                    campus: "CHRIST_BLR",
                    course: "BCA",
                    title: "Gaming Setup - Chair + Desk + LED Strips",
                    price: 8500,
                    category: "furniture",
                    condition: "good",
                    description: "Complete gaming setup including ergonomic gaming chair, spacious desk, and RGB LED strips. Perfect for hostel rooms or apartments. Chair has minor wear but very comfortable. Desk is sturdy with cable management. Moving out of city, need to sell urgently!",
                    contact: "WhatsApp: +91-8765432109",
                    negotiable: "yes",
                    images: [],
                    views: 89,
                    verified: true,
                    createdAt: new Date(Date.now() - 172800000).toISOString()
                },
                {
                    id: Date.now() + 1003,
                    sellerId: 'student_997',
                    sellerName: "Sneha Patel",
                    campus: "CHRIST_BLR",
                    course: "B.Com",
                    title: "Complete BCA Textbooks Bundle - All 3 Years",
                    price: 4500,
                    category: "books",
                    condition: "good",
                    description: "Complete collection of BCA textbooks covering all 6 semesters. Includes Programming in C++, Data Structures, Database Management, Software Engineering, Computer Networks, and more. All books have my notes and highlights. Great for new BCA students!",
                    contact: "Email: sneha.patel@christuniversity.in",
                    negotiable: "no",
                    images: [],
                    views: 156,
                    verified: true,
                    createdAt: new Date(Date.now() - 259200000).toISOString()
                },
                {
                    id: Date.now() + 1004,
                    sellerId: 'student_996',
                    sellerName: "Arjun Singh",
                    campus: "CHRIST_BLR",
                    course: "MCA",
                    title: "iPhone 13 Pro Max 256GB - Excellent Condition",
                    price: 89999,
                    category: "electronics",
                    condition: "excellent",
                    description: "iPhone 13 Pro Max in pristine condition. Always used with screen protector and case. Battery health at 94%. Includes original box, unused EarPods, charger, and premium leather case worth ‚Çπ5000. No scratches or dents. Upgrading to iPhone 15 Pro.",
                    contact: "WhatsApp: +91-7654321098 | Email: arjun.singh@mca.christuniversity.in",
                    negotiable: "yes",
                    images: [],
                    views: 203,
                    verified: true,
                    createdAt: new Date(Date.now() - 345600000).toISOString()
                },
                {
                    id: Date.now() + 1005,
                    sellerId: 'student_995',
                    sellerName: "Ananya Reddy",
                    campus: "CHRIST_BLR",
                    course: "MBA",
                    title: "Royal Enfield Classic 350 - Well Maintained",
                    price: 145000,
                    category: "vehicles",
                    condition: "good",
                    description: "2019 Royal Enfield Classic 350 in excellent running condition. Regular servicing done at authorized service center. New tires fitted last month. Insurance valid till March 2024. Perfect for campus commuting and weekend rides. Selling due to relocation abroad for job.",
                    contact: "WhatsApp: +91-6543210987",
                    negotiable: "yes",
                    images: [],
                    views: 67,
                    verified: true,
                    createdAt: new Date(Date.now() - 432000000).toISOString()
                }
            ];
            localStorage.setItem('backpack_marketplace', JSON.stringify(marketplaceItems));
        }

        // **NEW: Enhanced statistics calculation**
        function updateStatistics() {
            const campusItems = marketplaceItems.filter(item => item.campus === currentUser.campus);
            const totalViews = campusItems.reduce((sum, item) => sum + item.views, 0);
            const avgPrice = campusItems.length > 0 ? campusItems.reduce((sum, item) => sum + item.price, 0) / campusItems.length : 0;
            const uniqueSellers = new Set(campusItems.map(item => item.sellerId)).size;

            // Animate values
            animateValue('totalItems', 0, campusItems.length, 1000);
            animateValue('avgPrice', 0, avgPrice, 1500, '‚Çπ');
            animateValue('totalSellers', 0, uniqueSellers, 1000);
            animateValue('totalViews', 0, totalViews, 1500);

            document.getElementById('itemCount').textContent = campusItems.length;
        }

        // **NEW: Professional Image Upload Handler**
        function handleImageUpload(event) {
            const files = Array.from(event.target.files);
            const maxFiles = 5;
            const maxSize = 5 * 1024 * 1024; // 5MB

            if (files.length > maxFiles) {
                showFlashMessage(`‚ùå Maximum ${maxFiles} images allowed. Please select fewer images.`, 'error');
                return;
            }

            files.forEach(file => {
                if (file.size > maxSize) {
                    showFlashMessage(`‚ùå Image "${file.name}" is too large. Please use images under 5MB.`, 'error');
                    return;
                }

                if (!file.type.startsWith('image/')) {
                    showFlashMessage(`‚ùå "${file.name}" is not a valid image file.`, 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImages.push({
                        name: file.name,
                        data: e.target.result,
                        size: file.size
                    });
                    updateImagePreview();
                };
                reader.readAsDataURL(file);
            });
        }

        function updateImagePreview() {
            const container = document.getElementById('imagePreviewContainer');
            const uploadSection = document.getElementById('imageUploadSection');
            
            if (uploadedImages.length > 0) {
                uploadSection.classList.add('has-images');
                uploadSection.querySelector('.upload-text').textContent = `${uploadedImages.length} image(s) selected`;
                uploadSection.querySelector('.upload-subtext').textContent = 'Click to add more images or drag to reorder';
            } else {
                uploadSection.classList.remove('has-images');
                uploadSection.querySelector('.upload-text').textContent = 'Click to Add Product Images';
                uploadSection.querySelector('.upload-subtext').textContent = 'Add up to 5 high-quality photos (JPG, PNG, WebP - Max 5MB each)';
            }

            container.innerHTML = uploadedImages.map((image, index) => `
                <div class="image-preview">
                    <img src="${image.data}" alt="Product image ${index + 1}">
                    <button class="image-remove" onclick="removeImage(${index})" title="Remove image">√ó</button>
                </div>
            `).join('');
        }

        function removeImage(index) {
            uploadedImages.splice(index, 1);
            updateImagePreview();
            showFlashMessage('üóëÔ∏è Image removed successfully!');
        }

        function sellItem(event) {
            event.preventDefault();
            
            const title = document.getElementById('itemTitle').value;
            const price = parseFloat(document.getElementById('itemPrice').value);
            const category = document.getElementById('itemCategory').value;
            const condition = document.getElementById('itemCondition').value;
            const description = document.getElementById('itemDescription').value;
            const contact = document.getElementById('itemContact').value;
            const negotiable = document.getElementById('itemNegotiable').value;

            if (uploadedImages.length === 0) {
                showFlashMessage('üì∏ Please add at least one product image to make your listing more attractive!', 'warning');
                return;
            }

            const item = {
                id: Date.now(),
                sellerId: currentUser.id,
                sellerName: currentUser.fullName || currentUser.username,
                campus: currentUser.campus,
                course: currentUser.course || 'BCA',
                title,
                price,
                category,
                condition,
                description,
                contact,
                negotiable,
                images: [...uploadedImages], // Store images with item
                views: 0,
                verified: true,
                createdAt: new Date().toISOString()
            };

            marketplaceItems.push(item);
            localStorage.setItem('backpack_marketplace', JSON.stringify(marketplaceItems));
            
            updateMarketplace();
            updateStatistics();
            showFlashMessage(`üè∑Ô∏è "${title}" listed successfully on ${currentUser.campus} marketplace! üéâ Get ready for interested buyers! üì¶`);
            
            // Clear form and reset images
            document.getElementById('sellItemForm').reset();
            uploadedImages = [];
            updateImagePreview();
        }

        function filterItems() {
            const searchTerm = document.getElementById('searchItems').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            const sort = document.getElementById('priceSort').value;

            // Only show items from same campus
            let filteredItems = marketplaceItems.filter(item => 
                item.campus === currentUser.campus &&
                (category === 'all' || item.category === category) &&
                (searchTerm === '' || 
                 item.title.toLowerCase().includes(searchTerm) || 
                 item.description.toLowerCase().includes(searchTerm) ||
                 item.sellerName.toLowerCase().includes(searchTerm))
            );

            // Apply sorting
            const sortFunctions = {
                'newest': (a, b) => new Date(b.createdAt) - new Date(a.createdAt),
                'price-low': (a, b) => a.price - b.price,
                'price-high': (a, b) => b.price - a.price,
                'popular': (a, b) => b.views - a.views
            };

            filteredItems.sort(sortFunctions[sort]);
            displayItems(filteredItems);
        }

        function displayItems(items) {
            const container = document.getElementById('marketplaceGrid');

            if (items.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-icon">üõçÔ∏è</div>
                        <div style="font-size: 28px; font-weight: 900; margin-bottom: 15px; color: var(--text-primary);">No Items Found</div>
                        <div style="font-size: 18px; margin-bottom: 25px;">Try adjusting your search or filter criteria</div>
                        <div style="font-size: 16px; color: var(--system-gray);">Be the first to list an item in this category! üöÄ</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = items.map(item => {
                const mainImage = item.images && item.images.length > 0 ? item.images[0].data : null;
                const imageCount = item.images ? item.images.length : 0;

                return `
                    <div class="marketplace-item">
                        <div class="item-image-container">
                            ${mainImage ? 
                                `<img src="${mainImage}" alt="${item.title}" class="item-image">` :
                                `<div class="item-image-placeholder">${getCategoryIcon(item.category, false)}</div>`
                            }
                            ${imageCount > 1 ? `<div class="image-gallery-indicator">üì∏ ${imageCount} photos</div>` : ''}
                            <div class="seller-badge">${item.course || 'Student'}</div>
                        </div>
                        <div class="item-info">
                            <div class="item-header">
                                <div class="item-title">${item.title}</div>
                                ${item.verified ? '<div class="verified-seller">‚úÖ Verified</div>' : ''}
                            </div>
                            <div class="item-price">‚Çπ${item.price.toLocaleString('en-IN')}</div>
                            <div class="item-description">${item.description || 'No description provided'}</div>
                            
                            <div class="item-meta">
                                <div class="meta-item">
                                    <span class="condition-badge condition-${item.condition}">
                                        ${getConditionIcon(item.condition)} ${item.condition.toUpperCase()}
                                    </span>
                                </div>
                                <div class="meta-item">
                                    üëÅÔ∏è ${item.views} views
                                </div>
                                <div class="meta-item">
                                    üìÖ ${formatDate(item.createdAt)}
                                </div>
                                <div class="meta-item">
                                    üë§ ${item.sellerName}
                                </div>
                            </div>
                            
                            <div class="item-actions">
                                <button class="btn btn-success btn-small" onclick="contactSeller(${item.id})" style="flex: 1;">
                                    üí¨ Contact Seller
                                </button>
                                <div class="negotiable-badge ${item.negotiable === 'yes' ? 'negotiable-yes' : 'negotiable-no'}">
                                    ${item.negotiable === 'yes' ? 'üí¨ Negotiable' : 'üíé Fixed Price'}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateMarketplace() {
            filterItems(); // This will display all items with current filters
            updateStatistics();
        }

        function contactSeller(itemId) {
            const item = marketplaceItems.find(i => i.id === itemId);
            if (!item) return;

            // Increment view count
            item.views += 1;
            localStorage.setItem('backpack_marketplace', JSON.stringify(marketplaceItems));

            const message = `Hi ${item.sellerName}! üëã\n\nI'm interested in your "${item.title}" listed for ‚Çπ${item.price.toLocaleString('en-IN')} on the Christ University marketplace.\n\nIs it still available? ${item.negotiable === 'yes' ? 'Also, is the price negotiable?' : ''}\n\nLooking forward to hearing from you!\n\nBest regards,\n${currentUser.fullName || currentUser.username}\n${currentUser.course || 'BCA'} Student`;

            if (item.contact.includes('@')) {
                const email = item.contact.match(/[\w\.-]+@[\w\.-]+\.\w+/)[0];
                window.open(`mailto:${email}?subject=Interested in ${item.title} - Marketplace&body=${encodeURIComponent(message)}`);
                showFlashMessage('üìß Opening email client... Happy negotiating! üí¨');
            } else if (item.contact.includes('WhatsApp') || item.contact.includes('+91')) {
                const phone = item.contact.match(/\+91[-\s]?[6-9]\d{9}|\b[6-9]\d{9}\b/)[0].replace(/\D/g, '');
                window.open(`https://wa.me/91${phone}?text=${encodeURIComponent(message)}`);
                showFlashMessage('üì± Opening WhatsApp... Happy chatting! üíö');
            } else {
                showFlashMessage('üìû Contact information copied to clipboard!');
                navigator.clipboard.writeText(item.contact);
            }

            updateMarketplace(); // Refresh to show updated view count
        }

        function getCategoryIcon(category, large = true) {
            const icons = {
                electronics: 'üì±',
                books: 'üìö',
                furniture: 'ü™ë',
                clothing: 'üëï',
                sports: '‚öΩ',
                vehicles: 'üöó',
                musical: 'üéµ',
                other: 'üåü'
            };
            const icon = icons[category] || 'üåü';
            return large ? `<div style="font-size: 64px;">${icon}</div>` : icon;
        }

        function getConditionIcon(condition) {
            const icons = {
                new: '‚ú®',
                excellent: 'üåü',
                good: 'üëç',
                fair: 'üëå'
            };
            return icons[condition] || 'üëå';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays === 1) return 'Yesterday';
            if (diffDays === 0) return 'Today';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.ceil(diffDays/7)} weeks ago`;

            return date.toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // **NEW: Enhanced value animation**
        function animateValue(elementId, start, end, duration, prefix = '', suffix = '') {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const range = end - start;
            const startTime = Date.now();
            
            const updateValue = () => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const current = start + (range * progress);
                
                if (suffix === '%') {
                    element.textContent = prefix + Math.round(current) + suffix;
                } else {
                    element.textContent = prefix + Math.round(current).toLocaleString('en-IN') + suffix;
                }
                
                if (progress < 1) {
                    requestAnimationFrame(updateValue);
                }
            };
            
            updateValue();
        }

        function showFlashMessage(message, type = 'success') {
            const existingFlash = document.querySelector('.flash-message');
            if (existingFlash) {
                existingFlash.remove();
            }

            const flash = document.createElement('div');
            flash.className = 'flash-message';
            if (type === 'error') {
                flash.style.borderLeftColor = 'var(--danger-red)';
            } else if (type === 'warning') {
                flash.style.borderLeftColor = 'var(--warning-orange)';
            }
            
            flash.innerHTML = `
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span style="font-size: 28px;">
                        ${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è'}
                    </span>
                    <span style="flex: 1; font-size: 16px; line-height: 1.5;">${message}</span>
                    <span onclick="this.parentElement.parentElement.remove()" style="cursor: pointer; font-size: 28px; font-weight: bold; opacity: 0.7; transition: opacity 0.3s; padding: 5px;">&times;</span>
                </div>
            `;
            
            document.body.appendChild(flash);
            
            setTimeout(() => {
                if (flash.parentNode) {
                    flash.style.animation = 'slideOutRight 0.6s ease forwards';
                    setTimeout(() => flash.remove(), 600);
                }
            }, 7000);
        }

        function logout() {
            if (confirm(`Are you sure you want to logout, ${currentUser.fullName || 'Student'}?\n\nYour marketplace listings will remain active! üõçÔ∏è`)) {
                localStorage.removeItem('currentUser');
                showFlashMessage('Logged out successfully! Your items are still listed for campus buyers! See you soon! üëã');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            }
        }

        // ‚úÖ CLEAN INITIALIZATION - KEEP PREDEFINED MARKETPLACE ITEMS
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üõí Marketplace Loading with REAL user profile but keeping predefined items...');
            
            updateUserProfile();
            updateMarketplace();
            
            console.log('‚úÖ Marketplace loaded successfully!');
            console.log('‚úÖ Real user profile with registration number:', currentUser.regNumber);
            console.log('‚úÖ Predefined marketplace items: KEPT as requested');
            console.log('‚úÖ Professional image upload: ACTIVE');
        });
    </script>
</body>
</html>
