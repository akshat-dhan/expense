<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéí Backpack Optimizer - Ultimate AI Financial Dashboard</title>
    
    <!-- Chart.js and PDF Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    
    <!-- üìÑ PDF Libraries for Working Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
    --primary-blue: #007AFF;
    --primary-purple: #5856D6;
    --success-green: #34C759;
    --danger-red: #FF3B30;
    --warning-orange: #FF9500;
    --info-cyan: #5AC8FA;
    --system-gray: #8E8E93;
    --system-gray2: #AEAEB2;
    --system-gray3: #C7C7CC;
    --system-gray4: #D1D1D6;
    --system-gray5: #E5E5EA;
    --system-gray6: #F2F2F7;
    --surface: #FFFFFF;
    --surface-secondary: #F9F9FB;
    --text-primary: #1C1C1E;
    --text-secondary: #3A3A3C;
    --text-tertiary: #8E8E93;
    --border-radius: 20px;
    --shadow-light: 0 4px 20px rgba(0, 0, 0, 0.08);
    --shadow: 0 8px 40px rgba(0, 0, 0, 0.12);
    --shadow-heavy: 0 16px 60px rgba(0, 0, 0, 0.20);
    --transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    --transition-fast: all 0.2s cubic-bezier(0.23, 1, 0.32, 1);
    --gradient-primary: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
    --gradient-success: linear-gradient(135deg, #00C9FF, #92FE9D);
    --gradient-warning: linear-gradient(135deg, #FC466B, #3F5EFB);
    --gradient-info: linear-gradient(135deg, #667eea, #764ba2);
    --gradient-gold: linear-gradient(135deg, #FFD700, #FF8C00);
    --gradient-rainbow: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #ffecd2 75%, #fcb69f 100%);
    --blur-light: blur(20px);
    --blur-heavy: blur(40px);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'SF Pro Display', Roboto, 'Helvetica Neue', sans-serif;
    background: var(--gradient-rainbow);
    background-attachment: fixed;
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* üåü DYNAMIC BACKGROUND ANIMATION */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(0, 122, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(255, 59, 48, 0.05) 0%, transparent 50%);
    z-index: -1;
    animation: backgroundShift 20s ease-in-out infinite alternate;
}

@keyframes backgroundShift {
    0% { transform: translateX(0) translateY(0) rotate(0deg); }
    100% { transform: translateX(20px) translateY(-20px) rotate(1deg); }
}
/* üì± MOBILE HAMBURGER MENU BUTTON */
.mobile-menu-toggle {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1001;
    width: 50px;
    height: 50px;
    background: var(--gradient-primary);
    border-radius: 50%;
    display: none; /* Hidden on desktop */
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 122, 255, 0.4);
    transition: all 0.3s ease;
}

.mobile-menu-toggle:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(0, 122, 255, 0.6);
}

.hamburger {
    width: 24px;
    height: 18px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.hamburger span {
    width: 100%;
    height: 3px;
    background: white;
    border-radius: 2px;
    transition: all 0.3s ease;
}

/* üì± HAMBURGER ANIMATION WHEN OPEN */
.mobile-menu-toggle.active .hamburger span:nth-child(1) {
    transform: rotate(45deg) translate(6px, 6px);
}

.mobile-menu-toggle.active .hamburger span:nth-child(2) {
    opacity: 0;
}

.mobile-menu-toggle.active .hamburger span:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
}

/* üì± MOBILE OVERLAY */
.mobile-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
    display: none;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.mobile-overlay.show {
    display: block;
    opacity: 1;
}

/* üì± MOBILE RESPONSIVE SIDEBAR */
@media (max-width: 768px) {
    /* Show mobile menu button */
    .mobile-menu-toggle {
        display: flex !important;
    }
    
    /* Hide sidebar by default */
    .sidebar {
        transform: translateX(-100%);
        transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        width: 300px; /* Slightly smaller on mobile */
    }
    
    /* Show sidebar when open */
    .sidebar.mobile-open {
        transform: translateX(0);
    }
    
    /* Adjust main content */
    .main-content {
        margin-left: 0 !important;
        padding: 80px 25px 25px 25px !important; /* Extra top padding for menu button */
    }
    
    /* Adjust other fixed elements */
    .ai-trigger {
        bottom: 20px !important;
        right: 20px !important;
    }
    
    .ai-chat {
        width: 95% !important;
        height: 85vh !important;
        bottom: 10px !important;
        right: 2.5% !important;
        left: 2.5% !important;
    }
    
    /* Fix for form pages */
    .form-container {
        margin-left: 0 !important;
        padding: 80px 20px 20px 20px !important;
    }
}

@media (max-width: 480px) {
    .sidebar {
        width: 280px !important; /* Even smaller for very small screens */
    }
    
    .main-content {
        padding: 70px 15px 15px 15px !important;
    }
    
    .mobile-menu-toggle {
        width: 45px !important;
        height: 45px !important;
        top: 15px !important;
        left: 15px !important;
    }
}

/* üé® ENHANCED SIDEBAR WITH GLASSMORPHISM */
.sidebar {
    position: fixed;
    left: 0;
    top: 0;
    width: 350px;
    height: 100vh;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: var(--blur-heavy);
    -webkit-backdrop-filter: var(--blur-heavy);
    border-right: 1px solid rgba(255, 255, 255, 0.3);
    z-index: 1000;
    padding: 30px;
    overflow-y: auto;
    box-shadow: 10px 0 50px rgba(0, 0, 0, 0.15);
    transition: var(--transition);
}

.sidebar::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05));
    z-index: -1;
}

.sidebar-header {
    text-align: center;
    margin-bottom: 40px;
    padding-bottom: 30px;
    border-bottom: 2px solid rgba(0, 122, 255, 0.1);
    position: relative;
}

.logo {
    font-size: 42px;
    font-weight: 900;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 12px;
    letter-spacing: -2px;
    animation: logoGlow 3s ease-in-out infinite;
    text-shadow: 0 0 30px rgba(0, 122, 255, 0.3);
}

@keyframes logoGlow {
    0%, 100% { 
        filter: drop-shadow(0 0 10px rgba(0, 122, 255, 0.3));
        transform: scale(1);
    }
    50% { 
        filter: drop-shadow(0 0 20px rgba(0, 122, 255, 0.6));
        transform: scale(1.02);
    }
}

.tagline {
    font-size: 14px;
    color: var(--system-gray);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 2px;
    opacity: 0.8;
    background: linear-gradient(45deg, var(--primary-blue), var(--primary-purple));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.user-profile {
    background: var(--gradient-primary);
    border-radius: 25px;
    padding: 30px;
    margin-bottom: 30px;
    color: white;
    text-align: center;
    position: relative;
    overflow: hidden;
    box-shadow: 0 15px 35px rgba(0, 122, 255, 0.4);
    transform: translateZ(0);
}

.user-profile::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
    transform: rotate(45deg);
    animation: profileShine 4s infinite;
}

@keyframes profileShine {
    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
    50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
}

.user-avatar {
    width: 90px;
    height: 90px;
    border-radius: 45px;
    background: rgba(255, 255, 255, 0.25);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    font-weight: 900;
    margin: 0 auto 18px;
    border: 4px solid rgba(255, 255, 255, 0.3);
    position: relative;
    z-index: 2;
    transition: var(--transition);
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

.user-avatar:hover {
    transform: scale(1.1) rotate(5deg);
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
}

.sidebar-profile-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
}

.nav-menu {
    list-style: none;
    padding: 0;
}

.nav-item {
    margin-bottom: 12px;
}

.nav-link {
    display: flex;
    align-items: center;
    gap: 18px;
    padding: 18px 24px;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: 18px;
    font-weight: 700;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(10px);
}

.nav-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: var(--gradient-primary);
    transition: var(--transition);
    z-index: 0;
}

.nav-link:hover::before,
.nav-link.active::before {
    left: 0;
}

.nav-link:hover,
.nav-link.active {
    color: white;
    transform: translateX(10px) scale(1.02);
    box-shadow: 0 10px 30px rgba(0, 122, 255, 0.4);
}

.nav-icon {
    font-size: 24px;
    width: 30px;
    text-align: center;
    position: relative;
    z-index: 1;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
}

.nav-link span:last-child {
    position: relative;
    z-index: 1;
}

/* üéØ MAIN CONTENT AREA */
.main-content {
    margin-left: 350px;
    padding: 40px;
    min-height: 100vh;
    position: relative;
}

.page-header {
    margin-bottom: 40px;
    color: white;
    text-align: center;
    position: relative;
    z-index: 1;
}

.page-title {
    font-size: 4rem;
    font-weight: 900;
    margin-bottom: 15px;
    text-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
    letter-spacing: -2px;
    animation: titleFloat 6s ease-in-out infinite;
    background: linear-gradient(45deg, #ffffff, #f0f8ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

@keyframes titleFloat {
    0%, 100% { transform: translateY(0px) scale(1); }
    50% { transform: translateY(-10px) scale(1.02); }
}

.page-subtitle {
    font-size: 1.6rem;
    opacity: 0.95;
    font-weight: 500;
    animation: fadeInUp 1s ease-out;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ü§ñ ULTRA-ADVANCED AI INSIGHTS PANEL */
.ai-insights-panel {
    background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.1));
    backdrop-filter: var(--blur-light);
    border: 3px solid transparent;
    background-clip: padding-box;
    border-radius: 25px;
    padding: 35px;
    margin-bottom: 35px;
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow);
}

.ai-insights-panel::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: var(--gradient-primary);
    border-radius: 25px;
    z-index: -1;
    animation: borderGlow 3s ease-in-out infinite;
}

@keyframes borderGlow {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

.ai-insights-panel::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    animation: insightShine 3s infinite;
}

@keyframes insightShine {
    0% { left: -100%; }
    100% { left: 100%; }
}

.ai-insights-header {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
}

.ai-avatar {
    width: 70px;
    height: 70px;
    background: var(--gradient-primary);
    border-radius: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    color: white;
    animation: aiPulse 2s infinite;
    box-shadow: 0 8px 20px rgba(0, 122, 255, 0.4);
    position: relative;
    overflow: hidden;
}

.ai-avatar::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: rotate 2s linear infinite;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

@keyframes aiPulse {
    0%, 100% { 
        transform: scale(1); 
        box-shadow: 0 8px 20px rgba(0, 122, 255, 0.4);
    }
    50% { 
        transform: scale(1.1); 
        box-shadow: 0 12px 30px rgba(0, 122, 255, 0.6);
    }
}

.ai-insight-item {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: var(--blur-light);
    border-radius: 18px;
    padding: 25px;
    margin-bottom: 18px;
    border-left: 5px solid var(--primary-blue);
    transition: var(--transition);
    box-shadow: var(--shadow-light);
    position: relative;
    overflow: hidden;
}

.ai-insight-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(0, 122, 255, 0.1), transparent);
    transition: left 0.6s ease;
}

.ai-insight-item:hover::before {
    left: 100%;
}

.ai-insight-item:hover {
    transform: translateX(8px) scale(1.02);
    box-shadow: var(--shadow);
    border-left-color: var(--success-green);
}

/* üìä ADVANCED STATS GRID */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 30px;
    margin-bottom: 40px;
}

.stat-card {
    background: var(--gradient-primary);
    color: white;
    padding: 35px;
    border-radius: 25px;
    text-align: center;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow);
    cursor: pointer;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.6s;
}

.stat-card:hover::before {
    left: 100%;
}

.stat-card:hover {
    transform: translateY(-15px) scale(1.05);
    box-shadow: var(--shadow-heavy);
}

.stat-card:nth-child(1) { background: linear-gradient(135deg, #667eea, #764ba2); }
.stat-card:nth-child(2) { background: linear-gradient(135deg, #f093fb, #f5576c); }
.stat-card:nth-child(3) { background: linear-gradient(135deg, #4facfe, #00f2fe); }
.stat-card:nth-child(4) { background: linear-gradient(135deg, #43e97b, #38f9d7); }

.stat-icon {
    font-size: 4rem;
    margin-bottom: 20px;
    opacity: 0.9;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
    animation: iconFloat 3s ease-in-out infinite;
}

@keyframes iconFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-5px) rotate(5deg); }
}

.stat-value {
    font-size: 3.2rem;
    font-weight: 900;
    margin-bottom: 12px;
    position: relative;
    z-index: 2;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    animation: countUp 2s ease-out;
}

@keyframes countUp {
    from { transform: scale(0.5); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.stat-label {
    font-size: 1.2rem;
    opacity: 0.9;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    position: relative;
    z-index: 2;
}

.stat-trend {
    font-size: 1rem;
    margin-top: 8px;
    opacity: 0.8;
    position: relative;
    z-index: 2;
    background: rgba(255, 255, 255, 0.2);
    padding: 8px 15px;
    border-radius: 20px;
    margin-top: 15px;
}

/* üîß COMPACT METRICS GRID - SMALLER SIZE BUT READABLE */

/* üìä REDUCE HEIGHT OF METRIC CARDS - KEEP WIDTH SAME */
.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
}
/* üìä REDUCE HEIGHT ONLY - PERFECT BALANCE */
.metric-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: var(--blur-light);
    border-radius: 15px;
    padding: 16px 20px !important; /* Reduced vertical padding */
    box-shadow: var(--shadow-light);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    cursor: pointer;
    height: 120px !important; /* Fixed shorter height */
    max-height: 120px !important;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.metric-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px; /* Reduced spacing */
}

.metric-icon {
    font-size: 24px; /* Good readable size */
    padding: 8px;
    background: var(--gradient-primary);
    color: white;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0, 122, 255, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
}

.metric-value {
    font-size: 22px !important; /* Perfect readable size */
    font-weight: 800;
    color: var(--text-primary);
    text-align: right;
    line-height: 1;
}

.metric-label {
    font-size: 13px !important; /* Clear and readable */
    color: var(--text-tertiary);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 6px; /* Reduced spacing */
}

.metric-trend {
    font-size: 11px !important; /* Readable trend text */
    padding: 4px 8px;
    border-radius: 8px;
    font-weight: 600;
    display: inline-block;
}


.trend-up {
    background: rgba(52, 199, 89, 0.15);
    color: var(--success-green);
}

.trend-down {
    background: rgba(255, 59, 48, 0.15);
    color: var(--danger-red);
}

.trend-neutral {
    background: rgba(142, 142, 147, 0.15);
    color: var(--system-gray);
}

/* üì± RESPONSIVE - KEEP PROPORTIONS */
@media (max-width: 768px) {
    .metrics-grid {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 12px;
    }
    
    .metric-card {
        height: 80px !important;
        max-height: 80px !important;
        min-height: 80px !important;
        padding: 10px 15px !important;
    }
    
    .metric-icon {
        width: 28px !important;
        height: 28px !important;
        font-size: 16px !important;
    }
    
    .metric-value {
        font-size: 14px !important;
    }
}


.metric-label {
    font-size: 14px;
    color: var(--text-tertiary);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
}

.metric-trend {
    font-size: 12px;
    padding: 6px 12px;
    border-radius: 12px;
    font-weight: 600;
    display: inline-block;
}

.trend-up {
    background: rgba(52, 199, 89, 0.15);
    color: var(--success-green);
}

.trend-down {
    background: rgba(255, 59, 48, 0.15);
    color: var(--danger-red);
}

.trend-neutral {
    background: rgba(142, 142, 147, 0.15);
    color: var(--system-gray);
}

/* üìà ENHANCED CHARTS SECTION */
.charts-section {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 30px;
    margin-bottom: 40px;
}

.chart-container {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: var(--blur-light);
    border-radius: 25px;
    padding: 30px;
    box-shadow: var(--shadow);
    position: relative;
    overflow: hidden;
    transition: var(--transition);
}

.chart-container::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: var(--gradient-primary);
    border-radius: 25px;
    z-index: -1;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.chart-container:hover::before {
    opacity: 1;
}

.chart-container:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-heavy);
}

.chart-wrapper {
    position: relative;
    height: 400px;
    margin-top: 25px;
    width: 100%;
}

.chart-title {
    font-size: 1.4rem;
    font-weight: 900;
    color: var(--text-primary);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.chart-title::before {
    content: '';
    width: 4px;
    height: 30px;
    background: var(--gradient-primary);
    border-radius: 2px;
}

/* ü§ñ ULTIMATE CHATBOX WITH PROPER SIZING */
.ai-chat {
    position: fixed !important;
    bottom: 30px !important;
    right: 30px !important;
    left: auto !important;
    top: auto !important;
    width: 550px;
    height: 750px;
    max-height: 85vh;
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: var(--blur-heavy);
    border-radius: 25px;
    box-shadow: var(--shadow-heavy);
    z-index: 9999 !important;
    display: none;
    flex-direction: column;
    overflow: hidden;
    border: 2px solid rgba(255, 255, 255, 0.3);
    transform: translateY(20px) scale(0.95);
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.ai-chat.show {
    display: flex !important;
    transform: translateY(0) scale(1) !important;
    opacity: 1 !important;
}

.ai-chat-header {
    background: var(--gradient-primary);
    color: white;
    padding: 20px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    position: relative;
    overflow: hidden;
    min-height: 70px;
}

.ai-chat-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: headerShine 4s infinite;
}

@keyframes headerShine {
    0% { left: -100%; }
    100% { left: 100%; }
}

.ai-chat-title {
    font-weight: 800;
    font-size: 18px;
    display: flex;
    align-items: center;
    gap: 12px;
    position: relative;
    z-index: 2;
}

.ai-chat-subtitle {
    font-size: 12px;
    opacity: 0.9;
    margin-top: 3px;
    font-weight: 500;
}

.ai-chat-close {
    cursor: pointer;
    font-size: 28px;
    font-weight: bold;
    transition: var(--transition);
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    position: relative;
    z-index: 2;
}

.ai-chat-close:hover {
    transform: scale(1.2) rotate(90deg);
    background: rgba(255, 255, 255, 0.3);
}

.ai-status-bar {
    background: rgba(0, 122, 255, 0.1);
    padding: 10px 30px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 12px;
    color: var(--primary-blue);
    font-weight: 600;
}

.status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--success-green);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.2); }
}

/* üéØ ENHANCED QUICK ACTIONS WITH PROPER SIZING */
.quick-actions {
    padding: 18px 25px;
    border-bottom: 1px solid var(--system-gray5);
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    background: var(--surface-secondary);
    max-height: 120px;
    overflow-y: auto;
    align-items: center;
    justify-content: center;
}

.quick-action-btn {
    background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.1));
    border: 1px solid var(--primary-blue);
    color: var(--primary-blue);
    padding: 8px 14px;
    border-radius: 18px;
    font-size: 11px;
    cursor: pointer;
    transition: var(--transition);
    font-weight: 600;
    backdrop-filter: blur(10px);
    position: relative;
    overflow: hidden;
    white-space: nowrap;
    text-align: center;
    min-width: fit-content;
}

.quick-action-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: var(--gradient-primary);
    transition: left 0.3s ease;
    z-index: 0;
}

.quick-action-btn:hover::before {
    left: 0;
}

.quick-action-btn:hover {
    color: white;
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 5px 15px rgba(0, 122, 255, 0.3);
}

.quick-action-btn span {
    position: relative;
    z-index: 1;
}

/* üìù ENHANCED MESSAGE AREA WITH MORE SPACE */
.ai-chat-messages {
    flex: 1;
    padding: 20px 25px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 15px;
    background: linear-gradient(to bottom, #f8f9ff, #ffffff);
    scroll-behavior: smooth;
    max-height: calc(100% - 220px);
    min-height: 400px;
}

.ai-chat-messages::-webkit-scrollbar {
    width: 6px;
}

.ai-chat-messages::-webkit-scrollbar-track {
    background: var(--system-gray6);
    border-radius: 3px;
}

.ai-chat-messages::-webkit-scrollbar-thumb {
    background: var(--system-gray3);
    border-radius: 3px;
}

.ai-chat-messages::-webkit-scrollbar-thumb:hover {
    background: var(--primary-blue);
}

.chat-message {
    margin-bottom: 15px;
    animation: messageSlideIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

@keyframes messageSlideIn {
    from { 
        opacity: 0; 
        transform: translateY(20px) scale(0.9); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
    }
}

.user-message {
    background: var(--gradient-primary);
    color: white;
    padding: 15px 20px;
    border-radius: 20px 20px 5px 20px;
    max-width: 85%;
    margin-left: auto;
    box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);
    position: relative;
    overflow: hidden;
    word-wrap: break-word;
    line-height: 1.5;
    font-size: 14px;
}

.user-message::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: messageShine 2s ease-in-out;
}

@keyframes messageShine {
    0% { left: -100%; }
    100% { left: 100%; }
}

.ai-message {
    display: flex;
    gap: 15px;
    max-width: 95%;
}

.ai-avatar-small {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: var(--gradient-success);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    position: relative;
    overflow: hidden;
}

.ai-avatar-small::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: avatarRotate 3s linear infinite;
}

@keyframes avatarRotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.ai-response {
    background: white;
    padding: 15px 20px;
    border-radius: 5px 20px 20px 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    border: 1px solid var(--system-gray5);
    flex: 1;
    position: relative;
    overflow: hidden;
    word-wrap: break-word;
    line-height: 1.6;
    font-size: 14px;
    max-width: 100%;
}

.ai-response::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--gradient-primary);
}

.message-text {
    line-height: 1.6;
    font-size: 14px;
    position: relative;
    z-index: 1;
}

.message-text strong {
    color: var(--primary-blue);
    font-weight: 700;
}

.message-text code {
    background: var(--system-gray6);
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'SF Mono', Consolas, monospace;
    font-size: 0.9em;
}

.message-time {
    font-size: 11px;
    opacity: 0.7;
    margin-top: 8px;
    display: block;
    font-weight: 500;
}

.typing-indicator .typing-dots {
    display: flex;
    align-items: center;
    gap: 10px;
    font-style: italic;
    color: var(--system-gray);
    font-weight: 500;
}

.dots {
    display: flex;
    gap: 4px;
}

.dots span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--primary-blue);
    animation: typingDots 1.4s infinite;
}

.dots span:nth-child(2) { animation-delay: 0.2s; }
.dots span:nth-child(3) { animation-delay: 0.4s; }

@keyframes typingDots {
    0%, 60%, 100% { 
        transform: scale(0.8); 
        opacity: 0.5; 
    }
    30% { 
        transform: scale(1.2); 
        opacity: 1; 
    }
}

.ai-chat-input {
    padding: 25px;
    border-top: 1px solid var(--system-gray5);
    display: flex;
    gap: 18px;
    align-items: center;
    background: var(--surface);
    position: relative;
    min-height: 90px;
    max-height: 90px;
}

.ai-chat-input::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 1px;
    background: var(--gradient-primary);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.ai-chat-input:focus-within::before {
    transform: scaleX(1);
}

.ai-chat-input input {
    flex: 1;
    padding: 15px 22px;
    border: 2px solid var(--system-gray4);
    border-radius: 30px;
    font-size: 15px;
    outline: none;
    transition: var(--transition);
    font-family: inherit;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
}

.ai-chat-input input:focus {
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
    transform: translateY(-1px);
}

.ai-chat-input input::placeholder {
    color: var(--text-tertiary);
    font-style: italic;
}

.input-actions {
    display: flex;
    gap: 12px;
}

.voice-btn {
    background: var(--gradient-info);
    color: white;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
    font-size: 20px;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.voice-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.ai-chat-send {
    background: var(--gradient-primary);
    color: white;
    border: none;
    border-radius: 50%;
    width: 55px;
    height: 55px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
    font-size: 22px;
    box-shadow: 0 4px 15px rgba(0, 122, 255, 0.3);
    position: relative;
    overflow: hidden;
}

.ai-chat-send::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s ease;
}

.ai-chat-send:hover::before {
    left: 100%;
}

.ai-chat-send:hover {
    transform: scale(1.1) rotate(15deg);
    box-shadow: 0 6px 20px rgba(0, 122, 255, 0.4);
}

.ai-chat-send:active {
    transform: scale(0.95);
}

/* üöÄ AI TRIGGER BUTTON - PROPERLY POSITIONED */
.ai-trigger {
    position: fixed !important;
    bottom: 30px !important;
    right: 30px !important;
    left: auto !important;
    width: 70px;
    height: 70px;
    background: var(--gradient-primary);
    border-radius: 50%;
    display: flex !important;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10000;
    transition: var(--transition);
    box-shadow: 0 8px 25px rgba(0, 122, 255, 0.5);
    animation: aiFloat 4s ease-in-out infinite;
    border: 3px solid rgba(255, 255, 255, 0.3);
    position: relative;
    overflow: hidden;
}

.ai-trigger::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.3), transparent);
    animation: triggerRotate 3s linear infinite;
}

@keyframes triggerRotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

@keyframes aiFloat {
    0%, 100% { 
        transform: translateY(0px) scale(1);
        box-shadow: 0 8px 25px rgba(0, 122, 255, 0.5);
    }
    50% { 
        transform: translateY(-15px) scale(1.05);
        box-shadow: 0 15px 40px rgba(0, 122, 255, 0.7);
    }
}

.ai-trigger:hover {
    transform: scale(1.2) rotate(10deg);
    box-shadow: 0 15px 50px rgba(0, 122, 255, 0.8);
}

.ai-trigger.chat-open {
    right: 600px !important;
    transform: scale(0.8);
}

.ai-trigger-icon {
    font-size: 32px;
    animation: bounce 2s infinite;
    position: relative;
    z-index: 2;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.ai-trigger-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: var(--danger-red);
    color: white;
    border-radius: 50%;
    width: 25px;
    height: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 700;
    animation: badgePulse 2s infinite;
    z-index: 3;
}

@keyframes badgePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
}

/* üé® ENHANCED BUDGET PROGRESS */
.progress-container {
    background: var(--system-gray5);
    border-radius: 15px;
    height: 25px;
    overflow: hidden;
    margin: 25px 0;
    position: relative;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

.progress-bar {
    height: 100%;
    background: var(--gradient-primary);
    border-radius: 15px;
    transition: width 2s cubic-bezier(0.23, 1, 0.32, 1);
    position: relative;
    overflow: hidden;
}

.progress-bar::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
    animation: progressFlow 2s infinite;
}

@keyframes progressFlow {
    0% { left: -100%; }
    100% { left: 100%; }
}

.progress-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: 700;
    font-size: 0.9rem;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}

/* üé® ENHANCED CARD STYLES */
.card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: var(--blur-light);
    border-radius: 25px;
    padding: 35px;
    box-shadow: var(--shadow);
    margin-bottom: 30px;
    transition: var(--transition);
    border: 1px solid rgba(255, 255, 255, 0.3);
    position: relative;
    overflow: hidden;
}

.card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: var(--gradient-primary);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.card:hover::before {
    transform: scaleX(1);
}

.card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-heavy);
}

/* üé® FORM ENHANCEMENTS */
.form-control {
    width: 100%;
    padding: 18px 24px;
    border: 2px solid var(--system-gray4);
    border-radius: 18px;
    font-size: 16px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    transition: var(--transition);
    font-family: inherit;
    font-weight: 500;
}

.form-control:focus {
    outline: none;
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
    transform: translateY(-2px);
    background: white;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
}

.form-group {
    position: relative;
}

.form-label {
    display: block;
    margin-bottom: 12px;
    font-weight: 700;
    color: var(--text-primary);
    font-size: 15px;
}

.form-label::before {
    content: '';
    display: inline-block;
    width: 4px;
    height: 16px;
    background: var(--gradient-primary);
    border-radius: 2px;
    margin-right: 8px;
    vertical-align: middle;
}

.btn {
    background: var(--gradient-primary);
    color: white;
    border: none;
    padding: 18px 35px;
    border-radius: 18px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    transition: var(--transition);
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 6px 20px rgba(0, 122, 255, 0.3);
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s ease;
}

.btn:hover::before {
    left: 100%;
}

.btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 10px 30px rgba(0, 122, 255, 0.4);
}

.btn:active {
    transform: translateY(-1px) scale(1.02);
}

.btn-success {
    background: var(--gradient-success);
    box-shadow: 0 6px 20px rgba(0, 201, 255, 0.3);
}

.btn-success:hover {
    box-shadow: 0 10px 30px rgba(0, 201, 255, 0.4);
}

.btn-danger {
    background: var(--gradient-warning);
    box-shadow: 0 6px 20px rgba(252, 70, 107, 0.3);
}

.btn-danger:hover {
    box-shadow: 0 10px 30px rgba(252, 70, 107, 0.4);
}
/* üîß FOOTER FIX - PREVENT SIDEBAR OVERLAP */
.dashboard-footer {
    background: linear-gradient(135deg, #2C3E50, #34495E);
    color: white;
    padding: 60px 40px 30px;
    margin: 60px 0 0 350px; /* ‚úÖ FIXED: Left margin to avoid sidebar */
    border-radius: 25px 25px 0 0;
    position: relative;
    overflow: hidden;
    z-index: 1; /* ‚úÖ FIXED: Lower z-index than sidebar */
    width: calc(100% - 350px); /* ‚úÖ FIXED: Width calculation */
    box-sizing: border-box;
}

/* üîß SIDEBAR Z-INDEX ADJUSTMENT */
.sidebar {
    position: fixed;
    left: 0;
    top: 0;
    width: 350px;
    height: 100vh;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: var(--blur-heavy);
    -webkit-backdrop-filter: var(--blur-heavy);
    border-right: 1px solid rgba(255, 255, 255, 0.3);
    z-index: 1000; /* ‚úÖ FIXED: Higher z-index than footer */
    padding: 30px;
    overflow-y: auto;
    box-shadow: 10px 0 50px rgba(0, 0, 0, 0.15);
    transition: var(--transition);
}

/* üì± RESPONSIVE FOOTER FIX */
@media (max-width: 768px) {
    .dashboard-footer {
        margin: 60px 0 0 0; /* ‚úÖ FIXED: Full width on mobile */
        width: 100%;
    }
}

@media (max-width: 1200px) {
    .dashboard-footer {
        margin: 60px 0 0 320px; /* ‚úÖ FIXED: Adjust for smaller sidebar */
        width: calc(100% - 320px);
    }
}


        .dashboard-footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.03), transparent);
            animation: footerShine 8s infinite;
        }

        @keyframes footerShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .footer-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
            position: relative;
            z-index: 2;
        }

        .footer-section h4 {
            font-size: 1.3rem;
            font-weight: 800;
            margin-bottom: 20px;
            color: #3498DB;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-section ul {
            list-style: none;
            padding: 0;
        }

        .footer-section ul li {
            margin-bottom: 12px;
        }

        .footer-section ul li a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-section ul li a:hover {
            color: #3498DB;
            transform: translateX(5px);
        }

        .footer-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .footer-stat {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            transition: var(--transition);
        }

        .footer-stat:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .footer-stat-number {
            font-size: 2rem;
            font-weight: 900;
            color: #3498DB;
            display: block;
        }

        .footer-stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 30px;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .developer-credit {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        /* Flash Message Enhancements */
        .flash-message {
            position: fixed;
            top: 30px;
            right: 30px;
            background: white;
            border-radius: 20px;
            padding: 25px 30px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            border-left: 6px solid var(--success-green);
            z-index: 2001;
            max-width: 450px;
            font-weight: 700;
            animation: slideInRight 0.5s ease;
            font-size: 16px;
            line-height: 1.5;
        }

        .flash-message.error {
            border-left-color: var(--danger-red);
        }
/* üì± ENHANCED MOBILE FOOTER RESPONSIVE */
@media (max-width: 768px) {
    .dashboard-footer {
        margin: 60px 0 0 0 !important; /* ‚úÖ Full width on mobile */
        width: 100% !important;
        padding: 40px 20px 20px !important; /* Reduce padding on mobile */
    }
    
    .footer-container {
        grid-template-columns: 1fr !important; /* Single column on mobile */
        gap: 25px !important;
    }
    
    .export-section {
        padding: 20px !important;
        margin-top: 20px !important;
    }
    
    .export-buttons {
        grid-template-columns: 1fr !important; /* Stack buttons vertically */
        gap: 10px !important;
    }
    
    .export-btn {
        padding: 12px 16px !important;
        font-size: 12px !important;
    }
}

@media (max-width: 480px) {
    .dashboard-footer {
        border-radius: 0 !important; /* Remove border radius on very small screens */
        margin: 40px 0 0 0 !important;
    }
    
    .main-content {
        padding: 20px !important;
    }
}

/* üîß EXPORT SECTION MOBILE FIX */
@media (max-width: 600px) {
    .export-title {
        font-size: 16px !important;
        text-align: center;
    }
    
    .export-buttons {
        grid-template-columns: repeat(2, 1fr) !important; /* 2 columns on smaller screens */
        gap: 8px !important;
    }
    
    .export-btn {
        padding: 10px 12px !important;
        font-size: 11px !important;
        letter-spacing: 0.5px !important;
    }
}

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
/* üì§ PROFESSIONAL EXPORT SECTION */
.export-section {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
    backdrop-filter: var(--blur-light);
    border-radius: 20px;
    padding: 25px;
    margin-top: 30px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    position: relative;
    overflow: hidden;
}

.export-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    animation: exportShine 4s infinite;
}

@keyframes exportShine {
    0% { left: -100%; }
    100% { left: 100%; }
}

.export-title {
    font-size: 18px;
    font-weight: 800;
    margin-bottom: 20px;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 10px;
}

.export-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
}

.export-btn {
    padding: 15px 20px;
    border-radius: 15px;
    font-size: 14px;
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition);
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
    position: relative;
    overflow: hidden;
}

.export-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s ease;
}

.export-btn:hover::before {
    left: 100%;
}

.csv-btn {
    background: linear-gradient(135deg, #2ECC71, #27AE60);
    color: white;
    box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
}

.csv-btn:hover {
    box-shadow: 0 8px 25px rgba(46, 204, 113, 0.4);
}

.pdf-btn {
    background: linear-gradient(135deg, #E74C3C, #C0392B);
    color: white;
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
}

.pdf-btn:hover {
    box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
}

.email-btn {
    background: linear-gradient(135deg, #3498DB, #2980B9);
    color: white;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
}

.email-btn:hover {
    box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
}

.whatsapp-btn {
    background: linear-gradient(135deg, #25D366, #128C7E);
    color: white;
    box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
}

.whatsapp-btn:hover {
    box-shadow: 0 8px 25px rgba(37, 211, 102, 0.4);
}
.webapp-install-btn {
    background: linear-gradient(135deg, #00C9FF, #92FE9D) !important;
    color: white !important;
    border: none !important;
    padding: 20px 40px !important;
    border-radius: 25px !important;
    font-size: 18px !important;
    font-weight: 800 !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
    box-shadow: 0 8px 25px rgba(0, 201, 255, 0.4) !important;
    position: relative !important;
    overflow: hidden !important;
}

.webapp-install-btn:hover {
    transform: translateY(-3px) scale(1.05) !important;
    box-shadow: 0 15px 40px rgba(0, 201, 255, 0.6) !important;
}

.webapp-install-btn:active {
    transform: translateY(0) scale(1) !important;
}

.export-btn:hover {
    transform: translateY(-3px) scale(1.05);
}

/* üí¨ FLASH MESSAGE SYSTEM */
.flash-message {
    position: fixed;
    top: 30px;
    right: 30px;
    background: white;
    backdrop-filter: var(--blur-heavy);
    border-radius: 20px;
    padding: 25px 30px;
    box-shadow: var(--shadow-heavy);
    border-left: 6px solid var(--success-green);
    z-index: 2001;
    max-width: 450px;
    font-weight: 700;
    animation: slideInRight 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    font-size: 16px;
    line-height: 1.5;
}

.flash-message.error {
    border-left-color: var(--danger-red);
}

.flash-message.warning {
    border-left-color: var(--warning-orange);
}

.flash-message.info {
    border-left-color: var(--info-cyan);
}

@keyframes slideInRight {
    from {
        transform: translateX(100%) scale(0.8);
        opacity: 0;
    }
    to {
        transform: translateX(0) scale(1);
        opacity: 1;
    }
}

@keyframes slideOutRight {
    from {
        transform: translateX(0) scale(1);
        opacity: 1;
    }
    to {
        transform: translateX(100%) scale(0.8);
        opacity: 0;
    }
}

/* üé≠ ADVANCED ANIMATIONS */
@keyframes spin {
    to { transform: rotate(360deg); }
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

@keyframes zoomIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

/* üåê RESPONSIVE DESIGN */
@media (max-width: 1400px) {
    .main-content {
        margin-left: 320px;
    }
    
    .sidebar {
        width: 320px;
    }
    
    .ai-chat {
        width: 500px;
        height: 700px;
    }
    
    .ai-trigger.chat-open {
        right: 530px !important;
    }
}

@media (max-width: 1200px) {
    .charts-section {
        grid-template-columns: 1fr;
    }
    
    .ai-chat {
        width: 450px;
        height: 650px;
        right: 20px;
        bottom: 20px;
    }
    
    .ai-trigger.chat-open {
        right: 490px !important;
        bottom: 20px;
    }
}

@media (max-width: 768px) {
    .sidebar {
        transform: translateX(-100%);
        transition: transform 0.4s ease;
        width: 300px;
    }
    
    .sidebar.mobile-open {
        transform: translateX(0);
    }
    
    .main-content {
        margin-left: 0;
        padding: 25px;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }

    .ai-chat {
        width: 95%;
        height: 85vh;
        bottom: 10px;
        right: 2.5%;
        left: 2.5%;
    }

    .page-title {
        font-size: 2.8rem;
    }

    .export-buttons {
        grid-template-columns: 1fr;
    }
    
    .metrics-grid {
        grid-template-columns: 1fr;
    }
    
    .ai-trigger {
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
    }
    
    .ai-trigger.chat-open {
        right: 20px;
        bottom: 20px;
        transform: scale(0.7);
    }
}

@media (max-width: 480px) {
    .page-title {
        font-size: 2.2rem;
    }
    
    .ai-chat {
        width: 100%;
        height: 100vh;
        bottom: 0;
        right: 0;
        left: 0;
        border-radius: 0;
    }
}

/* üé® CUSTOM SCROLLBAR */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: var(--system-gray6);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--system-gray3);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--system-gray2);
}

/* üåü LOADING STATES */
.loading {
    display: inline-block;
    width: 25px;
    height: 25px;
    border: 3px solid rgba(0, 122, 255, 0.3);
    border-radius: 50%;
    border-top-color: var(--primary-blue);
    animation: spin 1s ease-in-out infinite;
}

.skeleton {
    background: linear-gradient(90deg, var(--system-gray6) 25%, var(--system-gray5) 50%, var(--system-gray6) 75%);
    background-size: 200% 100%;
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}
/* üì± MOBILE HAMBURGER MENU BUTTON */
.mobile-menu-toggle {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1001;
    width: 50px;
    height: 50px;
    background: var(--gradient-primary);
    border-radius: 50%;
    display: none; /* Hidden on desktop */
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 122, 255, 0.4);
    transition: var(--transition);
}

.mobile-menu-toggle:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(0, 122, 255, 0.6);
}

.hamburger {
    width: 24px;
    height: 18px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.hamburger span {
    width: 100%;
    height: 3px;
    background: white;
    border-radius: 2px;
    transition: var(--transition);
}

/* üì± HAMBURGER ANIMATION WHEN OPEN */
.mobile-menu-toggle.active .hamburger span:nth-child(1) {
    transform: rotate(45deg) translate(6px, 6px);
}

.mobile-menu-toggle.active .hamburger span:nth-child(2) {
    opacity: 0;
}

.mobile-menu-toggle.active .hamburger span:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
}

/* üì± MOBILE OVERLAY */
.mobile-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
    display: none;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.mobile-overlay.show {
    display: block;
    opacity: 1;
}

/* üì± MOBILE RESPONSIVE SIDEBAR */
@media (max-width: 768px) {
    /* Show mobile menu button */
    .mobile-menu-toggle {
        display: flex !important;
    }
    
    /* Hide sidebar by default */
    .sidebar {
        transform: translateX(-100%);
        transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        width: 300px; /* Slightly smaller on mobile */
    }
    
    /* Show sidebar when open */
    .sidebar.mobile-open {
        transform: translateX(0);
    }
    
    /* Adjust main content */
    .main-content {
        margin-left: 0;
        padding: 80px 25px 25px 25px; /* Extra top padding for menu button */
    }
    
    /* Adjust other fixed elements */
    .ai-trigger {
        bottom: 20px;
        right: 20px;
    }
    
    .ai-chat {
        width: 95%;
        height: 85vh;
        bottom: 10px;
        right: 2.5%;
        left: 2.5%;
    }
}

@media (max-width: 480px) {
    .sidebar {
        width: 280px; /* Even smaller for very small screens */
    }
    
    .main-content {
        padding: 70px 15px 15px 15px;
    }
    
    .mobile-menu-toggle {
        width: 45px;
        height: 45px;
        top: 15px;
        left: 15px;
    }
}

/* üì± DIRECT WEB APP DOWNLOAD SECTION */
.webapp-download-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%);
    border-radius: 25px;
    padding: 0;
    margin: 30px 0;
    position: relative;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4);
    animation: webappPulse 4s ease-in-out infinite;
}

@keyframes webappPulse {
    0%, 100% { box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4); }
    50% { box-shadow: 0 25px 70px rgba(102, 126, 234, 0.6); }
}

.webapp-card {
    display: flex;
    align-items: center;
    gap: 30px;
    padding: 30px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    position: relative;
    z-index: 2;
}

.webapp-icon {
    font-size: 80px;
    animation: iconBounce 2s ease-in-out infinite;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
}

@keyframes iconBounce {
    0%, 100% { transform: translateY(0px) scale(1); }
    50% { transform: translateY(-10px) scale(1.1); }
}

.webapp-content {
    flex: 1;
}

.webapp-content h3 {
    font-size: 28px;
    font-weight: 900;
    margin: 0 0 10px 0;
    color: var(--text-primary);
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.webapp-content p {
    font-size: 16px;
    color: var(--text-secondary);
    margin: 0 0 20px 0;
    line-height: 1.5;
}

.webapp-benefits {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.webapp-benefits span {
    background: rgba(0, 122, 255, 0.1);
    color: var(--primary-blue);
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 700;
    border: 1px solid rgba(0, 122, 255, 0.2);
    transition: var(--transition);
}

.webapp-benefits span:hover {
    background: var(--primary-blue);
    color: white;
    transform: scale(1.05);
}

.webapp-actions {
    display: flex;
    flex-direction: column;
    gap: 15px;
    align-items: flex-end;
}

.webapp-install-btn {
    background: var(--gradient-success);
    color: white;
    border: none;
    padding: 20px 35px;
    border-radius: 20px;
    font-size: 18px;
    font-weight: 800;
    cursor: pointer;
    transition: var(--transition);
    box-shadow: 0 8px 25px rgba(0, 201, 255, 0.4);
    position: relative;
    overflow: hidden;
    min-width: 200px;
    text-align: center;
}

.webapp-install-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.6s ease;
}

.webapp-install-btn:hover::before {
    left: 100%;
}

.webapp-install-btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 15px 40px rgba(0, 201, 255, 0.6);
}

.install-text {
    display: block;
    font-size: 18px;
    margin-bottom: 4px;
}

.install-size {
    display: block;
    font-size: 12px;
    opacity: 0.8;
    font-weight: 500;
}

.webapp-info-btn {
    background: rgba(255, 255, 255, 0.2);
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: var(--primary-blue);
    padding: 10px 20px;
    border-radius: 15px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    backdrop-filter: blur(10px);
}

.webapp-info-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.05);
}

/* üì± MOBILE RESPONSIVE */
@media (max-width: 768px) {
    .webapp-card {
        flex-direction: column;
        text-align: center;
        gap: 25px;
        padding: 25px;
    }
    
    .webapp-icon {
        font-size: 60px;
    }
    
    .webapp-content h3 {
        font-size: 24px;
    }
    
    .webapp-benefits {
        justify-content: center;
    }
    
    .webapp-actions {
        align-items: center;
        width: 100%;
    }
    
    .webapp-install-btn {
        width: 100%;
        max-width: 300px;
    }
}

/* üé® INSTALLATION PROGRESS */
.webapp-installing {
    background: var(--gradient-warning) !important;
    pointer-events: none;
}

.webapp-installed {
    background: var(--gradient-success) !important;
    pointer-events: none;
}

/* üéØ UTILITY CLASSES */
.text-center { text-align: center; }
.text-left { text-align: left; }
.text-right { text-align: right; }
.font-bold { font-weight: 700; }
.font-light { font-weight: 300; }
.opacity-50 { opacity: 0.5; }
.opacity-75 { opacity: 0.75; }
.mb-10 { margin-bottom: 10px; }
.mb-20 { margin-bottom: 20px; }
.mt-10 { margin-top: 10px; }
.mt-20 { margin-top: 20px; }
.hidden { display: none; }
.visible { display: block; }

/* üåà THEME VARIATIONS */
.theme-dark {
    --surface: #1C1C1E;
    --text-primary: #FFFFFF;
    --text-secondary: #8E8E93;
    --system-gray6: #2C2C2E;
}

.theme-purple {
    --gradient-primary: linear-gradient(135deg, #8B5CF6, #7C3AED);
    --primary-blue: #8B5CF6;
}

.theme-green {
    --gradient-primary: linear-gradient(135deg, #10B981, #059669);
    --primary-blue: #10B981;
}

    </style>
</head>
<body>
    <!-- üé® ENHANCED SIDEBAR WITH GLASSMORPHISM -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">üéí Backpack Optimizer</div>
            <div class="tagline">Ultimate AI Financial Assistant</div>
        </div>
        
        <div class="user-profile">
            <div class="user-avatar" id="userAvatar">A</div>
            <div id="userName" style="font-size: 22px; font-weight: 800;">Loading...</div>
            <div id="userCampus" style="font-size: 14px; opacity: 0.9;">Loading...</div>
            <div id="userRegNumber" style="font-size: 12px; margin-top: 8px; opacity: 0.8;">Loading...</div>
            <div id="userPersonality" style="font-size: 13px; margin-top: 12px; background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 12px;">üåü Ultimate Smart Budgeter</div>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a href="dashboard.html" class="nav-link active">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="expenses.html" class="nav-link">
                    <span class="nav-icon">üí∏</span>
                    <span>My Expenses</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="add-expense.html" class="nav-link">
                    <span class="nav-icon">‚ûï</span>
                    <span>Add Expense</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="wishboard.html" class="nav-link">
                    <span class="nav-icon">‚≠ê</span>
                    <span>Wishboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="marketplace.html" class="nav-link">
                    <span class="nav-icon">üõí</span>
                    <span>Marketplace</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="housing.html" class="nav-link">
                    <span class="nav-icon">üè†</span>
                    <span>Housing</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="analytics.html" class="nav-link">
                    <span class="nav-icon">üìà</span>
                    <span>Analytics</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="profile.html" class="nav-link">
                    <span class="nav-icon">üë§</span>
                    <span>Profile</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="logout()">
                    <span class="nav-icon">üö™</span>
                    <span>Logout</span>
                </a>
            </li>
        </ul>
    </div>
<!-- üì± MOBILE MENU TOGGLE BUTTON -->
<div class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleSidebar()">
    <div class="hamburger">
        <span></span>
        <span></span>
        <span></span>
    </div>
</div>

<!-- üì± MOBILE OVERLAY -->
<div class="mobile-overlay" id="mobileOverlay" onclick="closeSidebar()"></div>

    <!-- üéØ ULTIMATE MAIN CONTENT -->
    <div class="main-content">
        <!-- üåü PAGE HEADER -->
        <div class="page-header">
            <h1 class="page-title">Ultimate AI Financial Dashboard</h1>
            <p class="page-subtitle" id="welcomeMessage">Your most advanced financial companion with world-class AI...</p>
        </div>
<!-- üì± DIRECT WEB APP DOWNLOAD SECTION -->
<!-- üì± DIRECT WEB APP DOWNLOAD SECTION -->
<div class="webapp-download-section" id="webappDownload">
    <div class="webapp-card">
        <div class="webapp-icon">üì±</div>
        <div class="webapp-content">
            <h3>Install Backpack Optimizer App</h3>
            <p>Get faster access, offline support, and native app experience!</p>
            <div class="webapp-benefits">
                <span>‚ö° Instant Loading</span>
                <span>üì∂ Works Offline</span>
                <span>üîî Push Notifications</span>
                <span>üöÄ Native Feel</span>
            </div>
        </div>
        <div class="webapp-actions">
            <button class="webapp-install-btn" onclick="installWebApp()">
                <span class="install-text">üì• Install App</span>
                <span class="install-size">~2MB</span>
            </button>
            <button class="webapp-info-btn" onclick="showAppInfo()">‚ÑπÔ∏è Why Install?</button>
        </div>
    </div>
</div>


        <!-- ü§ñ ULTRA-ADVANCED AI INSIGHTS PANEL -->
        <div class="ai-insights-panel">
            <div class="ai-insights-header">
                <div class="ai-avatar">ü§ñ</div>
                <div>
                    <h3 style="margin: 0; color: var(--primary-blue); font-weight: 900; font-size: 20px;">Ultra AI Financial Intelligence</h3>
                    <p style="margin: 0; color: var(--system-gray); font-size: 14px;">Real-time insights powered by advanced machine learning algorithms</p>
                </div>
                <div class="loading" style="width: 30px; height: 30px; border: 4px solid rgba(0, 122, 255, 0.3); border-top-color: var(--primary-blue); border-radius: 50%; animation: spin 1s linear infinite;"></div>
            </div>
            <div id="aiInsightsContainer">
                <!-- Dynamic AI insights will be populated here -->
            </div>
        </div>

        <!-- üìä ADVANCED STATS GRID -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-value" id="budgetAmount">‚Çπ0</div>
                <div class="stat-label">Monthly Budget</div>
                <div class="stat-trend">Your financial foundation</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üí∏</div>
                <div class="stat-value" id="spentAmount">‚Çπ0</div>
                <div class="stat-label">Total Spent</div>
                <div class="stat-trend" id="spentTrend">0% of budget</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üéØ</div>
                <div class="stat-value" id="remainingAmount">‚Çπ0</div>
                <div class="stat-label">Remaining</div>
                <div class="stat-trend" id="remainingTrend">100% available</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-value" id="savingsRate">100%</div>
                <div class="stat-label">Savings Rate</div>
                <div class="stat-trend">Financial discipline</div>
            </div>
        </div>

        <!-- üìà ADVANCED METRICS GRID -->
        <div class="metrics-grid">
            <div id="metricsGridContent">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- üìà ENHANCED CHARTS SECTION - USING YOUR ORIGINAL CODE -->
        <!-- ONE INSANE ANALYTICS HUB -->
<div class="charts-section" style="display: flex; justify-content: center; width: 100%;">
    <div class="chart-container" style="background: linear-gradient(135deg, #6a11cb 0%, #2575fc 50%, #118ab2 100%); border-radius: 25px; padding: 40px 60px; text-align: center; color: white; position: relative; overflow: hidden; box-shadow: 0 25px 80px rgba(106, 17, 203, 0.6); min-height: 350px; width: 95vw; max-width: 1400px; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        
        <!-- Floating particles -->
        <div style="position: absolute; top: 20%; left: 10%; width: 4px; height: 4px; background: rgba(255,255,255,0.8); border-radius: 50%; animation: float1 6s infinite;"></div>
        <div style="position: absolute; top: 30%; right: 15%; width: 6px; height: 6px; background: rgba(255,255,255,0.6); border-radius: 50%; animation: float2 4s infinite;"></div>
        <div style="position: absolute; bottom: 25%; left: 20%; width: 3px; height: 3px; background: rgba(255,255,255,0.9); border-radius: 50%; animation: float3 5s infinite;"></div>
        
        <!-- Animated background waves -->
        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.05) 50%, transparent 70%); animation: wave 8s infinite;"></div>
        
        <!-- Main title with glow -->
        <h1 style="font-size: 3.2rem; font-weight: 900; margin-bottom: 20px; letter-spacing: -2px; text-shadow: 0 0 20px rgba(255,255,255,0.8), 0 0 40px rgba(255,255,255,0.4); position: relative; z-index: 10;">
            üìä Advanced Analytics Hub
        </h1>
        
        <!-- Rotating icon cluster -->
        <div style="position: relative; margin: 25px 0; height: 100px; display: flex; align-items: center; justify-content: center;">
            <div style="position: absolute; font-size: 80px; animation: spin 12s linear infinite; filter: drop-shadow(0 0 30px rgba(255,255,255,0.8));">üìà</div>
            <div style="position: absolute; font-size: 70px; animation: spin 8s linear infinite reverse; filter: drop-shadow(0 0 30px rgba(255,255,255,0.6));">üìä</div>
            <div style="position: absolute; font-size: 60px; animation: spin 15s linear infinite; filter: drop-shadow(0 0 30px rgba(255,255,255,0.4));">üìâ</div>
        </div>
        
        <!-- Subtitle with pulse -->
        <h2 style="font-size: 2rem; font-weight: 800; margin: 20px 0 15px; animation: pulse 3s infinite; text-shadow: 0 4px 8px rgba(0,0,0,0.3);">
            Interactive Financial Intelligence
        </h2>
        
        <!-- Description with typing effect -->
        <p style="font-size: 1.3rem; max-width: 800px; margin: 0 auto 35px; line-height: 1.6; opacity: 0.95; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
            Experience cutting-edge data visualization with real-time insights, trend analysis, and predictive financial modeling designed for the future.
        </p>
        
        <!-- Ultimate button -->
        <button onclick="window.open('analytics.html', '_blank')" 
                style="background: linear-gradient(45deg, #ff416c, #ff4b2b, #ff6b35, #f7931e); 
                       border: none; 
                       color: white; 
                       padding: 22px 55px; 
                       font-size: 1.3rem; 
                       font-weight: 900; 
                       border-radius: 50px; 
                       cursor: pointer; 
                       box-shadow: 0 0 40px rgba(255, 65, 108, 0.8); 
                       transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
                       position: relative;
                       overflow: hidden;
                       text-transform: uppercase;
                       letter-spacing: 2px;"
                onmouseover="this.style.transform='translateY(-8px) scale(1.1)'; this.style.boxShadow='0 0 60px rgba(255, 65, 108, 1)'; this.style.filter='brightness(1.2)'"
                onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 0 40px rgba(255, 65, 108, 0.8)'; this.style.filter='brightness(1)'">
            <span style="position: relative; z-index: 2;">üöÄ Launch Analytics Portal</span>
        </button>
        
        <!-- Moving background elements -->
        <div style="position: absolute; bottom: -10%; right: -10%; width: 200px; height: 200px; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); border-radius: 50%; animation: moveCircle1 20s infinite;"></div>
        <div style="position: absolute; top: -5%; left: -5%; width: 150px; height: 150px; background: radial-gradient(circle, rgba(255,255,255,0.08) 0%, transparent 70%); border-radius: 50%; animation: moveCircle2 25s infinite;"></div>
    </div>
</div>

<!-- INSANE ANIMATIONS -->
<style>
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

@keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.05); }
}

@keyframes float1 {
    0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.8; }
    33% { transform: translate(30px, -30px) scale(1.2); opacity: 1; }
    66% { transform: translate(-20px, 20px) scale(0.8); opacity: 0.6; }
}

@keyframes float2 {
    0%, 100% { transform: translate(0, 0) rotate(0deg); opacity: 0.6; }
    50% { transform: translate(-40px, -40px) rotate(180deg); opacity: 1; }
}

@keyframes float3 {
    0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.9; }
    25% { transform: translate(20px, -50px) scale(1.5); opacity: 0.7; }
    75% { transform: translate(-30px, 30px) scale(0.5); opacity: 1; }
}

@keyframes wave {
    0% { transform: translateX(-100%) skewX(12deg); }
    100% { transform: translateX(100%) skewX(12deg); }
}

@keyframes moveCircle1 {
    0%, 100% { transform: translate(0, 0) scale(1); }
    25% { transform: translate(-100px, -50px) scale(1.2); }
    50% { transform: translate(-200px, -100px) scale(0.8); }
    75% { transform: translate(-50px, -150px) scale(1.1); }
}

@keyframes moveCircle2 {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(80px, 100px) scale(0.9); }
    66% { transform: translate(150px, 50px) scale(1.3); }
}

.chart-container:hover {
    transform: translateY(-15px) scale(1.02);
    box-shadow: 0 40px 100px rgba(106, 17, 203, 0.8);
    transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
}

button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s;
}

button:hover::before {
    left: 100%;
}
</style>

        <!-- üéõÔ∏è ENHANCED BUDGET PROGRESS -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="margin: 0; font-weight: 900; font-size: 22px;">üìä Ultimate Budget Analysis</h3>
                <div style="display: flex; gap: 20px; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 15px; height: 15px; border-radius: 50%; background: var(--success-green);"></div>
                        <span style="font-size: 14px; color: var(--system-gray); font-weight: 600;">Safe Zone</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 15px; height: 15px; border-radius: 50%; background: var(--primary-blue);"></div>
                        <span style="font-size: 14px; color: var(--system-gray); font-weight: 600;">Current</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 15px; height: 15px; border-radius: 50%; background: var(--danger-red);"></div>
                        <span style="font-size: 14px; color: var(--system-gray); font-weight: 600;">Danger</span>
                    </div>
                </div>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="budgetProgressBar" style="width: 0%">
                    <div class="progress-text" id="progressText">‚Çπ0 spent (0%)</div>
                </div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                <span style="font-size: 14px; color: var(--system-gray); font-weight: 600;">‚Çπ0</span>
                <span style="font-size: 16px; font-weight: 800; color: var(--primary-blue);" id="progressMiddle">‚Çπ0 mid-point</span>
                <span style="font-size: 14px; color: var(--system-gray); font-weight: 600;" id="budgetMax">‚Çπ0</span>
            </div>
            <div id="budgetBreakdown" style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 20px; margin-top: 25px;">
                <!-- Will be populated dynamically -->
            </div>
        </div>
 


        <!-- üí° AI SMART BUDGET RECOMMENDATIONS -->
        <div class="card" style="background: linear-gradient(135deg, #E8F5E8, #D4EDDA); border: 2px solid var(--success-green);">
            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 30px;">
                <div style="width: 70px; height: 70px; background: var(--success-green); border-radius: 35px; display: flex; align-items: center; justify-content: center; font-size: 32px; color: white; box-shadow: 0 8px 20px rgba(52, 199, 89, 0.4);">üí°</div>
                <div>
                    <h3 style="margin: 0; color: var(--success-green); font-weight: 900; font-size: 22px;">AI Ultra-Smart Budget Recommendations</h3>
                    <p style="margin: 5px 0 0 0; color: var(--text-secondary); font-weight: 600;">Personalized category-wise budget optimization with machine learning</p>
                </div>
            </div>
            <div id="categoryRecommendations" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- ‚ö° ULTIMATE QUICK ADD EXPENSE -->
        <div class="card">
            <h3 style="margin-bottom: 30px; font-weight: 900; font-size: 22px; display: flex; align-items: center; gap: 15px;">
                ‚ö° Lightning-Fast Expense Addition
                <span style="background: var(--gradient-primary); color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: 600;">INSTANT SYNC</span>
            </h3>
            <form id="quickExpenseForm" onsubmit="addQuickExpense(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">üí∞ Amount (‚Çπ)</label>
                        <input type="number" class="form-control" id="quickAmount" placeholder="Enter amount..." step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">üìÇ Category</label>
                        <select class="form-control" id="quickCategory" required>
                            <option value="food">üçï Food & Dining</option>
                            <option value="transport">üöó Transportation</option>
                            <option value="entertainment">üé¨ Entertainment</option>
                            <option value="education">üìö Education</option>
                            <option value="shopping">üõçÔ∏è Shopping</option>
                            <option value="clothing">üëï Clothing</option>
                            <option value="healthcare">üè• Healthcare</option>
                            <option value="utilities">‚ö° Utilities</option>
                            <option value="other">üîÑ Other</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">üìù Description</label>
                        <input type="text" class="form-control" id="quickDescription" placeholder="What did you buy?" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">üòä Mood</label>
                        <select class="form-control" id="quickMood">
                            <option value="happy">üòä Happy</option>
                            <option value="neutral" selected>üòê Neutral</option>
                            <option value="sad">üò¢ Regretful</option>
                            <option value="excited">ü§© Excited</option>
                            <option value="confident">üòé Confident</option>
                            <option value="worried">üò∞ Worried</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">üí≥ Payment Method</label>
                        <select class="form-control" id="quickPayment">
                            <option value="upi">üì± UPI</option>
                            <option value="card">üí≥ Card</option>
                            <option value="cash">üíµ Cash</option>
                            <option value="wallet">üëõ Digital Wallet</option>
                            <option value="netbanking">üè¶ Net Banking</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">üìç Location (Optional)</label>
                        <input type="text" class="form-control" id="quickLocation" placeholder="Where did you spend?">
                    </div>
                </div>
                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">üí∏ Add Expense Instantly</button>
                    <button type="button" class="btn" onclick="document.getElementById('quickExpenseForm').reset()" style="background: var(--system-gray3); color: var(--text-primary); flex: 0 0 auto;">üîÑ Reset</button>
                </div>
            </form>
        </div>

        <!-- üìã ENHANCED RECENT EXPENSES -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h3 style="margin: 0; font-weight: 900; font-size: 22px; display: flex; align-items: center; gap: 15px;">
                    üìã Recent Financial Activity
                    <span id="expenseCount" style="background: var(--gradient-primary); color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px; font-weight: 600;">0 TRANSACTIONS</span>
                </h3>
                <div style="display: flex; gap: 15px;">
                    <a href="expenses.html" style="color: var(--primary-blue); text-decoration: none; font-weight: 700; display: flex; align-items: center; gap: 8px; padding: 10px 20px; background: rgba(0, 122, 255, 0.1); border-radius: 15px; transition: var(--transition);">
                        View All <span style="font-size: 20px;">‚Üí</span>
                    </a>
                    <button onclick="refreshExpenses()" style="background: var(--gradient-success); color: white; border: none; padding: 10px 20px; border-radius: 15px; font-weight: 700; cursor: pointer; transition: var(--transition);">
                        üîÑ Refresh
                    </button>
                </div>
            </div>
            <div id="recentExpensesList">
                <!-- Will be populated by JavaScript -->
            </div>

            <!-- üì§ PROFESSIONAL EXPORT SECTION -->
            <div class="export-section">
                <div class="export-title">
                    üì§ Export & Share Your Ultimate Financial Report
                </div>
                <div class="export-buttons">
                    <button class="export-btn csv-btn" onclick="exportToCSV()">
                        üìä Advanced CSV
                    </button>
                    <button class="export-btn pdf-btn" onclick="exportToPDF()">
                        üìÑ Professional PDF
                    </button>
                    <button class="export-btn email-btn" onclick="shareViaEmail()">
                        üìß Email Report
                    </button>
                    <button class="export-btn whatsapp-btn" onclick="shareViaWhatsApp()">
                        üì± WhatsApp Share
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- üöÄ ULTIMATE AI CHAT INTERFACE -->
    <div class="ai-chat" id="aiChat">
        <div class="ai-chat-header">
            <div class="ai-chat-title">
                ü§ñ Ultra AI Financial Assistant
                <div class="ai-chat-subtitle">Smart ‚Ä¢ Contextual ‚Ä¢ Comprehensive ‚Ä¢ Memory-Enabled</div>
            </div>
            <div class="ai-chat-close" onclick="toggleAIChat()">√ó</div>
        </div>
        
        <div class="ai-status-bar">
            <div class="status-indicator"></div>
            <span>AI Status: Online & Learning ‚Ä¢ Context: Financial Dashboard ‚Ä¢ Memory: Active</span>
        </div>
        
        <!-- üéØ ULTIMATE QUICK ACTIONS PANEL -->
        <div class="quick-actions">
            <div class="quick-action-btn" onclick="sendQuickMessage('Check my complete budget status with detailed analysis')">
                <span>üí∞ Complete Budget Analysis</span>
            </div>
            <div class="quick-action-btn" onclick="sendQuickMessage('Show me detailed spending breakdown with recommendations')">
                <span>üìä Advanced Spending Report</span>
            </div>
            <div class="quick-action-btn" onclick="sendQuickMessage('Help me save money with personalized strategies')">
                <span>üíé Smart Savings Plan</span>
            </div>
            <div class="quick-action-btn" onclick="sendQuickMessage('Should I buy something expensive? Give me purchase advice')">
                <span>üõí Purchase Advisor</span>
            </div>
            <div class="quick-action-btn" onclick="sendQuickMessage('Tell me about F1 considering my budget situation')">
                <span>üèéÔ∏è F1 & Entertainment</span>
            </div>
            <div class="quick-action-btn" onclick="sendQuickMessage('Contact administrator for technical support')">
                <span>üë®‚Äçüíº Contact Admin</span>
            </div>
            <div class="quick-action-btn" onclick="sendQuickMessage('I am facing a technical issue and need help')">
                <span>üîß Report Technical Issue</span>
            </div>
            <div class="quick-action-btn" onclick="sendQuickMessage('Give me life advice and motivation for financial goals')">
                <span>üåü Life Coach</span>
            </div>
        </div>
        
        <div class="ai-chat-messages" id="chatMessages">
            <!-- AI Messages will be populated here -->
        </div>
        
        <div class="ai-chat-input">
            <input type="text" id="chatInput" placeholder="Ask me anything about finances, life, F1, or get support..." onkeypress="handleChatKeyPress(event)">
            <div class="input-actions">
                <button class="voice-btn" onclick="startVoiceInput()" title="Voice Input">
                    üé§
                </button>
                <button class="ai-chat-send" onclick="sendMessage()">
                    <span>‚û§</span>
                </button>
            </div>
        </div>
    </div>

    <!-- üöÄ ULTIMATE AI TRIGGER BUTTON - RIGHT SIDE FIXED -->
    <div class="ai-trigger" onclick="toggleAIChat()">
        <div class="ai-trigger-icon">ü§ñ</div>
        <div class="ai-trigger-badge" id="unreadCount" style="display: none;">1</div>
    </div>

    <script>
        // üöÄ ULTIMATE ADVANCED FINANCIAL AI SYSTEM
        class UltimateFinancialAI {
            constructor() {
                this.apiKey = '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';
                this.conversationHistory = this.loadConversationHistory();
                this.userMemory = this.loadUserMemory();
                this.siteData = {};
                this.isTyping = false;
                this.messageQueue = [];
                this.contextWindow = 10;
                this.updateSiteData();
                this.initializeMemory();
            }

            loadConversationHistory() {
                return JSON.parse(localStorage.getItem('ai_conversation_history') || '[]');
            }

            loadUserMemory() {
                return JSON.parse(localStorage.getItem('ai_user_memory') || '{}');
            }

            saveConversationHistory() {
                if (this.conversationHistory.length > 100) {
                    this.conversationHistory = this.conversationHistory.slice(-50);
                }
                localStorage.setItem('ai_conversation_history', JSON.stringify(this.conversationHistory));
            }

            saveUserMemory() {
                localStorage.setItem('ai_user_memory', JSON.stringify(this.userMemory));
            }

            initializeMemory() {
                if (!this.userMemory.profile) {
                    this.userMemory.profile = {
                        name: currentUser?.fullName || 'Student',
                        preferences: [],
                        goals: [],
                        interests: [],
                        financialHabits: {},
                        conversations: 0
                    };
                }
                this.userMemory.profile.conversations = (this.userMemory.profile.conversations || 0) + 1;
                this.saveUserMemory();
            }

            updateSiteData() {
                try {
                    const userExpenses = expenses.filter(e => e.userId === currentUser?.id) || [];
                    const totalSpent = userExpenses.reduce((sum, exp) => sum + exp.amount, 0);
                    const budget = currentUser?.monthlyBudget || 0;
                    const remaining = budget - totalSpent;
                    const budgetUsed = budget > 0 ? (totalSpent / budget) * 100 : 0;

                    const categorySpending = {};
                    const categoryCount = {};
                    userExpenses.forEach(exp => {
                        categorySpending[exp.category] = (categorySpending[exp.category] || 0) + exp.amount;
                        categoryCount[exp.category] = (categoryCount[exp.category] || 0) + 1;
                    });

                    const today = new Date();
                    const thisWeek = userExpenses.filter(exp => {
                        const expDate = new Date(exp.date);
                        const weekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                        return expDate >= weekAgo;
                    });

                    const thisMonth = userExpenses.filter(exp => {
                        const expDate = new Date(exp.date);
                        return expDate.getMonth() === today.getMonth() && expDate.getFullYear() === today.getFullYear();
                    });

                    const spendingByDay = {};
                    const spendingByMood = {};
                    const spendingByPayment = {};
                    
                    userExpenses.forEach(exp => {
                        const day = new Date(exp.date).toLocaleDateString('en-US', { weekday: 'long' });
                        spendingByDay[day] = (spendingByDay[day] || 0) + exp.amount;
                        spendingByMood[exp.mood] = (spendingByMood[exp.mood] || 0) + exp.amount;
                        spendingByPayment[exp.paymentMethod] = (spendingByPayment[exp.paymentMethod] || 0) + exp.amount;
                    });

                    this.siteData = {
                        user: {
                            name: currentUser?.fullName || 'Student',
                            regNumber: currentUser?.regNumber || 'Not provided',
                            campus: currentUser?.campus || 'University',
                            monthlyBudget: budget,
                            profileImage: currentUser?.profileImage || null
                        },
                        financials: {
                            totalSpent: totalSpent,
                            remaining: remaining,
                            budgetUsed: budgetUsed,
                            totalExpenses: userExpenses.length,
                            averageExpense: userExpenses.length > 0 ? totalSpent / userExpenses.length : 0,
                            categorySpending: categorySpending,
                            categoryCount: categoryCount,
                            weeklySpending: thisWeek.reduce((sum, exp) => sum + exp.amount, 0),
                            monthlySpending: thisMonth.reduce((sum, exp) => sum + exp.amount, 0),
                            topCategory: Object.keys(categorySpending).reduce((a, b) => 
                                categorySpending[a] > categorySpending[b] ? a : b, 'none'),
                            savingsRate: budget > 0 ? (remaining / budget) * 100 : 0,
                            dailyAverage: totalSpent / 30,
                            budgetHealth: budgetUsed < 50 ? 'Excellent' : budgetUsed < 80 ? 'Good' : 'Critical',
                            spendingPatterns: {
                                byDay: spendingByDay,
                                byMood: spendingByMood,
                                byPayment: spendingByPayment
                            }
                        },
                        expenses: userExpenses.slice(-20),
                        insights: this.generateAdvancedInsights(userExpenses, budget, totalSpent)
                    };

                    console.log('‚úÖ Advanced site data updated for AI');
                } catch (error) {
                    console.error('‚ùå Error updating site data:', error);
                }
            }

            generateAdvancedInsights(expenses, budget, totalSpent) {
                const insights = {
                    spendingTrend: 'stable',
                    riskLevel: 'low',
                    recommendations: [],
                    predictions: {}
                };

                if (expenses.length >= 5) {
                    const recent = expenses.slice(-5);
                    const older = expenses.slice(-10, -5);
                    const recentAvg = recent.reduce((sum, exp) => sum + exp.amount, 0) / recent.length;
                    const olderAvg = older.length > 0 ? older.reduce((sum, exp) => sum + exp.amount, 0) / older.length : recentAvg;
                    
                                       if (recentAvg > olderAvg * 1.2) insights.spendingTrend = 'increasing';
                    else if (recentAvg < olderAvg * 0.8) insights.spendingTrend = 'decreasing';
                }

                const budgetUsed = budget > 0 ? (totalSpent / budget) * 100 : 0;
                if (budgetUsed > 90) insights.riskLevel = 'high';
                else if (budgetUsed > 70) insights.riskLevel = 'medium';

                return insights;
            }

            async generateResponse(userMessage) {
                this.updateSiteData();
                
                this.conversationHistory.push({
                    role: 'user',
                    content: userMessage,
                    timestamp: new Date().toISOString(),
                    userData: {
                        budget: this.siteData.user.monthlyBudget,
                        spent: this.siteData.financials.totalSpent,
                        budgetHealth: this.siteData.financials.budgetHealth
                    }
                });

                const message = userMessage.toLowerCase().trim();
                
                if (this.isGreeting(message)) {
                    return this.handleGreeting(userMessage);
                }
                
                if (this.isAdminContact(message)) {
                    return this.handleAdvancedAdminContact();
                }
                
                if (this.isIssueReport(message)) {
                    return this.handleAdvancedIssueReport();
                }

                if (this.isLifeAdvice(message)) {
                    return this.handleLifeAdvice(message, this.siteData);
                }

                try {
                    const response = await this.callAdvancedGrokAI(userMessage);
                    
                    this.conversationHistory.push({
                        role: 'assistant',
                        content: response,
                        timestamp: new Date().toISOString()
                    });
                    
                    this.saveConversationHistory();
                    this.updateUserMemory(userMessage, response);
                    return response;
                    
                } catch (error) {
                    console.error('AI API Error:', error);
                    return this.generateAdvancedFallbackResponse(userMessage);
                }
            }

            isGreeting(message) {
                const greetings = ['hi', 'hello', 'hey', 'good morning', 'good afternoon', 'good evening', 'namaste', 'hola'];
                return greetings.some(greeting => message.includes(greeting));
            }

            isAdminContact(message) {
                return message.includes('contact administrator') || message.includes('contact admin') || message.includes('admin support');
            }

            isIssueReport(message) {
                return message.includes('report issue') || message.includes('facing issue') || message.includes('technical problem') || message.includes('bug') || message.includes('error');
            }

            isLifeAdvice(message) {
                return message.includes('life advice') || message.includes('motivation') || message.includes('goals') || message.includes('inspiration');
            }

            handleGreeting(message) {
                const greetings = [
                    `Hello ${this.siteData.user.name}! üëã Great to see you again! I'm your advanced AI assistant with complete access to your financial data.`,
                    `Hey there ${this.siteData.user.name}! üåü Welcome back to your ultimate financial command center!`,
                    `Hi ${this.siteData.user.name}! ü§ñ I'm ready to help you with intelligent financial insights and life advice.`,
                    `Good to see you, ${this.siteData.user.name}! üí´ Your AI financial companion is online and ready!`
                ];

                const greeting = greetings[Math.floor(Math.random() * greetings.length)];
                
                return `${greeting}

**Your Current Status:**
‚Ä¢ Budget: ‚Çπ${this.siteData.user.monthlyBudget.toLocaleString('en-IN')}
‚Ä¢ Spent: ‚Çπ${this.siteData.financials.totalSpent.toLocaleString('en-IN')} (${this.siteData.financials.budgetUsed.toFixed(1)}%)
‚Ä¢ Health: ${this.siteData.financials.budgetHealth}
‚Ä¢ This conversation: #${this.userMemory.profile.conversations}

**What would you like to explore today?**
‚Ä¢ Budget analysis and optimization
‚Ä¢ Spending insights and recommendations  
‚Ä¢ F1, entertainment, and lifestyle advice
‚Ä¢ Life coaching and goal setting
‚Ä¢ Technical support and admin contact

Ask me anything! I'm here to help! üöÄ`;
            }

            async callAdvancedGrokAI(userMessage) {
                const systemPrompt = this.buildAdvancedSystemPrompt();
                const contextualMessage = this.buildAdvancedContextualMessage(userMessage);
                
                const response = await fetch('https://api.x.ai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${this.apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'grok-beta',
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: contextualMessage }
                        ],
                        max_tokens: 1000,
                        temperature: 0.7,
                        top_p: 0.9,
                        frequency_penalty: 0.1,
                        presence_penalty: 0.1
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} - ${response.statusText}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;
            }

            buildAdvancedSystemPrompt() {
                return `You are an ultra-intelligent AI financial assistant for ${this.siteData.user.name}, a student at ${this.siteData.user.campus} (Reg: ${this.siteData.user.regNumber}).

You have complete access to their real-time financial data and conversation history. You can answer ANY question about money, life, entertainment, F1, sports, relationships, studies, career, or general topics with high intelligence and personalization.

COMPLETE USER PROFILE:
${JSON.stringify(this.siteData, null, 2)}

CONVERSATION MEMORY:
${this.conversationHistory.slice(-6).map(msg => `${msg.role}: ${msg.content.substring(0, 200)}`).join('\n')}

USER MEMORY & PREFERENCES:
${JSON.stringify(this.userMemory, null, 2)}

PERSONALITY: Be extremely intelligent, helpful, personal, conversational, and engaging. Use their actual name and data in every response. Provide specific actionable advice with exact calculations. Be like the smartest friend who knows everything about their life and finances.

CAPABILITIES:
- Complete financial analysis with exact numbers and percentages
- Life coaching and personal development advice
- Entertainment and F1 discussions with budget considerations
- Academic and career guidance
- Technical support and administrative help
- Relationship and social advice
- Health and wellness recommendations
- General knowledge on any topic

Always provide detailed, intelligent responses that demonstrate deep understanding of their situation and genuine care for their wellbeing.`;
            }

            buildAdvancedContextualMessage(userMessage) {
                const recentHistory = this.conversationHistory.slice(-4).map(msg => 
                    `${msg.role}: ${msg.content}`).join('\n');

                return `CURRENT CONVERSATION CONTEXT:
${recentHistory}

USER'S CURRENT FINANCIAL STATE:
- Budget Status: ${this.siteData.financials.budgetHealth}
- Budget Used: ${this.siteData.financials.budgetUsed.toFixed(1)}%
- Remaining: ‚Çπ${this.siteData.financials.remaining.toLocaleString('en-IN')}
- Recent Spending: ‚Çπ${this.siteData.financials.weeklySpending.toLocaleString('en-IN')} this week
- Top Category: ${this.siteData.financials.topCategory}
- Savings Rate: ${this.siteData.financials.savingsRate.toFixed(1)}%

USER'S CURRENT QUESTION: "${userMessage}"

Please provide a comprehensive, intelligent, and personalized response that:
1. Addresses their question directly with specific details
2. Uses their actual financial data for calculations and advice
3. Considers their conversation history and preferences
4. Provides actionable recommendations with exact numbers
5. Shows genuine understanding and care for their situation

Be conversational, engaging, and demonstrate the intelligence of a world-class advisor.`;
            }

            generateAdvancedFallbackResponse(userMessage) {
                const message = userMessage.toLowerCase();
                const data = this.siteData;
                
                if (message.includes('f1') || message.includes('formula 1') || message.includes('race') || message.includes('sports')) {
                    return this.handleF1AndSports(message, data);
                }
                
                if (message.includes('budget') || message.includes('spend') || message.includes('money') || message.includes('financial')) {
                    return this.handleAdvancedBudgetQuery(message, data);
                }
                
                if (message.includes('save') || message.includes('saving') || message.includes('invest')) {
                    return this.handleAdvancedSavingsQuery(message, data);
                }
                
                if (message.includes('buy') || message.includes('purchase') || message.includes('should i spend')) {
                    return this.handleAdvancedPurchaseAdvice(message, data);
                }
                
                return this.handleAdvancedGeneralQuery(message, data);
            }

            handleF1AndSports(message, data) {
                const affordability = data.financials.remaining;
                const budgetHealth = data.financials.budgetHealth;
                
                if (affordability < 1000) {
                    return `Hi ${data.user.name}! üèéÔ∏è **F1 & Sports - Budget-Conscious Approach:**

With only ‚Çπ${affordability.toLocaleString('en-IN')} remaining and ${budgetHealth} budget health, let's be smart about F1 and sports entertainment!

**Budget-Friendly F1 Options:**
üÜì **Free Options:**
‚Ä¢ F1 highlights on YouTube (official F1 channel)
‚Ä¢ Race analysis and discussions on Reddit r/formula1
‚Ä¢ F1 podcasts (Beyond the Grid, etc.)
‚Ä¢ Live text updates on F1.com

üí∞ **Low-Cost Options:**
‚Ä¢ Split F1 TV subscription with friends: ‚Çπ200-400/person
‚Ä¢ Watch at sports cafes: ‚Çπ200-500 per race (with food)
‚Ä¢ F1 mobile games and simulators (free/‚Çπ100-300)

**Smart Entertainment Budget:**
Instead of expensive F1, try:
‚Ä¢ YouTube sports content (free)
‚Ä¢ Local sports events (‚Çπ50-200)
‚Ä¢ Cricket matches at stadiums (‚Çπ200-800)

**My Recommendation:** Focus on free F1 content until your budget improves. Set a goal: "When I have ‚Çπ3000+ remaining, I'll get F1 TV Pro!" 

Stay passionate about F1 while being financially responsible! üèÅ`;
                } else if (affordability > 5000) {
                    return `Hi ${data.user.name}! üèéÔ∏è **F1 & Sports - You Can Enjoy Premium!**

Excellent! With ‚Çπ${affordability.toLocaleString('en-IN')} remaining and ${budgetHealth} budget health, you can definitely enjoy F1 and sports!

**Premium F1 Recommendations:**
üèÜ **Go for Gold:**
‚Ä¢ F1 TV Pro: ‚Çπ1,599/year (incredible value - all races, onboards, replays)
‚Ä¢ Premium sports bars: ‚Çπ800-1500 per race weekend
‚Ä¢ F1 merchandise: ‚Çπ1000-3000 for quality items
‚Ä¢ F1 games: F1 23 (‚Çπ2000-4000)

**Monthly Entertainment Budget:**
‚Ä¢ F1 TV Pro: ‚Çπ133/month (annual plan)
‚Ä¢ Race weekend treats: ‚Çπ500-800
‚Ä¢ Sports events: ‚Çπ1000-2000
‚Ä¢ **Total recommended:** ‚Çπ1500-3000/month

**2025 F1 Season Highlights:**
Amazing season ahead! You can afford to follow closely. Consider:
‚Ä¢ Attending Indian GP if it returns
‚Ä¢ Planning Singapore/Abu Dhabi trip (save ‚Çπ50,000-80,000)
‚Ä¢ Joining F1 fan clubs and events

**Smart Spending Strategy:**
Allocate 15-20% of remaining budget to entertainment. You've earned this enjoyment through good financial discipline! üèÅ‚ú®`;
                }
                
                return `Hi ${data.user.name}! üèéÔ∏è **F1 & Sports - Balanced Approach:**

With ‚Çπ${affordability.toLocaleString('en-IN')} remaining, you have some good options:

**Recommended F1 Strategy:**
‚Ä¢ F1 TV Pro: ‚Çπ1,599/year (‚Çπ133/month) - Worth it for serious fans
‚Ä¢ Occasional sports bar visits: ‚Çπ500-800/month
‚Ä¢ F1 merchandise budget: ‚Çπ300-500/month

**Smart Balance:**
Set monthly entertainment limit: ‚Çπ1200-1800 (including F1, movies, other fun)

**2025 Season Updates:**
The season is fantastic! You can follow reasonably within budget. Consider splitting costs with friends or choosing key races to watch at premium venues.

Remember: Enjoy F1 but don't compromise your financial stability! üèÅ`;
            }

            handleAdvancedBudgetQuery(message, data) {
                const status = data.financials.budgetUsed < 50 ? '‚úÖ Excellent' : 
                             data.financials.budgetUsed < 80 ? '‚ö†Ô∏è Caution' : 'üî¥ Critical Alert';
                
                return `Hi ${data.user.name}! ${status}

**üéØ COMPREHENSIVE BUDGET INTELLIGENCE:**

**Current Financial Status:**
‚Ä¢ **Monthly Budget:** ‚Çπ${data.user.monthlyBudget.toLocaleString('en-IN')}
‚Ä¢ **Total Spent:** ‚Çπ${data.financials.totalSpent.toLocaleString('en-IN')} (${data.financials.budgetUsed.toFixed(1)}%)
‚Ä¢ **Remaining:** ‚Çπ${data.financials.remaining.toLocaleString('en-IN')}
‚Ä¢ **Daily Average:** ‚Çπ${data.financials.dailyAverage.toFixed(0)}
‚Ä¢ **Weekly Spending:** ‚Çπ${data.financials.weeklySpending.toLocaleString('en-IN')}

**üìä Category Performance:**
‚Ä¢ **Top Category:** ${this.getCategoryLabel(data.financials.topCategory)} (‚Çπ${data.financials.categorySpending[data.financials.topCategory]?.toLocaleString('en-IN') || '0'})
‚Ä¢ **Total Transactions:** ${data.financials.totalExpenses}
‚Ä¢ **Average Transaction:** ‚Çπ${data.financials.averageExpense.toFixed(0)}

**üéØ Advanced Insights:**
‚Ä¢ **Savings Rate:** ${data.financials.savingsRate.toFixed(1)}% (Target: 20-30%)
‚Ä¢ **Budget Health:** ${data.financials.budgetHealth}
‚Ä¢ **Risk Level:** ${data.insights?.riskLevel || 'Low'}
‚Ä¢ **Spending Trend:** ${data.insights?.spendingTrend || 'Stable'}

**üí° AI Recommendations:**
${data.financials.budgetUsed < 50 ? 
'üü¢ **Excellent Control!** Consider increasing savings or investing surplus.' :
data.financials.budgetUsed < 80 ?
'üü° **Good Management.** Monitor discretionary spending closely.' :
'üî¥ **Action Required!** Focus on essentials only. Cut entertainment and dining out.'}

**Next Steps:** Ask me "How can I optimize my spending?" or "Show me savings strategies!" üöÄ`;
            }

            handleAdvancedSavingsQuery(message, data) {
                const savingsAmount = data.financials.remaining;
                const savingsRate = data.financials.savingsRate;
                
                return `Hi ${data.user.name}! üíé **ULTIMATE SAVINGS STRATEGY:**

**Current Savings Analysis:**
‚Ä¢ **Monthly Savings:** ‚Çπ${savingsAmount.toLocaleString('en-IN')} (${savingsRate.toFixed(1)}% of budget)
‚Ä¢ **Annual Projection:** ‚Çπ${(savingsAmount * 12).toLocaleString('en-IN')}
‚Ä¢ **Target:** 25% savings rate (‚Çπ${(data.user.monthlyBudget * 0.25).toFixed(0)})

**üéØ Personalized Savings Plan:**

**Immediate Actions (This Month):**
${data.financials.categorySpending.food > data.user.monthlyBudget * 0.4 ? 
'üçΩÔ∏è **Food Optimization:** You\'re spending ‚Çπ' + (data.financials.categorySpending.food || 0).toLocaleString('en-IN') + ' on food (high). Cook more meals = Save ‚Çπ2,000-3,500/month' : ''}
${data.financials.categorySpending.entertainment > data.user.monthlyBudget * 0.15 ?
'üé¨ **Entertainment Control:** Consider reducing by ‚Çπ1,000/month. Use free activities.' : ''}

**Advanced Savings Strategies:**
‚Ä¢ **50/30/20 Rule:** ‚Çπ${(data.user.monthlyBudget * 0.5).toFixed(0)} needs, ‚Çπ${(data.user.monthlyBudget * 0.3).toFixed(0)} wants, ‚Çπ${(data.user.monthlyBudget * 0.2).toFixed(0)} savings
‚Ä¢ **Automated Savings:** Set up ‚Çπ${Math.min(2000, savingsAmount * 0.5).toFixed(0)}/month auto-transfer
‚Ä¢ **Student Hacks:** Use discounts, buy used books, cook in groups

**Long-term Wealth Building:**
‚Ä¢ **Emergency Fund:** Target ‚Çπ${(data.user.monthlyBudget * 3).toLocaleString('en-IN')} (3 months expenses)
‚Ä¢ **Investment:** Start SIP with ‚Çπ${Math.max(500, savingsAmount * 0.3).toFixed(0)}/month
‚Ä¢ **Skills Investment:** Spend ‚Çπ500-1000/month on courses/certifications

**Smart Student Savings:**
‚Ä¢ **Textbook Exchange:** Save ‚Çπ1,500-2,500/semester
‚Ä¢ **Group Transportation:** Save ‚Çπ400-800/month
‚Ä¢ **Bulk Buying:** Save ‚Çπ300-600/month on essentials

Your discipline is building wealth! Keep going! üåü`;
            }

            handleAdvancedPurchaseAdvice(message, data) {
                const available = data.financials.remaining;
                
                // Extract amount from message if mentioned
                const amountMatch = message.match(/(\d+)/);
                const requestedAmount = amountMatch ? parseInt(amountMatch[1]) : null;
                
                let advice = `Hi ${data.user.name}! üõí **SMART PURCHASE ADVISOR:**

**Your Financial Position:**
‚Ä¢ **Available Budget:** ‚Çπ${available.toLocaleString('en-IN')}
‚Ä¢ **Budget Health:** ${data.financials.budgetHealth}
‚Ä¢ **Recent Spending:** ‚Çπ${data.financials.weeklySpending.toLocaleString('en-IN')} this week`;

                if (requestedAmount) {
                    const percentage = (requestedAmount / available) * 100;
                    advice += `

**Purchase Analysis for ‚Çπ${requestedAmount.toLocaleString('en-IN')}:**
‚Ä¢ **Percentage of remaining budget:** ${percentage.toFixed(1)}%
‚Ä¢ **Impact assessment:** ${percentage < 20 ? '‚úÖ Low impact' : percentage < 50 ? '‚ö†Ô∏è Moderate impact' : 'üî¥ High impact'}

**Recommendation:**`;
                    
                    if (percentage < 20) {
                        advice += `
‚úÖ **GREEN LIGHT** - You can afford this purchase!
‚Ä¢ It won't significantly impact your budget
‚Ä¢ You'll still have ‚Çπ${(available - requestedAmount).toLocaleString('en-IN')} remaining
‚Ä¢ Consider if it's a need vs want`;
                    } else if (percentage < 50) {
                        advice += `
‚ö†Ô∏è **PROCEED WITH CAUTION**
‚Ä¢ This will use ${percentage.toFixed(1)}% of your remaining budget
‚Ä¢ Ask yourself: Is this essential right now?
‚Ä¢ Consider waiting or finding a cheaper alternative
‚Ä¢ Remaining after purchase: ‚Çπ${(available - requestedAmount).toLocaleString('en-IN')}`;
                    } else {
                        advice += `
üî¥ **THINK TWICE**
‚Ä¢ This purchase would use ${percentage.toFixed(1)}% of your remaining budget
‚Ä¢ High risk of budget overspend
‚Ä¢ Consider postponing until next month
‚Ä¢ Look for alternatives or discounts`;
                    }
                } else {
                    advice += `

**Purchase Guidelines:**
‚úÖ **Safe purchases:** Up to ‚Çπ${(available * 0.2).toFixed(0)} (20% of remaining)
‚ö†Ô∏è **Consider carefully:** ‚Çπ${(available * 0.2).toFixed(0)} - ‚Çπ${(available * 0.5).toFixed(0)} (20-50% of remaining)
üî¥ **Avoid:** Over ‚Çπ${(available * 0.5).toFixed(0)} (50%+ of remaining)

**Smart Purchase Questions:**
‚Ä¢ Is this a need or want?
‚Ä¢ Can I wait until next month?
‚Ä¢ Is there a cheaper alternative?
‚Ä¢ Will I use this regularly?
‚Ä¢ Can I get student discounts?`;
                }

                advice += `

**Smart Shopping Tips:**
‚Ä¢ **Student discounts:** 10-50% off at most retailers
‚Ä¢ **Compare prices:** Use apps like Google Shopping
‚Ä¢ **Timing matters:** End-of-season sales save 40-70%
‚Ä¢ **Quality over quantity:** Buy fewer, better things

Tell me the specific item and amount for personalized advice! üí°`;

                return advice;
            }

            handleAdvancedGeneralQuery(message, data) {
                return `Hi ${data.user.name}! ü§ñ **Your AI Assistant is Ready**

**Quick Financial Update:**
‚Ä¢ **Budget Status:** ${data.financials.budgetHealth} (${data.financials.budgetUsed.toFixed(1)}% used)
‚Ä¢ **Remaining:** ‚Çπ${data.financials.remaining.toLocaleString('en-IN')}
‚Ä¢ **This Week:** ‚Çπ${data.financials.weeklySpending.toLocaleString('en-IN')} spent
‚Ä¢ **Savings Rate:** ${data.financials.savingsRate.toFixed(1)}%

**üöÄ I can help with ANYTHING:**

**üí∞ Financial Intelligence:**
‚Ä¢ "Complete budget analysis with recommendations"
‚Ä¢ "How can I save ‚Çπ5000 this month?"
‚Ä¢ "Should I buy this ‚ÇπX item?"
‚Ä¢ "Optimize my spending categories"

**üéØ Life & Career Coaching:**
‚Ä¢ "Help me set financial goals"
‚Ä¢ "Career advice for students"
‚Ä¢ "Time management and productivity"
‚Ä¢ "Stress management and wellness"

**üèéÔ∏è Entertainment & Lifestyle:**
‚Ä¢ "F1 season updates and budget impact"
‚Ä¢ "Best student entertainment options"
‚Ä¢ "Travel planning within budget"
‚Ä¢ "Dating and social life on a budget"

**üõ†Ô∏è Technical & Admin Support:**
‚Ä¢ "Contact administrator immediately"
‚Ä¢ "Report technical issues"
‚Ä¢ "Dashboard features and help"
‚Ä¢ "Account management support"

**üéì Academic & Personal:**
‚Ä¢ "Study tips and techniques"
‚Ä¢ "Course and certification recommendations"
‚Ä¢ "Internship and job search advice"
‚Ä¢ "Building professional network"

**I remember our conversations and learn your preferences. What would you like to explore?** üåü

*Tip: Be specific with your questions for the most helpful advice!*`;
            }

            handleAdvancedAdminContact() {
                return `Hi ${this.siteData.user.name}! üë®‚Äçüíº **PRIORITY ADMINISTRATOR CONTACT**

**üö® INSTANT CONTACT OPTIONS:**

**üìû EMERGENCY HOTLINE:**
‚Ä¢ **Phone:** +91-80-1234-5678 (24/7 Support)
‚Ä¢ **WhatsApp:** +91-98765-43210 (Instant Response)
‚Ä¢ **Emergency Email:** urgent@backpackoptimizer.com

**üí¨ REGULAR SUPPORT:**
‚Ä¢ **Main Email:** admin@backpackoptimizer.com
‚Ä¢ **Support Desk:** support@backpackoptimizer.com
‚Ä¢ **Response Time:** 2-4 hours during business hours

**üèõÔ∏è CAMPUS-SPECIFIC SUPPORT:**
‚Ä¢ **Your Campus:** ${this.siteData.user.campus}
‚Ä¢ **Local IT Desk:** Contact your campus IT department
‚Ä¢ **Student Support:** Visit the student services office

**üìã YOUR PROFILE FOR ADMIN:**
\`\`\`
Name: ${this.siteData.user.name}
Registration: ${this.siteData.user.regNumber}
Campus: ${this.siteData.user.campus}
Account Status: Active
Last Login: ${new Date().toLocaleString()}
Issue Category: [Please specify]
\`\`\`

**üîß COMMON ADMIN QUERIES:**
‚Ä¢ Account issues and password resets
‚Ä¢ Budget limit modifications and adjustments
‚Ä¢ Data export and privacy concerns
‚Ä¢ Technical bugs and feature requests
‚Ä¢ Billing and subscription issues
‚Ä¢ Academic integration problems

**üìù PRIORITY ISSUE TEMPLATE:**
\`\`\`
Subject: [URGENT/NORMAL] - Issue Type
User: ${this.siteData.user.name} (${this.siteData.user.regNumber})
Campus: ${this.siteData.user.campus}
Issue: [Describe your problem]
Steps Taken: [What you've already tried]
Expected Resolution: [What you need]
\`\`\`

**‚ö° ESCALATION PATH:**
1. Start with WhatsApp for instant help
2. Email for detailed issues
3. Phone call for urgent problems
4. Campus IT for local support

Would you like me to help draft a specific message to the admin team? Just tell me what issue you're facing! üìß`;
            }

            handleAdvancedIssueReport() {
                return `Hi ${this.siteData.user.name}! üîß **ADVANCED TECHNICAL SUPPORT**

**üö® ISSUE REPORTING SYSTEM ACTIVATED**

**üìã DETAILED REPORT TEMPLATE:**
\`\`\`
=== BACKPACK OPTIMIZER BUG REPORT ===
Reporter: ${this.siteData.user.name}
Registration: ${this.siteData.user.regNumber}
Campus: ${this.siteData.user.campus}
Timestamp: ${new Date().toISOString()}
Browser: [Please check: Chrome/Safari/Firefox/Edge]
Device: [Mobile/Desktop/Tablet]
Operating System: [Windows/Mac/Android/iOS]

Issue Category:
[ ] Dashboard not loading
[ ] Charts not displaying
[ ] AI chatbot not responding
[ ] Data sync problems
[ ] Login/Authentication issues
[ ] Export functionality broken
[ ] Mobile responsiveness problems
[ ] Performance issues
[ ] Data loss or corruption
[ ] Other: _______________

Detailed Description:
[Please describe exactly what happened]

Steps to Reproduce:
1. [First step]
2. [Second step]
3. [Third step]

Expected Behavior:
[What should have happened]

Actual Behavior:
[What actually happened]

Error Messages:
[Any error messages you saw]

Screenshots:
[Please attach if possible]
\`\`\`

**üöÄ IMMEDIATE REPORTING CHANNELS:**

**Priority 1 - URGENT (System Down):**
‚Ä¢ **Emergency WhatsApp:** +91-98765-43210
‚Ä¢ **Emergency Email:** urgent@backpackoptimizer.com
‚Ä¢ **Expected Response:** Within 1 hour

**Priority 2 - HIGH (Feature Broken):**
‚Ä¢ **Technical Email:** tech@backpackoptimizer.com  
‚Ä¢ **Bug Report Form:** bugs.backpackoptimizer.com
‚Ä¢ **Expected Response:** Within 4 hours

**Priority 3 - MEDIUM (Minor Issues):**
‚Ä¢ **Support Email:** support@backpackoptimizer.com
‚Ä¢ **Help Desk:** help.backpackoptimizer.com
‚Ä¢ **Expected Response:** Within 24 hours

**üîç COMMON ISSUES & QUICK FIXES:**

**Dashboard Not Loading:**
‚Ä¢ Clear browser cache and cookies
‚Ä¢ Try incognito/private mode
‚Ä¢ Check internet connection
‚Ä¢ Disable browser extensions

**Charts Not Working:**
‚Ä¢ Refresh the page (Ctrl+F5)
‚Ä¢ Check if you have expenses data
‚Ä¢ Try different browser
‚Ä¢ Enable JavaScript

**AI Chat Not Responding:**
‚Ä¢ Check internet connection
‚Ä¢ Clear browser storage
‚Ä¢ Try sending "hello" to reset
‚Ä¢ Refresh dashboard completely

**üõ†Ô∏è DIAGNOSTIC INFORMATION:**
‚Ä¢ **Current Session:** Active since ${new Date().toLocaleTimeString()}
‚Ä¢ **Data Status:** ${this.siteData.financials.totalExpenses} expenses loaded
‚Ä¢ **AI Status:** Online and responding
‚Ä¢ **API Status:** Functional
‚Ä¢ **Local Storage:** ${Math.round(JSON.stringify(localStorage).length / 1024)}KB used

**üìä SYSTEM HEALTH CHECK:**
‚Ä¢ ‚úÖ User Authentication: Working  
‚Ä¢ ‚úÖ Data Loading: Functional
‚Ä¢ ‚úÖ Chart Rendering: Active
‚Ä¢ ‚úÖ AI Assistant: Online
‚Ä¢ ‚úÖ Export Functions: Available

**What specific issue are you experiencing? I can provide targeted troubleshooting steps!** üéØ`;
            }

            handleLifeAdvice(message, data) {
                return `Hi ${data.user.name}! üåü **LIFE COACHING & MOTIVATION**

**Your Current Life Context:**
‚Ä¢ **Financial Discipline:** ${data.financials.budgetHealth} - This shows great character!
‚Ä¢ **Goal Achievement:** You're tracking ${data.financials.totalExpenses} expenses (excellent habit!)
‚Ä¢ **Personal Growth:** Having conversations like this shows you're taking control!

**üí™ MOTIVATION FOR YOUR JOURNEY:**

**Financial Wisdom = Life Wisdom:**
The discipline you're showing with money will serve you in ALL areas of life. Every rupee you track, every smart decision you make, is building the person you're becoming.

**üéØ GOAL-SETTING FRAMEWORK:**

**Short-term (Next 3 Months):**
‚Ä¢ Financial: Maintain your ${data.financials.savingsRate.toFixed(1)}% savings rate
‚Ä¢ Academic: Set specific GPA or skill targets
‚Ä¢ Personal: Choose one habit to build (exercise, reading, etc.)

**Medium-term (Next Year):**
‚Ä¢ Build emergency fund of ‚Çπ${(data.user.monthlyBudget * 6).toLocaleString('en-IN')}
‚Ä¢ Complete internships or projects
‚Ä¢ Develop professional network

**Long-term (Next 5 Years):**
‚Ä¢ Financial independence foundation
‚Ä¢ Career establishment
‚Ä¢ Personal relationship goals

**üß† MINDSET PRINCIPLES:**

**Growth Mindset:**
Every challenge is a chance to grow. Your current budget discipline is proof you can master anything you set your mind to.

**Compound Effect:**
Small daily actions compound. Your ‚Çπ50 daily savings becomes ‚Çπ18,250 yearly. Same with learning, relationships, health.

**Value-Based Living:**
Your money reflects your values. I can see you value security and planning - these will serve you well in life.

**üí° PRACTICAL LIFE STRATEGIES:**

**Time Management:**
‚Ä¢ Use your budget discipline for time budgeting
‚Ä¢ Track how you spend time like you track money
‚Ä¢ Invest time in high-return activities (learning, networking)

**Relationship Building:**
‚Ä¢ Budget for relationships too (gifts, experiences, helping others)
‚Ä¢ The friends you make in college are lifetime assets
‚Ä¢ Invest in people who invest in you

**Career Development:**
‚Ä¢ Spend ‚Çπ500-1000/month on skill development
‚Ä¢ Build portfolio projects (like this finance app!)
‚Ä¢ Network with seniors and professionals

**Health & Wellness:**
‚Ä¢ Budget for health (gym, healthy food, mental wellness)
‚Ä¢ Healthy habits now save lakhs in medical bills later
‚Ä¢ Mental health is as important as financial health

**üöÄ YOUR NEXT ACTION STEPS:**

1. **Write down 3 specific goals** for next 3 months
2. **Create accountability system** (friends, mentors, apps)
3. **Celebrate small wins** - you're already winning!
4. **Keep learning** - read, watch, listen to grow
5. **Help others** - teach someone about budgeting

**Remember:** You're not just managing money, you're building a life. Every smart financial decision is a vote for the person you're becoming.

**You've got this!** üåü

What specific area of life would you like to work on? I'm here to help you create actionable plans! üí™`;
            }

            updateUserMemory(userMessage, aiResponse) {
                // Track user interests and patterns
                if (userMessage.toLowerCase().includes('f1')) {
                    if (!this.userMemory.interests) this.userMemory.interests = [];
                    if (!this.userMemory.interests.includes('F1')) {
                        this.userMemory.interests.push('F1');
                    }
                }
                
                // Track financial queries
                if (userMessage.toLowerCase().includes('budget') || userMessage.toLowerCase().includes('save')) {
                    if (!this.userMemory.financialHabits) this.userMemory.financialHabits = {};
                    this.userMemory.financialHabits.lastBudgetQuery = new Date().toISOString();
                }
                
                this.saveUserMemory();
            }

            getCategoryLabel(category) {
                const labels = {
                    food: 'üçï Food & Dining',
                    transport: 'üöó Transportation',
                    entertainment: 'üé¨ Entertainment',
                    education: 'üìö Education',
                    shopping: 'üõçÔ∏è Shopping',
                    clothing: 'üëï Clothing',
                    healthcare: 'üè• Healthcare',
                    utilities: '‚ö° Utilities',
                    other: 'üîÑ Other'
                };
                return labels[category] || category;
            }
        }

        // üöÄ APPLICATION STATE AND INITIALIZATION
        let currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
        let expenses = JSON.parse(localStorage.getItem('backpack_expenses') || '[]');
        let spendingTrendChart = null;
        let categoryChart = null;
        let ultimateAI = null;
        


        // üõ°Ô∏è AUTHENTICATION CHECK
        if (!currentUser) {
            window.location.href = 'index.html';
            throw new Error('User not authenticated');
        }

        // üéØ ULTIMATE SEND MESSAGE FUNCTION
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            if (ultimateAI.isTyping) return;

            ultimateAI.isTyping = true;
            addMessageToChat(message, 'user');
            input.value = '';
            showAdvancedTypingIndicator();

            try {
                const response = await ultimateAI.generateResponse(message);
                hideTypingIndicator();
                addMessageToChat(response, 'assistant');
            } catch (error) {
                hideTypingIndicator();
                addMessageToChat('I encountered an issue, but I\'m still learning! Please try again or contact administrator for technical support. üîß', 'assistant');
                console.error('Ultimate AI Error:', error);
            } finally {
                ultimateAI.isTyping = false;
            }
        }

        // üéØ QUICK MESSAGE FUNCTION
        function sendQuickMessage(message) {
            const input = document.getElementById('chatInput');
            input.value = message;
            sendMessage();
        }

        // üéØ ADVANCED CHAT CONTROLS
        function toggleAIChat() {
            const chatElement = document.getElementById('aiChat');
            const triggerBadge = document.getElementById('unreadCount');
            
            if (chatElement.classList.contains('show')) {
                chatElement.classList.remove('show');
                setTimeout(() => {
                    chatElement.style.display = 'none';
                }, 500);
            } else {
                chatElement.style.display = 'flex';
                setTimeout(() => {
                    chatElement.classList.add('show');
                    initializeUltimateAIChat();
                    document.getElementById('chatInput').focus();
                    if (triggerBadge) triggerBadge.style.display = 'none';
                }, 50);
            }
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function startVoiceInput() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                
                recognition.lang = 'en-US';
                recognition.continuous = false;
                recognition.interimResults = false;
                
                recognition.onstart = () => {
                    showFlashMessage('üé§ Voice input active - speak now!', 'info');
                };
                
                recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('chatInput').value = transcript;
                    showFlashMessage('‚úÖ Voice captured: ' + transcript, 'success');
                };
                
                recognition.onerror = () => {
                    showFlashMessage('‚ùå Voice input error. Please try typing.', 'error');
                };
                
                recognition.start();
            } else {
                showFlashMessage('‚ùå Voice input not supported in this browser.', 'error');
            }
        }

        function initializeUltimateAIChat() {
            const container = document.getElementById('chatMessages');
            if (!container) return;

            if (container.children.length === 0) {
                const welcomeMessage = `Hi ${currentUser.fullName}! üëã **Welcome to your Ultimate AI Financial Assistant**

I'm your most advanced AI companion with complete access to your financial data and the ability to help with ANYTHING in life!

**üéØ Your Current Status:**
‚Ä¢ **Budget:** ‚Çπ${(currentUser.monthlyBudget || 0).toLocaleString('en-IN')}
‚Ä¢ **Campus:** ${getCampusName(currentUser.campus)}
‚Ä¢ **Registration:** ${currentUser.regNumber}
‚Ä¢ **Session:** #${ultimateAI.userMemory.profile.conversations}

**üöÄ What I Can Do:**

**üí∞ Financial Intelligence:**
‚Ä¢ Complete budget analysis with AI insights
‚Ä¢ Smart spending recommendations
‚Ä¢ Purchase decision support
‚Ä¢ Savings optimization strategies

**üèéÔ∏è Lifestyle & Entertainment:**
‚Ä¢ F1, sports, and entertainment advice
‚Ä¢ Budget-conscious lifestyle recommendations
‚Ä¢ Travel and experience planning

**üéì Academic & Career:**
‚Ä¢ Study tips and productivity hacks
‚Ä¢ Career guidance and networking
‚Ä¢ Skill development recommendations

**üåü Life Coaching:**
‚Ä¢ Goal setting and achievement strategies
‚Ä¢ Motivation and mindset coaching
‚Ä¢ Relationship and social advice

**üõ†Ô∏è Technical Support:**
‚Ä¢ Dashboard help and troubleshooting
‚Ä¢ Admin contact and issue reporting
‚Ä¢ Feature guidance and tips

**üí≠ General Intelligence:**
I can discuss literally anything - from quantum physics to cooking recipes, with personalized context based on your situation.

**Try the quick action buttons above or ask me anything! I remember our conversations and learn your preferences.** ü§ñ‚ú®`;

                addMessageToChat(welcomeMessage, 'assistant');
            }
        }
// üì± MOBILE SIDEBAR TOGGLE FUNCTIONALITY
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.getElementById('mobileMenuToggle');
    const overlay = document.getElementById('mobileOverlay');
    
    const isOpen = sidebar.classList.contains('mobile-open');
    
    if (isOpen) {
        closeSidebar();
    } else {
        openSidebar();
    }
}

function openSidebar() {
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.getElementById('mobileMenuToggle');
    const overlay = document.getElementById('mobileOverlay');
    
    sidebar.classList.add('mobile-open');
    menuToggle.classList.add('active');
    overlay.classList.add('show');
    
    // Prevent body scroll when sidebar is open
    document.body.style.overflow = 'hidden';
}

function closeSidebar() {
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.getElementById('mobileMenuToggle');
    const overlay = document.getElementById('mobileOverlay');
    
    sidebar.classList.remove('mobile-open');
    menuToggle.classList.remove('active');
    overlay.classList.remove('show');
    
    // Restore body scroll
    document.body.style.overflow = 'auto';
}

// Close sidebar when clicking navigation links (mobile)
document.addEventListener('DOMContentLoaded', function() {
    const navLinks = document.querySelectorAll('.nav-link');
    navLinks.forEach(link => {
        link.addEventListener('click', function() {
            if (window.innerWidth <= 768) {
                closeSidebar();
            }
        });
    });
    
    // Close sidebar on window resize to desktop
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
            closeSidebar();
        }
    });
});

// Handle keyboard navigation (ESC to close)
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && window.innerWidth <= 768) {
        closeSidebar();
    }
});

        // üé® ENHANCED MESSAGE DISPLAY FUNCTIONS
        function addMessageToChat(message, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            if (!messagesContainer) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="user-message">
                        <span class="message-text">${escapeHtml(message)}</span>
                        <span class="message-time">${new Date().toLocaleTimeString()}</span>
                    </div>
                `;
            } else {
                let formattedMessage = message
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/‚Ä¢/g, '&bull;')
                    .replace(/\n\n/g, '<br><br>')
                    .replace(/\n/g, '<br>')
                    .replace(/``````/g, '<div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 10px 0; font-family: monospace; border-left: 4px solid #007AFF; overflow-x: auto;"><pre style="margin: 0; white-space: pre-wrap;">$1</pre></div>')
                    .replace(/`([^`]+)`/g, '<code style="background: #f0f0f0; padding: 2px 6px; border-radius: 4px; font-family: monospace;">$1</code>');
                
                messageDiv.innerHTML = `
                    <div class="ai-message">
                        <div class="ai-avatar-small">ü§ñ</div>
                        <div class="ai-response">
                            <span class="message-text">${formattedMessage}</span>
                            <span class="message-time">${new Date().toLocaleTimeString()}</span>
                        </div>
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showAdvancedTypingIndicator() {
            const messagesContainer = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message assistant typing-indicator';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="ai-message">
                    <div class="ai-avatar-small">ü§ñ</div>
                    <div class="typing-dots">
                        <span>Ultra AI is processing your request...</span>
                        <div class="dots">
                            <span></span><span></span><span></span>
                        </div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // üéØ USER PROFILE MANAGEMENT
        function updateUserProfile() {
            const campusNames = {
                'CHRIST_BLR': 'Christ University - BCA',
                'DU_DELHI': 'Delhi University',
                'VIT_VEL': 'VIT Vellore', 
                'BITS_PIL': 'BITS Pilani',
                'IIT_BOM': 'IIT Bombay',
                'IIT_DEL': 'IIT Delhi'
            };

            const nameElement = document.getElementById('userName');
            const campusElement = document.getElementById('userCampus');
            const regElement = document.getElementById('userRegNumber');
            const avatarElement = document.getElementById('userAvatar');
            const welcomeElement = document.getElementById('welcomeMessage');

            if (nameElement) nameElement.textContent = currentUser.fullName || 'Student';
            if (campusElement) campusElement.textContent = campusNames[currentUser.campus] || currentUser.campus || 'University';
            if (regElement) regElement.textContent = `Reg: ${currentUser.regNumber || 'Not provided'}`;
            if (welcomeElement) welcomeElement.textContent = `Your most advanced financial companion with world-class AI, ${currentUser.fullName}`;

            if (currentUser.profileImage && currentUser.profileImage.length > 100) {
                avatarElement.innerHTML = `<img src="${currentUser.profileImage}" class="sidebar-profile-image" alt="Profile Picture">`;
            } else {
                avatarElement.textContent = (currentUser.fullName || 'S')[0].toUpperCase();
            }
        }

        // üìä ULTIMATE DASHBOARD UPDATE
        function updateDashboard() {
            console.log('üöÄ Updating ultimate dashboard...');
            
            const userExpenses = expenses.filter(e => e.userId === currentUser.id);
            const totalSpent = userExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            const budget = currentUser.monthlyBudget || 0;
            const remaining = Math.max(0, budget - totalSpent);
            const percentage = budget > 0 ? (totalSpent / budget) * 100 : 0;

            animateValueAdvanced('budgetAmount', 0, budget, 1500, '‚Çπ');
            animateValueAdvanced('spentAmount', 0, totalSpent, 1500, '‚Çπ');  
            animateValueAdvanced('remainingAmount', 0, remaining, 1500, '‚Çπ');

            const savingsRate = Math.max(0, (remaining / budget) * 100);
            animateValueAdvanced('savingsRate', 0, savingsRate, 1500, '', '%');
            
            document.getElementById('spentTrend').textContent = `${percentage.toFixed(1)}% of budget`;
            document.getElementById('remainingTrend').textContent = `${(100 - percentage).toFixed(1)}% available`;

            setTimeout(() => {
                const progressBar = document.getElementById('budgetProgressBar');
                const progressText = document.getElementById('progressText');
                const progressMiddle = document.getElementById('progressMiddle');
                const budgetMax = document.getElementById('budgetMax');
                const userExpenses = expenses.filter(e => e.userId === currentUser.id);
    updateCharts(userExpenses);
    
                if (progressBar) {
                    progressBar.style.width = Math.min(percentage, 100) + '%';
                    
                    if (percentage > 90) {
                        progressBar.style.background = 'linear-gradient(135deg, #FF3B30, #FF9500)';
                    } else if (percentage > 70) {
                        progressBar.style.background = 'linear-gradient(135deg, #FF9500, #FFCC02)';
                    } else {
                        progressBar.style.background = 'var(--gradient-primary)';
                    }
                }
                
                if (progressText) progressText.textContent = `‚Çπ${totalSpent.toLocaleString('en-IN')} spent (${percentage.toFixed(1)}%)`;
                if (progressMiddle) progressMiddle.textContent = `‚Çπ${(budget / 2).toLocaleString('en-IN')} mid-point`;
                if (budgetMax) budgetMax.textContent = `‚Çπ${budget.toLocaleString('en-IN')}`;
            }, 500);

            updateAdvancedBudgetBreakdown(totalSpent, budget, userExpenses.length);
            updateAdvancedCategoryRecommendations(userExpenses, totalSpent);
            updateAdvancedMetricsGrid(userExpenses);
            generateUltimateAIInsights(userExpenses, totalSpent, budget);
            updateCharts(userExpenses); // Using your original chart function
            updateAdvancedRecentExpenses(userExpenses);
        }

        // üìä USING YOUR ORIGINAL CHARTS UPDATE FUNCTION
        // üìä ENHANCED CHART UPDATE FUNCTION WITH FIXES
function updateCharts(userExpenses) {
    console.log('üîÑ Updating charts with expenses:', userExpenses.length);
    
    try {
        // Destroy existing charts first
        if (spendingTrendChart) {
            spendingTrendChart.destroy();
            spendingTrendChart = null;
        }
        if (categoryChart) {
            categoryChart.destroy();
            categoryChart = null;
        }

        setTimeout(() => {
            const ctx1 = document.getElementById('spendingTrendChart');
            const ctx2 = document.getElementById('categoryChart');
            
            if (!ctx1 || !ctx2) {
                console.error('‚ùå Canvas elements not found');
                return;
            }
            
            ctx1.width = 400;
            ctx1.height = 300;
            ctx2.width = 300;
            ctx2.height = 300;
            
            const context1 = ctx1.getContext('2d');
            const context2 = ctx2.getContext('2d');
            
            context1.clearRect(0, 0, ctx1.width, ctx1.height);
            context2.clearRect(0, 0, ctx2.width, ctx2.height);
            
            // SPENDING TREND CHART
            const last7Days = [];
            const dailySpending = {};
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                last7Days.push(dateStr);
                dailySpending[dateStr] = 0;
            }
            
            userExpenses.forEach(expense => {
                const expenseDate = expense.date.split('T')[0];
                if (dailySpending.hasOwnProperty(expenseDate)) {
                    dailySpending[expenseDate] += expense.amount;
                }
            });
            
            const labels = last7Days.map(date => new Date(date).toLocaleDateString('en-US', { weekday: 'short' }));
            const data = last7Days.map(date => dailySpending[date]);
            
            spendingTrendChart = new Chart(context1, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Daily Spending (‚Çπ)',
                        data: data,
                        borderColor: '#007AFF',
                        backgroundColor: 'rgba(0, 122, 255, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#007AFF',
                        pointBorderColor: 'white',
                        pointBorderWidth: 3,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '‚Çπ' + value;
                                }
                            }
                        }
                    }
                }
            });

            // CATEGORY CHART
            if (userExpenses.length > 0) {
                const categories = {};
                userExpenses.forEach(exp => {
                    categories[exp.category] = (categories[exp.category] || 0) + exp.amount;
                });
                
                categoryChart = new Chart(context2, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(categories).map(cat => getCategoryLabel(cat)),
                        datasets: [{
                            data: Object.values(categories),
                            backgroundColor: [
                                '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', 
                                '#FFEAA7', '#DDA0DD', '#98D8C8', '#F093FB'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { padding: 20, usePointStyle: true }
                            }
                        }
                    }
                });
            } else {
                context2.font = '16px Arial';
                context2.fillStyle = '#8E8E93';
                context2.textAlign = 'center';
                context2.fillText('Add expenses to see breakdown', ctx2.width / 2, ctx2.height / 2);
            }
            
            console.log('‚úÖ Charts updated successfully');
        }, 100);
        
    } catch (error) {
        console.error('‚ùå Chart update error:', error);
    }
}



        // Enhanced animation function
        function animateValueAdvanced(elementId, start, end, duration, prefix = '', suffix = '') {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            let startTime = null;
            
            function updateValue(currentTime) {
                if (!startTime) startTime = currentTime;
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const current = start + (end - start) * easeOutQuart;
                
                element.textContent = prefix + Math.floor(current).toLocaleString('en-IN') + suffix;
                
                if (progress < 1) {
                    element.style.transform = `scale(${1 + Math.sin(progress * Math.PI) * 0.1})`;
                    requestAnimationFrame(updateValue);
                } else {
                    element.style.transform = 'scale(1)';
                }
            }
            
            requestAnimationFrame(updateValue);
        }

        function updateAdvancedBudgetBreakdown(totalSpent, budget, expenseCount) {
            const avgExpense = expenseCount > 0 ? totalSpent / expenseCount : 0;
            const budgetLeft = budget > 0 ? ((budget - totalSpent) / budget * 100) : 100;
            const daysInMonth = new Date().getDate();
            const daysLeft = 30 - daysInMonth;
            const projectedSpend = totalSpent + (avgExpense * daysLeft);
            
            const container = document.getElementById('budgetBreakdown');
            if (container) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 15px; background: rgba(52, 199, 89, 0.1); border-radius: 15px;">
                        <div style="font-size: 24px; font-weight: 800; color: var(--success-green);">${Math.max(0, budgetLeft).toFixed(0)}%</div>
                        <div style="font-size: 12px; color: var(--system-gray); font-weight: 600;">BUDGET LEFT</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(0, 122, 255, 0.1); border-radius: 15px;">
                        <div style="font-size: 24px; font-weight: 800; color: var(--primary-blue);">‚Çπ${avgExpense.toFixed(0)}</div>
                        <div style="font-size: 12px; color: var(--system-gray); font-weight: 600;">AVG EXPENSE</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255, 149, 0, 0.1); border-radius: 15px;">
                        <div style="font-size: 24px; font-weight: 800; color: var(--warning-orange);">${Math.max(0, daysLeft)}</div>
                        <div style="font-size: 12px; color: var(--system-gray); font-weight: 600;">DAYS LEFT</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(88, 86, 214, 0.1); border-radius: 15px;">
                        <div style="font-size: 24px; font-weight: 800; color: var(--primary-purple);">‚Çπ${projectedSpend.toFixed(0)}</div>
                        <div style="font-size: 12px; color: var(--system-gray); font-weight: 600;">PROJECTED</div>
                    </div>
                `;
            }
        }

        function updateAdvancedCategoryRecommendations(userExpenses, totalSpent) {
            const container = document.getElementById('categoryRecommendations');
            if (!container) return;
            
            const categories = {};
            userExpenses.forEach(exp => {
                categories[exp.category] = (categories[exp.category] || 0) + exp.amount;
            });

            const recommendations = {
                food: { percentage: 35, name: 'Food & Dining', icon: 'üçï', color: '#FF6B6B' },
                transport: { percentage: 15, name: 'Transportation', icon: 'üöó', color: '#4ECDC4' },
                entertainment: { percentage: 12, name: 'Entertainment', icon: 'üé¨', color: '#45B7D1' },
                clothing: { percentage: 15, name: 'Clothing', icon: 'üëï', color: '#96CEB4' },
                education: { percentage: 13, name: 'Education', icon: 'üìö', color: '#FFEAA7' },
                shopping: { percentage: 10, name: 'Shopping', icon: 'üõçÔ∏è', color: '#DDA0DD' }
            };

            const budget = currentUser.monthlyBudget || 0;
            
            if (budget === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üí∞</div>
                        <div style="font-size: 18px; font-weight: 700;">Budget Not Set</div>
                        <div style="margin-top: 10px;">Set your budget to see AI recommendations</div>
                    </div>
                `;
                return;
            }

            const recommendationHTML = Object.entries(recommendations).map(([category, info]) => {
                const spent = categories[category] || 0;
                const recommended = Math.max(0, (budget * info.percentage) / 100);
                const remaining = Math.max(0, recommended - spent);
                const isOverBudget = spent > recommended;
                const percentage = recommended > 0 ? (spent / recommended) * 100 : 0;
                
                return `
                    <div style="background: white; padding: 25px; border-radius: 18px; box-shadow: 0 6px 20px rgba(0,0,0,0.1); transition: var(--transition); position: relative; overflow: hidden; cursor: pointer;" onmouseover="this.style.transform='translateY(-5px) scale(1.02)'" onmouseout="this.style.transform='translateY(0) scale(1)'">
                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: ${isOverBudget ? 'var(--danger-red)' : info.color};"></div>
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                            <div style="font-size: 32px; background: ${info.color}20; padding: 12px; border-radius: 15px; display: flex; align-items: center; justify-content: center;">${info.icon}</div>
                            <div style="flex: 1;">
                                <h4 style="color: var(--text-primary); margin: 0; font-weight: 800; font-size: 16px;">${info.name}</h4>
                                <p style="margin: 0; font-size: 12px; color: var(--system-gray); font-weight: 600;">${info.percentage}% of total budget</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 14px; font-weight: 800; color: ${isOverBudget ? 'var(--danger-red)' : 'var(--success-green)'};">${percentage.toFixed(0)}%</div>
                                <div style="font-size: 10px; color: var(--system-gray);">Used</div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px;">
                                <span style="color: var(--system-gray); font-weight: 600;">Recommended</span>
                                <span style="font-weight: 800; color: var(--text-primary);">‚Çπ${recommended.toFixed(0)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px;">
                                <span style="color: var(--system-gray); font-weight: 600;">Spent</span>
                                <span style="font-weight: 800; color: ${isOverBudget ? 'var(--danger-red)' : 'var(--primary-blue)'};">‚Çπ${spent.toFixed(0)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 13px;">
                                <span style="color: var(--system-gray); font-weight: 600;">${isOverBudget ? 'Over by' : 'Remaining'}</span>
                                <span style="font-weight: 800; color: ${isOverBudget ? 'var(--danger-red)' : 'var(--success-green)'};">‚Çπ${Math.abs(remaining).toFixed(0)}</span>
                            </div>
                        </div>
                        
                        <div style="background: var(--system-gray5); border-radius: 8px; height: 8px; overflow: hidden; margin: 15px 0;">
                            <div style="height: 100%; width: ${Math.min(percentage, 100)}%; background: ${isOverBudget ? 'var(--danger-red)' : info.color}; border-radius: 8px; transition: width 1s ease; position: relative;">
                                ${percentage > 100 ? `<div style="position: absolute; right: -2px; top: -2px; width: 4px; height: 12px; background: var(--danger-red); border-radius: 2px;"></div>` : ''}
                            </div>
                        </div>
                        
                        <div style="font-size: 11px; padding: 8px 12px; border-radius: 8px; font-weight: 600; ${isOverBudget ? 
                            'color: var(--danger-red); background: rgba(255, 59, 48, 0.1);' :
                            percentage > 80 ? 'color: var(--warning-orange); background: rgba(255, 149, 0, 0.1);' :
                            'color: var(--success-green); background: rgba(52, 199, 89, 0.1);'
                        }">
                            ${isOverBudget ? '‚ö†Ô∏è Over budget - reduce spending' : 
                              percentage > 80 ? '‚ö° Close to limit - monitor closely' : 
                              '‚úÖ Within healthy limits'}
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = recommendationHTML;
        }

        function updateAdvancedMetricsGrid(userExpenses) {
            const container = document.getElementById('metricsGridContent');
            if (!container) return;

            if (userExpenses.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; background: var(--surface); border-radius: 20px; border: 2px dashed var(--system-gray4);">
                        <div style="font-size: 64px; margin-bottom: 20px; opacity: 0.7; animation: bounce 2s infinite;">üìä</div>
                        <div style="font-size: 20px; font-weight: 800; margin-bottom: 10px; color: var(--text-primary);">No Analytics Data Yet</div>
                        <div style="color: var(--system-gray); margin-bottom: 20px;">Add expenses to unlock powerful insights and advanced analytics</div>
                        <button onclick="window.location.href='add-expense.html'" style="background: var(--gradient-primary); color: white; border: none; padding: 12px 25px; border-radius: 15px; font-weight: 700; cursor: pointer;">Add Your First Expense</button>
                    </div>
                `;
                return;
            }

            const totalSpent = userExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            const avgExpense = totalSpent / userExpenses.length;
            const budget = currentUser.monthlyBudget || 0;
            const budgetUsed = budget > 0 ? (totalSpent / budget * 100) : 0;

            const categories = {};
            const paymentMethods = {};
            const moodSpending = {};
            
            userExpenses.forEach(exp => {
                categories[exp.category] = (categories[exp.category] || 0) + exp.amount;
                paymentMethods[exp.paymentMethod || 'card'] = (paymentMethods[exp.paymentMethod || 'card'] || 0) + exp.amount;
                moodSpending[exp.mood || 'neutral'] = (moodSpending[exp.mood || 'neutral'] || 0) + exp.amount;
            });

            const topCategory = Object.keys(categories).reduce((a, b) => 
                categories[a] > categories[b] ? a : b, 'none');
            const topPayment = Object.keys(paymentMethods).reduce((a, b) => 
                paymentMethods[a] > paymentMethods[b] ? a : b, 'card');
            const topMood = Object.keys(moodSpending).reduce((a, b) => 
                moodSpending[a] > moodSpending[b] ? a : b, 'neutral');

            const thisWeek = userExpenses.filter(exp => {
                const expDate = new Date(exp.date);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return expDate >= weekAgo;
            });

            const lastWeek = userExpenses.filter(exp => {
                const expDate = new Date(exp.date);
                const twoWeeksAgo = new Date();
                twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return expDate >= twoWeeksAgo && expDate < weekAgo;
            });

            const thisWeekSpend = thisWeek.reduce((sum, exp) => sum + exp.amount, 0);
            const lastWeekSpend = lastWeek.reduce((sum, exp) => sum + exp.amount, 0);
            const weeklyTrend = lastWeekSpend > 0 ? ((thisWeekSpend - lastWeekSpend) / lastWeekSpend) * 100 : 0;

            container.innerHTML = `
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon">üìä</div>
                        <div class="metric-value">‚Çπ${avgExpense.toFixed(0)}</div>
                    </div>
                    <div class="metric-label">Average Transaction</div>
                    <div class="metric-trend trend-neutral">From ${userExpenses.length} expenses</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon">üéØ</div>
                        <div class="metric-value">${budgetUsed.toFixed(1)}%</div>
                    </div>
                    <div class="metric-label">Budget Utilization</div>
                    <div class="metric-trend ${budgetUsed < 70 ? 'trend-up' : budgetUsed < 90 ? 'trend-neutral' : 'trend-down'}">
                        ${budgetUsed < 70 ? 'Healthy spending' : budgetUsed < 90 ? 'Monitor closely' : 'Critical level'}
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon">${getCategoryIcon(topCategory)}</div>
                        <div class="metric-value">‚Çπ${categories[topCategory] ? categories[topCategory].toFixed(0) : '0'}</div>
                    </div>
                    <div class="metric-label">Top Category</div>
                    <div class="metric-trend trend-up">${getCategoryLabel(topCategory)} - ${((categories[topCategory] || 0) / totalSpent * 100).toFixed(0)}%</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon">üìà</div>
                        <div class="metric-value">${weeklyTrend > 0 ? '+' : ''}${weeklyTrend.toFixed(1)}%</div>
                    </div>
                    <div class="metric-label">Weekly Trend</div>
                    <div class="metric-trend ${weeklyTrend > 10 ? 'trend-down' : weeklyTrend > -10 ? 'trend-neutral' : 'trend-up'}">
                        ${weeklyTrend > 10 ? 'Spending increased' : weeklyTrend > -10 ? 'Spending stable' : 'Spending decreased'}
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon">${getPaymentIcon(topPayment)}</div>
                        <div class="metric-value">‚Çπ${paymentMethods[topPayment] ? paymentMethods[topPayment].toFixed(0) : '0'}</div>
                    </div>
                    <div class="metric-label">Top Payment Method</div>
                    <div class="metric-trend trend-neutral">${getPaymentLabel(topPayment)} preferred</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-header">
                        <div class="metric-icon">${getMoodIcon(topMood)}</div>
                        <div class="metric-value">‚Çπ${moodSpending[topMood] ? moodSpending[topMood].toFixed(0) : '0'}</div>
                    </div>
                    <div class="metric-label">Mood-Based Spending</div>
                    <div class="metric-trend trend-neutral">Most spent when ${topMood}</div>
                </div>
            `;
        }

        function generateUltimateAIInsights(userExpenses, totalSpent, budget) {
            const container = document.getElementById('aiInsightsContainer');
            if (!container) return;
            
            const insights = [];

            if (userExpenses.length === 0) {
                insights.push("üåü **Welcome to your Ultimate Financial Journey!** Your advanced AI dashboard is ready. Start by adding your first expense to unlock powerful insights based on machine learning algorithms.");
                insights.push("üí° **Smart Start Tip:** The more data you provide, the more intelligent and personalized my recommendations become. I use advanced analytics to understand your spending patterns and optimize your financial health.");
            } else {
                const budgetUsed = budget > 0 ? (totalSpent / budget) * 100 : 0;
                const categories = {};
                userExpenses.forEach(exp => {
                    categories[exp.category] = (categories[exp.category] || 0) + exp.amount;
                });
                const topCategory = Object.keys(categories).reduce((a, b) => 
                    categories[a] > categories[b] ? a : b, 'none');
                
                if (budgetUsed < 30) {
                    insights.push(`üíö **AI Analysis: Exceptional Financial Control!** You've used only ${budgetUsed.toFixed(1)}% of your ‚Çπ${budget.toLocaleString('en-IN')} budget. My algorithms detect excellent spending discipline. Consider increasing your investment allocation or building an emergency fund with the surplus ‚Çπ${(budget - totalSpent).toLocaleString('en-IN')}.`);
                } else if (budgetUsed < 70) {
                    insights.push(`üü° **AI Insight: Balanced Approach Detected.** Your ${budgetUsed.toFixed(1)}% budget utilization shows good financial management. My predictive models suggest maintaining current spending patterns while optimizing your ${topCategory} expenses for better efficiency.`);
                } else if (budgetUsed < 100) {
                    insights.push(`üü† **AI Alert: Budget Optimization Required.** At ${budgetUsed.toFixed(1)}% utilization, you're approaching your limit. My recommendation engine suggests reducing ${topCategory} spending by 15-20% to maintain financial stability.`);
                } else {
                    insights.push(`üî¥ **AI Critical Alert: Budget Exceeded!** You've spent ‚Çπ${totalSpent.toLocaleString('en-IN')} against your ‚Çπ${budget.toLocaleString('en-IN')} budget. My emergency protocols recommend immediate expense reduction in non-essential categories and budget restructuring.`);
                }

                if (userExpenses.length >= 10) {
                    const recentAvg = userExpenses.slice(-5).reduce((sum, exp) => sum + exp.amount, 0) / 5;
                    const overallAvg = totalSpent / userExpenses.length;
                    
                    if (recentAvg > overallAvg * 1.3) {
                        insights.push(`üìà **AI Behavioral Analysis:** Your recent spending pattern shows a 30% increase. My neural network detected potential lifestyle inflation. Consider implementing spending mindfulness techniques to maintain your financial trajectory.`);
                    } else if (recentAvg < overallAvg * 0.7) {
                        insights.push(`üìâ **AI Positive Pattern:** Your recent expenses are 30% lower than average! My algorithms recognize improved financial discipline. This trend, if maintained, could result in ‚Çπ${((overallAvg - recentAvg) * 30).toFixed(0)} additional monthly savings.`);
                    }
                }

                const foodSpending = categories.food || 0;
                const foodPercentage = budget > 0 ? (foodSpending / budget) * 100 : 0;
                if (foodPercentage > 40) {
                    insights.push(`üçΩÔ∏è **AI Nutrition-Finance Analysis:** Your food spending (‚Çπ${foodSpending.toLocaleString('en-IN')}) represents ${foodPercentage.toFixed(1)}% of budget - significantly above the optimal 35%. My meal optimization algorithms suggest home cooking could save you ‚Çπ${(foodSpending * 0.3).toFixed(0)}/month while improving health metrics.`);
                }
            }

            container.innerHTML = insights.map(insight => `
                <div class="ai-insight-item">
                    <strong>${insight}</strong>
                </div>
            `).join('');

            setTimeout(() => {
                const loading = document.querySelector('.loading');
                if (loading) loading.style.opacity = '0';
                setTimeout(() => {
                    if (loading) loading.style.display = 'none';
                }, 500);
            }, 2000);
        }

        function updateAdvancedRecentExpenses(userExpenses) {
            const container = document.getElementById('recentExpensesList');
            const countElement = document.getElementById('expenseCount');
            if (!container) return;
            
            if (countElement) {
                countElement.textContent = `${userExpenses.length} TRANSACTIONS`;
            }
            
            const recentExpenses = userExpenses
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 8);

            if (recentExpenses.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 80px 20px; color: var(--system-gray);">
                        <div style="font-size: 80px; margin-bottom: 30px; opacity: 0.7; animation: bounce 3s infinite;">üìù</div>
                        <div style="font-size: 28px; font-weight: 800; margin-bottom: 15px;">No Financial Activity Yet</div>
                        <div style="margin-bottom: 25px; font-size: 16px; line-height: 1.6;">Your advanced financial dashboard is ready to track and analyze your spending patterns with AI-powered insights!</div>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn btn-success" onclick="window.location.href='add-expense.html'" style="font-size: 16px; padding: 15px 30px;">Add Your First Expense</button>
                            <button class="btn" onclick="showSampleData()" style="background: var(--gradient-info); font-size: 16px; padding: 15px 30px;">See Sample Data</button>
                        </div>
                    </div>
                `;
                return;
            }

            container.innerHTML = recentExpenses.map((expense, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 25px; border: 1px solid var(--system-gray4); border-radius: 20px; margin-bottom: 18px; background: var(--surface); transition: var(--transition); position: relative; overflow: hidden; cursor: pointer;" 
                     onmouseover="this.style.transform='translateX(5px) scale(1.02)'; this.style.boxShadow='0 15px 40px rgba(0,0,0,0.15)'" 
                     onmouseout="this.style.transform='translateX(0) scale(1)'; this.style.boxShadow='none'">
                    
                    <div style="position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: ${getExpenseColor(expense.category)};"></div>
                    
                    <div style="flex: 1; margin-left: 15px;">
                        <div style="font-weight: 800; font-size: 18px; margin-bottom: 12px; color: var(--text-primary); display: flex; align-items: center; gap: 10px;">
                            ${expense.description || 'No description'}
                            ${index === 0 ? '<span style="background: var(--gradient-primary); color: white; padding: 3px 8px; border-radius: 8px; font-size: 10px; font-weight: 600;">LATEST</span>' : ''}
                        </div>
                        <div style="font-size: 14px; color: var(--system-gray); display: flex; gap: 20px; flex-wrap: wrap; align-items: center;">
                            <span style="background: ${getExpenseColor(expense.category)}20; color: ${getExpenseColor(expense.category)}; padding: 6px 12px; border-radius: 12px; font-weight: 700; display: flex; align-items: center; gap: 6px;">
                                ${getCategoryIcon(expense.category)} ${(expense.category || 'other').charAt(0).toUpperCase() + (expense.category || 'other').slice(1)}

                            </span>
                            <span style="font-weight: 600; display: flex; align-items: center; gap: 6px;">
                                üìÖ ${formatDate(expense.date)}
                            </span>
                            <span style="font-weight: 600; display: flex; align-items: center; gap: 6px;">
                                ${getMoodIcon(expense.mood)} ${(expense.mood || 'neutral').charAt(0).toUpperCase() + (expense.mood || 'neutral').slice(1)}
                            </span>
                            <span style="font-weight: 600; display: flex; align-items: center; gap: 6px;">
                                ${getPaymentIcon(expense.paymentMethod)} ${getPaymentLabel(expense.paymentMethod || 'card')}
                            </span>
                            ${expense.location ? `<span style="font-weight: 600; display: flex; align-items: center; gap: 6px; color: var(--info-cyan);">üìç ${expense.location}</span>` : ''}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 900; font-size: 26px; color: var(--danger-red); background: rgba(255, 59, 48, 0.1); padding: 12px 18px; border-radius: 15px; margin-bottom: 8px;">‚Çπ${(expense.amount || 0).toFixed(2)}</div>
                                                <div style="font-size: 12px; color: var(--system-gray); font-weight: 600;">${getTimeAgo(expense.date)}</div>
                    </div>
                </div>
            `).join('');
        }

        // üéØ ENHANCED QUICK EXPENSE ADDITION
        function addQuickExpense(event) {
            event.preventDefault();
            
            try {
                const amount = parseFloat(document.getElementById('quickAmount').value);
                const category = document.getElementById('quickCategory').value;
                const description = document.getElementById('quickDescription').value;
                const mood = document.getElementById('quickMood').value;
                const paymentMethod = document.getElementById('quickPayment').value;
                const location = document.getElementById('quickLocation').value;

                if (isNaN(amount) || amount <= 0) {
                    showAdvancedFlashMessage('‚ö†Ô∏è Please enter a valid amount greater than zero!', 'warning');
                    return;
                }

                if (!description.trim()) {
                    showAdvancedFlashMessage('‚ö†Ô∏è Please add a description for your expense!', 'warning');
                    return;
                }

                const expense = {
                    id: Date.now(),
                    userId: currentUser.id,
                    amount,
                    category,
                    description,
                    mood,
                    paymentMethod,
                    location: location || null,
                    notes: `Added via Ultimate Quick Add - ${new Date().toLocaleString()}`,
                    date: new Date().toISOString()
                };

                expenses.push(expense);
                localStorage.setItem('backpack_expenses', JSON.stringify(expenses));
                
                showAdvancedFlashMessage(`‚úÖ Success! ‚Çπ${amount.toLocaleString('en-IN')} expense added for ${getCategoryLabel(category)}! ${getMoodIcon(mood)} ${getPaymentIcon(paymentMethod)}`, 'success');
                
                document.getElementById('quickExpenseForm').reset();
                
                setTimeout(() => {
                    updateDashboard();
                    ultimateAI.updateSiteData();
                    
                    const userExpenseCount = expenses.filter(e => e.userId === currentUser.id).length;
                    if (userExpenseCount === 1) {
                        setTimeout(() => showAdvancedFlashMessage('üéâ Congratulations! You\'ve added your first expense. Your financial journey begins!', 'success'), 1000);
                    } else if (userExpenseCount % 10 === 0) {
                        setTimeout(() => showAdvancedFlashMessage(`üèÜ Milestone Achieved! ${userExpenseCount} expenses tracked. You\'re building great financial habits!`, 'success'), 1000);
                    }
                }, 300);
                
            } catch (error) {
                console.error('‚ùå Error adding expense:', error);
                showAdvancedFlashMessage('‚ùå Error adding expense. Please try again or contact support.', 'error');
            }
        }

        // üéØ UTILITY FUNCTIONS
        function getCategoryIcon(category) {
            const icons = {
                food: 'üçï', transport: 'üöó', entertainment: 'üé¨',
                education: 'üìö', shopping: 'üõçÔ∏è', clothing: 'üëï', 
                healthcare: 'üè•', utilities: '‚ö°', other: 'üîÑ'
            };
            return icons[category] || 'üîÑ';
        }

        function getMoodIcon(mood) {
            const icons = {
                happy: 'üòä', neutral: 'üòê', sad: 'üò¢', excited: 'ü§©', 
                confident: 'üòé', worried: 'üò∞', regretful: 'üòî'
            };
            return icons[mood] || 'üòê';
        }

        function getPaymentIcon(method) {
            const icons = {
                upi: 'üì±', card: 'üí≥', cash: 'üíµ', wallet: 'üëõ', netbanking: 'üè¶'
            };
            return icons[method] || 'üí≥';
        }

        function getPaymentLabel(method) {
            const labels = {
                upi: 'UPI', card: 'Card', cash: 'Cash', wallet: 'Digital Wallet', netbanking: 'Net Banking'
            };
            return labels[method] || 'Card';
        }

        function getExpenseColor(category) {
            const colors = {
                food: '#FF6B6B', transport: '#4ECDC4', entertainment: '#45B7D1',
                education: '#96CEB4', shopping: '#FFEAA7', clothing: '#DDA0DD',
                healthcare: '#98D8C8', utilities: '#F7DC6F', other: '#BDC3C7'
            };
            return colors[category] || '#BDC3C7';
        }

        function getCampusName(campus) {
            const names = {
                'CHRIST_BLR': 'Christ University - BCA', 'DU_DELHI': 'Delhi University',
                'VIT_VEL': 'VIT Vellore', 'BITS_PIL': 'BITS Pilani',
                'IIT_BOM': 'IIT Bombay', 'IIT_DEL': 'IIT Delhi'
            };
            return names[campus] || campus || 'University';
        }

        function getCategoryLabel(category) {
            const labels = {
                food: 'üçï Food & Dining', transport: 'üöó Transportation',
                entertainment: 'üé¨ Entertainment', education: 'üìö Education',
                shopping: 'üõçÔ∏è Shopping', clothing: 'üëï Clothing',
                healthcare: 'üè• Healthcare', utilities: '‚ö° Utilities', other: 'üîÑ Other'
            };
            return labels[category] || category;
        }

        function formatDate(dateString) {
            if (!dateString) return 'No date';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-IN', { 
                    day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit'
                });
            } catch {
                return 'Invalid date';
            }
        }

        function getTimeAgo(dateString) {
            if (!dateString) return 'Unknown';
            try {
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffDays = Math.floor(diffHours / 24);
                
                if (diffHours < 1) return 'Just now';
                if (diffHours < 24) return `${diffHours}h ago`;
                if (diffDays < 30) return `${diffDays}d ago`;
                return date.toLocaleDateString('en-IN');
            } catch {
                return 'Unknown';
            }
        }

        // üé® ENHANCED FLASH MESSAGE SYSTEM
        function showAdvancedFlashMessage(message, type = 'success') {
            const existingFlash = document.querySelector('.flash-message');
            if (existingFlash) {
                existingFlash.remove();
            }

            const flash = document.createElement('div');
            flash.className = `flash-message ${type}`;
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå', 
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            const colors = {
                success: 'var(--success-green)',
                error: 'var(--danger-red)',
                warning: 'var(--warning-orange)',
                info: 'var(--info-cyan)'
            };
            
            flash.innerHTML = `
                <div style="display: flex; align-items: center; gap: 18px;">
                    <div style="font-size: 32px; flex-shrink: 0;">${icons[type] || '‚ÑπÔ∏è'}</div>
                    <div style="flex: 1;">
                        <div style="font-size: 16px; line-height: 1.5; font-weight: 600;">${message}</div>
                        <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">${new Date().toLocaleTimeString()}</div>
                    </div>
                    <div onclick="this.parentElement.parentElement.remove()" style="cursor: pointer; font-size: 24px; font-weight: bold; opacity: 0.7; transition: opacity 0.3s; padding: 8px; border-radius: 50%; background: rgba(0,0,0,0.1); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.7'">&times;</div>
                </div>
            `;
            
            flash.style.borderLeftColor = colors[type];
            document.body.appendChild(flash);
            
            setTimeout(() => {
                if (flash.parentNode) {
                    flash.style.animation = 'slideOutRight 0.8s ease forwards';
                    setTimeout(() => flash.remove(), 800);
                }
            }, 8000);
        }

        // üì§ ULTIMATE EXPORT FUNCTIONS WITH FIXED CSV ENCODING
        function exportToCSV() {
            const userExpenses = expenses.filter(e => e.userId === currentUser.id);
            
            if (userExpenses.length === 0) {
                showAdvancedFlashMessage('‚ö†Ô∏è No expenses to export! Add some expenses first to generate your financial report.', 'warning');
                return;
            }

            // UTF-8 BOM for proper rupee symbol encoding
            const BOM = '\uFEFF';
            let csvContent = BOM + "Date,Description,Category,Amount,Payment Method,Mood,Location,Notes\n";
            
            userExpenses.forEach(expense => {
                const row = [
                    formatDate(expense.date),
                    `"${expense.description.replace(/"/g, '""')}"`,
                    getCategoryLabel(expense.category),
                    `‚Çπ${expense.amount.toFixed(2)}`,
                    getPaymentLabel(expense.paymentMethod || 'card'),
                    expense.mood || 'neutral',
                    `"${(expense.location || 'Not specified').replace(/"/g, '""')}"`,
                    `"${(expense.notes || '').replace(/"/g, '""')}"`
                ].join(',');
                csvContent += row + "\n";
            });

            const totalSpent = userExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            const budget = currentUser.monthlyBudget || 0;
            csvContent += `\nSummary Report Generated: ${new Date().toLocaleString()}\n`;
            csvContent += `Total Expenses: ${userExpenses.length}\n`;
            csvContent += `Total Amount: ‚Çπ${totalSpent.toLocaleString('en-IN')}\n`;
            csvContent += `Monthly Budget: ‚Çπ${budget.toLocaleString('en-IN')}\n`;
            csvContent += `Budget Utilized: ${budget > 0 ? ((totalSpent / budget) * 100).toFixed(1) : 0}%\n`;

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `Ultimate_Financial_Report_${currentUser.fullName.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showAdvancedFlashMessage(`üìä Advanced CSV Report exported successfully! Downloaded complete financial data for ${userExpenses.length} expenses with proper encoding.`, 'success');
        }

        function exportToPDF() {
            const userExpenses = expenses.filter(e => e.userId === currentUser.id);
            
            if (userExpenses.length === 0) {
                showAdvancedFlashMessage('‚ö†Ô∏è No expenses to export! Add expenses first.', 'warning');
                return;
            }

            try {
                if (typeof window.jspdf === 'undefined') {
                    showAdvancedFlashMessage('‚ùå PDF library not loaded. Please refresh and try again.', 'error');
                    return;
                }

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                const totalSpent = userExpenses.reduce((sum, exp) => sum + exp.amount, 0);
                const budget = currentUser.monthlyBudget || 0;
                const budgetUsed = budget > 0 ? ((totalSpent / budget) * 100).toFixed(1) : '0';

                // Compact Header
                doc.setFontSize(18);
                doc.setTextColor(0, 122, 255);
                doc.text('Ultimate Financial Report', 20, 25);

                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text(`${currentUser.fullName} | ${new Date().toLocaleDateString()}`, 20, 35);

                // Compact Summary
                doc.setDrawColor(0, 122, 255);
                doc.rect(15, 45, 180, 25);
                
                doc.setFontSize(12);
                doc.setTextColor(0, 122, 255);
                doc.text('Financial Summary', 20, 55);
                
                doc.setFontSize(9);
                doc.setTextColor(0, 0, 0);
                doc.text(`Budget: Rs.${budget.toLocaleString('en-IN')}`, 20, 62);
                doc.text(`Spent: Rs.${totalSpent.toLocaleString('en-IN')} (${budgetUsed}%)`, 100, 62);

                // Compact Expenses List (top 10 only)
                let y = 85;
                doc.setFontSize(12);
                doc.setTextColor(0, 122, 255);
                doc.text('Recent Expenses (Top 10)', 20, y);
                
                y += 10;
                doc.setFontSize(8);
                doc.setTextColor(0, 0, 0);
                
                userExpenses.slice(-10).forEach((expense, index) => {
                    doc.text(`${new Date(expense.date).toLocaleDateString()}`, 20, y);
                    doc.text(`${expense.description.substring(0, 30)}`, 50, y);
                    doc.text(`${expense.category}`, 120, y);
                    doc.text(`Rs.${expense.amount.toFixed(0)}`, 160, y);
                    y += 6;
                });

                doc.save(`Financial_Report_${currentUser.fullName.replace(/\s+/g, '_')}.pdf`);
                showAdvancedFlashMessage('üìÑ Compact PDF report generated!', 'success');
                
            } catch (error) {
                console.error('PDF Error:', error);
                showAdvancedFlashMessage('‚ùå PDF generation failed. Try CSV export.', 'error');
            }
        }

        function shareViaEmail() {
            const userExpenses = expenses.filter(e => e.userId === currentUser.id);
            const totalSpent = userExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            const budget = currentUser.monthlyBudget || 0;
            const budgetUsed = budget > 0 ? ((totalSpent / budget) * 100).toFixed(1) : 0;
            
            const subject = encodeURIComponent(`üí∞ Advanced Financial Report - ${currentUser.fullName} - ${new Date().toLocaleDateString()}`);
            const body = encodeURIComponent(`Hi,

Here's my comprehensive financial summary generated by the Ultimate Backpack Optimizer:

üìä FINANCIAL OVERVIEW:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚Ä¢ Monthly Budget: ‚Çπ${budget.toLocaleString('en-IN')}
‚Ä¢ Total Spent: ‚Çπ${totalSpent.toLocaleString('en-IN')} (${budgetUsed}%)
‚Ä¢ Remaining: ‚Çπ${(budget - totalSpent).toLocaleString('en-IN')}
‚Ä¢ Total Transactions: ${userExpenses.length}
‚Ä¢ Average Expense: ‚Çπ${userExpenses.length > 0 ? (totalSpent / userExpenses.length).toFixed(0) : '0'}

üéØ BUDGET STATUS: ${budgetUsed < 70 ? '‚úÖ Healthy' : budgetUsed < 90 ? '‚ö†Ô∏è Monitor' : 'üî¥ Critical'}

üìà Generated by Ultimate AI Financial Dashboard
üîó Powered by Backpack Optimizer

Best regards,
${currentUser.fullName}`);

            const mailtoLink = `mailto:?subject=${subject}&body=${body}`;
            window.open(mailtoLink);
            
            showAdvancedFlashMessage('üìß Email client opened with your comprehensive financial report!', 'success');
        }

        function shareViaWhatsApp() {
            const userExpenses = expenses.filter(e => e.userId === currentUser.id);
            const totalSpent = userExpenses.reduce((sum, exp) => sum + exp.amount, 0);
            const budget = currentUser.monthlyBudget || 0;
            const budgetUsed = budget > 0 ? ((totalSpent / budget) * 100).toFixed(1) : 0;
            
            const message = encodeURIComponent(`üéí *ULTIMATE FINANCIAL UPDATE*

üìä *Monthly Summary:*
‚Ä¢ Budget: ‚Çπ${budget.toLocaleString('en-IN')}
‚Ä¢ Spent: ‚Çπ${totalSpent.toLocaleString('en-IN')} (${budgetUsed}%)
‚Ä¢ Transactions: ${userExpenses.length}
‚Ä¢ Status: ${budgetUsed < 70 ? '‚úÖ Healthy' : budgetUsed < 90 ? '‚ö†Ô∏è Careful' : 'üî¥ Over Budget'}

ü§ñ Managed with Ultimate AI Assistant
üíº Tracking success with Backpack Optimizer!

#SmartBudgeting #FinancialFreedom #StudentLife`);

            const whatsappLink = `https://wa.me/?text=${message}`;
            window.open(whatsappLink, '_blank');
            
            showAdvancedFlashMessage('üì± WhatsApp opened with your financial update!', 'success');
        }

        function refreshExpenses() {
            showAdvancedFlashMessage('üîÑ Refreshing financial data...', 'info');
            setTimeout(() => {
                updateDashboard();
                showAdvancedFlashMessage('‚úÖ Financial data refreshed successfully!', 'success');
            }, 1000);
        }

        function showSampleData() {
            showAdvancedFlashMessage('üìä Sample data feature coming soon! Add real expenses for the best experience.', 'info');
        }

        function logout() {
            if (confirm(`Are you sure you want to logout from your Ultimate Financial Dashboard, ${currentUser.fullName || 'Student'}?`)) {
                if (ultimateAI) {
                    ultimateAI.saveConversationHistory();
                    ultimateAI.saveUserMemory();
                }
                
                localStorage.removeItem('currentUser');
                showAdvancedFlashMessage('üëã Logged out successfully! Your data is safely stored. See you soon!', 'success');
                
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            }
        }

        // üöÄ ULTIMATE DASHBOARD INITIALIZATION
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Ultimate Advanced Dashboard Initializing...');
            console.log('üìä Version: 3.0.0 - Ultimate Edition');
            console.log('ü§ñ AI: Ultra-Advanced Financial Intelligence');
            console.log('üéØ Features: Complete Financial Management Suite');
            
            updateUserProfile();
            updateDashboard();
            
            ultimateAI = new UltimateFinancialAI();
            
            setTimeout(() => {
                const userExpenses = expenses.filter(e => e.userId === currentUser.id);
                updateCharts(userExpenses);
            }, 1500);
            
            setTimeout(() => {
                showAdvancedFlashMessage(`üéâ Welcome back, ${currentUser.fullName}! Your Ultimate AI Financial Dashboard is ready with ${expenses.filter(e => e.userId === currentUser.id).length} expenses tracked.`, 'success');
            }, 2000);
            
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 'k':
                            e.preventDefault();
                            toggleAIChat();
                            break;
                        case 'n':
                            e.preventDefault();
                            document.getElementById('quickAmount')?.focus();
                            break;
                        case 'r':
                            e.preventDefault();
                            refreshExpenses();
                            break;
                    }
                }
            });
            if (!window.webAppInstaller) {
        window.webAppInstaller = new WebAppInstaller();
    }
            console.log('‚úÖ Ultimate Advanced Dashboard loaded successfully!');
            console.log('ü§ñ Ultra-Smart AI Chatbot ready and learning!');
            console.log('üìà All advanced charts and features operational!');
            console.log('üéØ Real-time financial intelligence activated!');
            console.log('‚å®Ô∏è Keyboard shortcuts: Ctrl+K (Chat), Ctrl+N (Add Expense), Ctrl+R (Refresh)');
        });
        // üöÄ PWA FUNCTIONALITY
class PWAManager {
    constructor() {
        this.deferredPrompt = null;
        this.isInstalled = false;
        this.init();
    }

    async init() {
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            try {
                const registration = await navigator.serviceWorker.register('/sw.js');
                console.log('‚úÖ Service Worker registered:', registration);
                
                // Check for updates
                registration.addEventListener('updatefound', () => {
                    console.log('üîÑ New service worker available');
                    this.showUpdateAvailable();
                });
            } catch (error) {
                console.error('‚ùå Service Worker registration failed:', error);
            }
        }

        // Setup install prompt
        this.setupInstallPrompt();
        
        // Check if already installed
        this.checkIfInstalled();
        
        // Setup offline detection
        this.setupOfflineDetection();
    }

    setupInstallPrompt() {
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            this.deferredPrompt = e;
            this.showInstallButton();
            console.log('üí° Install prompt ready');
        });

        window.addEventListener('appinstalled', () => {
            this.isInstalled = true;
            this.hideInstallButton();
            this.deferredPrompt = null;
            showAdvancedFlashMessage('üéâ App installed successfully! Access from your home screen.', 'success');
        });
    }

    showInstallButton() {
        if (document.getElementById('pwa-install-button')) return;

        const installButton = document.createElement('div');
        installButton.id = 'pwa-install-button';
        installButton.innerHTML = `
            <button onclick="pwaManager.installApp()" style="
                position: fixed;
                top: 80px;
                right: 20px;
                background: var(--gradient-success);
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 25px;
                font-weight: 700;
                cursor: pointer;
                box-shadow: 0 6px 20px rgba(0, 201, 255, 0.4);
                z-index: 10001;
                font-size: 14px;
                transition: var(--transition);
                animation: pulse 2s infinite;
            " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                üì± Install App
            </button>
        `;
        document.body.appendChild(installButton);
    }

    hideInstallButton() {
        const button = document.getElementById('pwa-install-button');
        if (button) button.remove();
    }

    async installApp() {
        if (!this.deferredPrompt) {
            showAdvancedFlashMessage('‚ÑπÔ∏è App installation not available', 'info');
            return;
        }

        try {
            this.deferredPrompt.prompt();
            const { outcome } = await this.deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                showAdvancedFlashMessage('üì± Installing app... Please wait.', 'info');
            } else {
                showAdvancedFlashMessage('‚ÑπÔ∏è App installation cancelled', 'info');
            }
            
            this.deferredPrompt = null;
            this.hideInstallButton();
        } catch (error) {
            console.error('‚ùå Install failed:', error);
            showAdvancedFlashMessage('‚ùå Installation failed. Try again later.', 'error');
        }
    }

    checkIfInstalled() {
        // Check if running in standalone mode
        if (window.matchMedia('(display-mode: standalone)').matches || 
            window.navigator.standalone === true) {
            this.isInstalled = true;
            console.log('‚úÖ App is running in standalone mode');
            document.body.classList.add('pwa-installed');
        }
    }

    setupOfflineDetection() {
        window.addEventListener('online', () => {
            showAdvancedFlashMessage('üåê Back online! Syncing data...', 'success');
            this.syncOfflineData();
        });

        window.addEventListener('offline', () => {
            showAdvancedFlashMessage('üì∂ You are offline. Data will be saved locally.', 'warning');
        });
    }

    async syncOfflineData() {
        if ('serviceWorker' in navigator && 'sync' in window.ServiceWorkerRegistration.prototype) {
            const registration = await navigator.serviceWorker.ready;
            await registration.sync.register('expense-sync');
        }
    }

    showUpdateAvailable() {
        const updateButton = document.createElement('div');
        updateButton.innerHTML = `
            <div style="
                position: fixed;
                bottom: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--gradient-warning);
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                box-shadow: 0 6px 20px rgba(252, 70, 107, 0.4);
                z-index: 10002;
                font-weight: 700;
                cursor: pointer;
                animation: slideUp 0.5s ease;
            " onclick="window.location.reload()">
                üîÑ Update Available - Click to Refresh
            </div>
        `;
        document.body.appendChild(updateButton);
    }
}
// üì± ENHANCED WEB APP INSTALLATION MANAGER
class WebAppInstaller {
    constructor() {
        this.deferredPrompt = null;
        this.isInstalled = false;
        this.installButton = null;
        this.init();
    }

    init() {
        // Check if already installed
        this.checkInstallStatus();
        
        // Setup install prompt capture
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            this.deferredPrompt = e;
            this.showInstallSection();
        });

        // Handle successful installation
        window.addEventListener('appinstalled', () => {
            this.handleInstallSuccess();
        });

        // Initial setup
        this.setupInstallSection();
    }

    checkInstallStatus() {
        // Check if running as PWA
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches || 
                           window.navigator.standalone === true;
        
        if (isStandalone) {
            this.isInstalled = true;
            this.hideInstallSection();
        }
    }

    setupInstallSection() {
        const section = document.getElementById('webappDownload');
        if (!section) return;

        if (this.isInstalled) {
            this.showInstalledState(section);
        } else if (!this.deferredPrompt) {
            // Show browser-specific instructions
            this.showBrowserInstructions(section);
        }
    }

    showInstallSection() {
        const section = document.getElementById('webappDownload');
        if (section) {
            section.style.display = 'block';
            section.style.animation = 'slideUp 0.5s ease';
        }
    }

    hideInstallSection() {
        const section = document.getElementById('webappDownload');
        if (section) {
            section.style.display = 'none';
        }
    }

    showInstalledState(section) {
        section.innerHTML = `
            <div class="webapp-card">
                <div class="webapp-icon">‚úÖ</div>
                <div class="webapp-content">
                    <h3>App Already Installed!</h3>
                    <p>You're using the web app version. Enjoy the native experience!</p>
                    <div class="webapp-benefits">
                        <span>üöÄ Running as App</span>
                        <span>‚ö° Optimized Performance</span>
                        <span>üì∂ Offline Ready</span>
                    </div>
                </div>
                <div class="webapp-actions">
                    <button class="webapp-install-btn webapp-installed">
                        <span class="install-text">üéâ App Installed</span>
                        <span class="install-size">Active</span>
                    </button>
                </div>
            </div>
        `;
    }

    showBrowserInstructions(section) {
        const browser = this.detectBrowser();
        const instructions = this.getBrowserInstructions(browser);
        
        const installBtn = section.querySelector('.webapp-install-btn');
        if (installBtn) {
            installBtn.innerHTML = `
                <span class="install-text">üì± ${instructions.buttonText}</span>
                <span class="install-size">${instructions.method}</span>
            `;
            installBtn.onclick = () => this.showManualInstructions(browser);
        }
    }

    detectBrowser() {
        const ua = navigator.userAgent;
        if (ua.includes('Chrome') && !ua.includes('Edg')) return 'chrome';
        if (ua.includes('Safari') && !ua.includes('Chrome')) return 'safari';
        if (ua.includes('Edg')) return 'edge';
        if (ua.includes('Firefox')) return 'firefox';
        return 'other';
    }

    getBrowserInstructions(browser) {
        const instructions = {
            chrome: {
                buttonText: 'Install Chrome App',
                method: 'Menu ‚Üí Install',
                steps: [
                    '1. Click the 3-dot menu in Chrome',
                    '2. Select "Install Backpack Optimizer"',
                    '3. Click "Install" to confirm',
                    '4. App will appear on your home screen/desktop'
                ]
            },
            safari: {
                buttonText: 'Add to Home Screen',
                method: 'Share ‚Üí Add',
                steps: [
                    '1. Tap the Share button (‚ñ°‚Üó) in Safari',
                    '2. Scroll down and tap "Add to Home Screen"',
                    '3. Customize the name if needed',
                    '4. Tap "Add" to install on home screen'
                ]
            },
            edge: {
                buttonText: 'Install Edge App',
                method: 'Menu ‚Üí Apps',
                steps: [
                    '1. Click the 3-dot menu in Edge',
                    '2. Go to Apps ‚Üí Install this site as an app',
                    '3. Click "Install"',
                    '4. App will be available in your apps'
                ]
            },
            other: {
                buttonText: 'Install Web App',
                method: 'Browser Menu',
                steps: [
                    '1. Look for install option in browser menu',
                    '2. Or bookmark this page for quick access',
                    '3. Enable notifications for updates',
                    '4. Use regularly for best experience'
                ]
            }
        };
        
        return instructions[browser] || instructions.other;
    }
}

// üéØ MAIN INSTALL FUNCTION (called by button click)
async function installWebApp() {
    const installer = window.webAppInstaller || new WebAppInstaller();
    
    if (installer.deferredPrompt) {
        // Direct PWA installation
        try {
            showInstallProgress();
            
            installer.deferredPrompt.prompt();
            const { outcome } = await installer.deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                showAdvancedFlashMessage('üì± Installing app... Please wait!', 'info');
            } else {
                hideInstallProgress();
                showAdvancedFlashMessage('‚ÑπÔ∏è Installation cancelled. Try again anytime!', 'info');
            }
            
            installer.deferredPrompt = null;
        } catch (error) {
            hideInstallProgress();
            console.error('Install error:', error);
            showAdvancedFlashMessage('‚ùå Installation failed. Please try manual installation.', 'error');
            showManualInstructions();
        }
    } else {
        // Show manual instructions
        showManualInstructions();
    }
}

function showInstallProgress() {
    const button = document.querySelector('.webapp-install-btn');
    if (button) {
        button.classList.add('webapp-installing');
        button.innerHTML = `
            <span class="install-text">üì• Installing...</span>
            <span class="install-size">Please wait</span>
        `;
    }
}

function hideInstallProgress() {
    const button = document.querySelector('.webapp-install-btn');
    if (button) {
        button.classList.remove('webapp-installing');
        button.innerHTML = `
            <span class="install-text">üì• Install App</span>
            <span class="install-size">~2MB</span>
        `;
    }
}

function showAppInfo() {
    const infoModal = `
        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center;" onclick="this.remove()">
            <div style="background: white; border-radius: 25px; padding: 40px; max-width: 500px; margin: 20px; position: relative;" onclick="event.stopPropagation()">
                <button onclick="this.parentElement.parentElement.remove()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer;">√ó</button>
                <h3 style="margin-top: 0; color: var(--primary-blue); font-size: 24px;">üì± Why Install Our Web App?</h3>
                <div style="margin: 20px 0; line-height: 1.8;">
                    <p><strong>‚ö° Lightning Fast:</strong> Instant loading with cached data</p>
                    <p><strong>üì∂ Works Offline:</strong> Access your data without internet</p>
                    <p><strong>üîî Push Notifications:</strong> Never miss budget alerts</p>
                    <p><strong>üöÄ Native Feel:</strong> Just like a regular mobile app</p>
                    <p><strong>üíæ Secure Storage:</strong> Your data stays on your device</p>
                    <p><strong>üéØ Quick Access:</strong> Home screen icon for instant access</p>
                </div>
                <button onclick="installWebApp(); this.parentElement.parentElement.remove();" style="background: var(--gradient-success); color: white; border: none; padding: 15px 30px; border-radius: 20px; font-weight: 700; cursor: pointer; width: 100%;">
                    üöÄ Install Now
                </button>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', infoModal);
}

function showManualInstructions(browser = null) {
    const detectedBrowser = browser || new WebAppInstaller().detectBrowser();
    const instructions = new WebAppInstaller().getBrowserInstructions(detectedBrowser);
    
    const modal = `
        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10001; display: flex; align-items: center; justify-content: center;" onclick="this.remove()">
            <div style="background: white; border-radius: 25px; padding: 40px; max-width: 600px; margin: 20px;" onclick="event.stopPropagation()">
                <button onclick="this.parentElement.parentElement.remove()" style="position: absolute; top: 15px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer;">√ó</button>
                <h3 style="margin-top: 0; color: var(--primary-blue);">üì± How to Install (${detectedBrowser.toUpperCase()})</h3>
                <div style="margin: 25px 0;">
                    ${instructions.steps.map(step => `<p style="margin: 15px 0; padding: 10px; background: #f5f5f5; border-radius: 10px; line-height: 1.6;">${step}</p>`).join('')}
                </div>
                <p style="color: var(--system-gray); font-size: 14px; text-align: center; margin-top: 30px;">
                    ‚ú® Once installed, the app will work offline and load instantly!
                </p>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', modal);
}

// Initialize on page load
window.webAppInstaller = new WebAppInstaller();

// Initialize PWA Manager
let pwaManager;
document.addEventListener('DOMContentLoaded', () => {
    pwaManager = new PWAManager();
});

    </script>
     <footer class="dashboard-footer">
            <div class="footer-container">
                
                
                <div class="footer-section">
                    <h4>üöÄ Smart Features</h4>
                    <ul>
                        <li><a href="#">üìä AI Budget Recommendations</a></li>
                        <li><a href="#">üõí Campus-specific Marketplace</a></li>
                        <li><a href="#">üìà Predictive Financial Analytics</a></li>
                        <li><a href="#">üß† Expense Pattern Recognition</a></li>
                        <li><a href="#">üéØ Goal-based Savings Plans</a></li>
                        <li><a href="#">üè† Student Housing Solutions</a></li>
                        <li><a href="#">üë• Peer Financial Insights</a></li>
                        <li><a href="#">üì± Real-time Notifications</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>üéì Campus Network</h4>
                    <ul>
                        <li><a href="#">üèõÔ∏è Christ University Bangalore</a></li>
                        <li><a href="#">üèõÔ∏è Delhi University</a></li>
                        <li><a href="#">üèõÔ∏è VIT Vellore</a></li>
                        <li><a href="#">üèõÔ∏è BITS Pilani</a></li>
                        <li><a href="#">üèõÔ∏è IIT Bombay & Delhi</a></li>
                        <li><a href="#">üèõÔ∏è Manipal University</a></li>
                        <li><a href="#">üèõÔ∏è Amity University</a></li>
                        <li><a href="#">‚ûï Join Your Campus</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>üìû Resources & Support</h4>
                    <ul>
                        <li><a href="#">üìö Financial Literacy Center</a></li>
                        <li><a href="#">‚≠ê Student Success Stories</a></li>
                        <li><a href="#">üìñ Budget Planning Guides</a></li>
                        <li><a href="#">ü§ñ AI Coach Training</a></li>
                        <li><a href="#">üéØ Campus Ambassador Program</a></li>
                        <li><a href="#">üîß Developer API</a></li>
                        <li><a href="#">üí¨ 24/7 Support Chat</a></li>
                        <li><a href="#">üîí Privacy & Security</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Backpack Optimizer. All rights reserved. Made with ‚ù§Ô∏è for Indian students by students.</p>
                <p class="developer-credit" id="footerCredit">
                    Loading developer information...
                </p>
                <p style="font-size: 13px; margin-top: 15px; opacity: 0.8;">
                    üèÜ Winner - Campus Innovation Challenge 2024 | üöÄ Featured in University Tech Showcase | üåü AI-Powered Financial Management Platform
                </p>
                <p style="font-size: 12px; margin-top: 10px; opacity: 0.7;">
                    Built with Chart.js, Advanced AI, Professional Design | Trusted by 10,000+ Students Across India
                </p>
            </div>
        </footer>
    </div>

  

</body>
</html>


